(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,59802,19016,92470,47086,54006,69777,4423,50938,39312,45560,93737,90628,7292,15505,95729,87130,71034,e=>{"use strict";e.i(44927),e.i(90300),e.i(92693);var t=e.i(43476),s=e.i(71645),a=e.i(46040),l=e.i(76525),r=e.i(73146),i=e.i(80809),d=e.i(63207);function n({isOpen:e,onClose:n,editBundle:o}){let{state:c,dispatch:m}=(0,r.useApp)(),{success:u,error:x,warning:p}=(0,i.useToast)(),[h,b]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[j,v]=(0,s.useState)("virtual"),[N,y]=(0,s.useState)(""),[w,C]=(0,s.useState)(""),[k,S]=(0,s.useState)(""),[I,A]=(0,s.useState)(""),[_,P]=(0,s.useState)(""),[D,q]=(0,s.useState)([]),[R,T]=(0,s.useState)(!1),[O,$]=(0,s.useState)("discount"),[M,U]=(0,s.useState)("10"),[E,F]=(0,s.useState)(""),[L,B]=(0,s.useState)(""),[z,Q]=(0,s.useState)("15"),[W,K]=(0,s.useState)(""),[H,V]=(0,s.useState)(!1),[G,Y]=(0,s.useState)("1"),X=!!o;(0,s.useEffect)(()=>{e&&(o?(b(o.name),f(o.sku),v(o.type),y(o.description||""),C(o.prices.msrp.toString()),S(o.prices.shopify.toString()),A(o.prices.amazon.toString()),P(o.assemblyInstructions||""),q([...o.components]),F(o.compareAtPrices?.shopify?.toString()||""),B(o.compareAtPrices?.amazon?.toString()||""),$("manual"),U("10"),Q("15")):(b(""),f(""),v("virtual"),y(""),C(""),S(""),A(""),F(""),B(""),Q("15"),P(""),q([]),$("discount"),U("10")),K(""),Y("1"))},[e,o]);let J=e=>c.inventory.filter(t=>t.productId===e).reduce((e,t)=>e+t.quantity,0),Z=e=>Math.round(100*e)/100,ee=(0,s.useMemo)(()=>{let e=Z(D.reduce((e,t)=>{let s=c.products.find(e=>e.id===t.productId);return e+(s?.cost.rolling||0)*t.quantity},0)),t=Z(D.reduce((e,t)=>{let s=c.products.find(e=>e.id===t.productId);return e+(s?.prices.msrp||0)*t.quantity},0)),s=Z(D.reduce((e,t)=>{let s=c.products.find(e=>e.id===t.productId);return e+(s?.prices.shopify||s?.prices.msrp||0)*t.quantity},0)),a=Z(D.reduce((e,t)=>{let s=c.products.find(e=>e.id===t.productId);return e+(s?.prices.amazon||s?.prices.msrp||0)*t.quantity},0)),l=parseFloat(w)||0,r=l>0?Z((l-e)/l*100):0,i=Z(s-l),d=s>0?Z(i/s*100):0,n=D.length>0?Math.min(...D.map(e=>Math.floor(J(e.productId)/e.quantity))):0,o="";if(D.length>0){let e=1/0;D.forEach(t=>{let s=Math.floor(J(t.productId)/t.quantity);s<e&&(e=s,o=t.productName)})}return{cost:e,margin:r,availableQty:n,limitingComponent:o,compareAtMSRP:t,calcCompareAtShopify:s,calcCompareAtAmazon:a,savings:i,savingsPercent:d}},[D,w,c.products,c.inventory]);(0,s.useEffect)(()=>{if("discount"===O&&ee.calcCompareAtShopify>0){let e=parseFloat(M)||0;C(Z(ee.calcCompareAtShopify*(1-e/100)).toFixed(2))}},[O,M,ee.calcCompareAtShopify]),(0,s.useEffect)(()=>{if(ee.calcCompareAtShopify>0&&F(ee.calcCompareAtShopify.toFixed(2)),"discount"===O&&ee.calcCompareAtShopify>0){let e=parseFloat(M)||0;S(Z(ee.calcCompareAtShopify*(1-e/100)).toFixed(2))}},[ee.calcCompareAtShopify,O,M]),(0,s.useEffect)(()=>{let e=parseFloat(z)||0;if(ee.calcCompareAtAmazon>0&&B(Z(ee.calcCompareAtAmazon*(1+e/100)).toFixed(2)),"discount"===O&&ee.calcCompareAtAmazon>0){let t=parseFloat(M)||0;A(Z(ee.calcCompareAtAmazon*(1-t/100)*(1+e/100)).toFixed(2))}},[ee.calcCompareAtAmazon,O,M,z]);let et=(0,s.useMemo)(()=>{if(!W.trim())return[];let e=W.toLowerCase();return c.products.filter(t=>(t.name.toLowerCase().includes(e)||t.sku.toLowerCase().includes(e))&&!D.some(e=>e.productId===t.id)).slice(0,8)},[W,c.products,D]),es=(e,t)=>{t<1||q(s=>s.map(s=>s.productId===e?{...s,quantity:t}:s))},ea=(0,s.useMemo)(()=>!(!h.trim()||!g.trim()||!j||!w||0>=parseFloat(w)||0===D.length||c.bundles.find(e=>e.sku.toLowerCase()===g.toLowerCase()&&e.id!==o?.id)),[h,g,j,w,D,c.bundles,o]);return(0,t.jsx)(a.Modal,{open:e,onClose:n,title:X?"Edit Bundle":"Create Bundle",subtitle:X?`Editing ${o?.name}`:"Define a new product bundle",size:"lg",footer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:()=>{if(ea){T(!0);try{let e=parseFloat(w)||0,t={id:o?.id||crypto.randomUUID(),name:h.trim(),sku:g.trim().toUpperCase(),type:j,description:N.trim()||void 0,prices:{msrp:e,shopify:parseFloat(k)||e,amazon:parseFloat(I)||e,wholesale:.6*e},compareAtPrices:{msrp:ee.compareAtMSRP,shopify:parseFloat(E)||ee.calcCompareAtShopify,amazon:parseFloat(L)||ee.calcCompareAtAmazon},components:D,assemblyInstructions:"virtual"!==j&&_.trim()||void 0,createdAt:o?.createdAt||new Date,updatedAt:new Date};X?(m({type:"UPDATE_BUNDLE",payload:t}),u(`Bundle "${h}" updated successfully!`)):(m({type:"ADD_BUNDLE",payload:t}),u(`Bundle "${h}" created successfully!`)),n()}catch(e){x("Failed to save bundle. Please try again.")}finally{T(!1)}}},disabled:R||!ea,children:R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-spinner fa-spin mr-2"}),"Saving..."]}):X?"Save Changes":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("i",{className:"fas fa-plus mr-2"}),"Create Bundle"]})})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Basic Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Bundle Name *"}),(0,t.jsx)("input",{type:"text",value:h,onChange:e=>b(e.target.value),placeholder:"e.g., Starter Kit",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Bundle SKU *"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),placeholder:"e.g., BND-VIR-001",className:"flex-1 bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),(0,t.jsxs)("button",{type:"button",onClick:()=>{let e="virtual"===j?"VIR":"physical"===j?"PHY":"FBA",t=Math.floor(900*Math.random())+100;f(`BND-${e}-${t}`)},className:"px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg text-sm whitespace-nowrap",children:[(0,t.jsx)("i",{className:"fas fa-magic mr-1"}),"Generate"]})]})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Bundle Type *"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>v("virtual"),className:`p-3 rounded-lg border transition-colors text-left ${"virtual"===j?"bg-blue-500/20 border-blue-500/30 text-blue-400":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("i",{className:"fas fa-cloud"}),(0,t.jsx)("span",{className:"font-medium",children:"Virtual"})]}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Components deducted on sale"})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>v("physical"),className:`p-3 rounded-lg border transition-colors text-left ${"physical"===j?"bg-emerald-500/20 border-emerald-500/30 text-emerald-400":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("i",{className:"fas fa-box"}),(0,t.jsx)("span",{className:"font-medium",children:"Physical"})]}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pre-assembled, tracked as unit"})]}),(0,t.jsxs)("button",{type:"button",onClick:()=>v("fba_kit"),className:`p-3 rounded-lg border transition-colors text-left ${"fba_kit"===j?"bg-orange-500/20 border-orange-500/30 text-orange-400":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("i",{className:"fab fa-amazon"}),(0,t.jsx)("span",{className:"font-medium",children:"FBA Kit"})]}),(0,t.jsx)("div",{className:"text-xs opacity-70",children:"Pre-assembled for Amazon FBA"})]})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Description (Optional)"}),(0,t.jsx)("textarea",{value:N,onChange:e=>y(e.target.value),rows:2,placeholder:"Brief description of the bundle...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Pricing"}),D.length>0&&ee.calcCompareAtShopify>0&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-tags text-blue-400"}),(0,t.jsx)("span",{className:"text-sm text-slate-300",children:"Compare At Price:"})]}),(0,t.jsx)("span",{className:"text-lg font-bold text-blue-400",children:(0,d.formatCurrency)(ee.calcCompareAtShopify)})]}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Total if items purchased separately. Updates Shopify's compare_at_price field."}),parseFloat(w)>0&&ee.savings>0&&(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Customer saves:"}),(0,t.jsxs)("span",{className:"text-emerald-400 font-medium",children:[(0,d.formatCurrency)(ee.savings)," (",ee.savingsPercent.toFixed(0),"% off)"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,t.jsxs)("button",{type:"button",onClick:()=>$("discount"),className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${"discount"===O?"bg-emerald-500/20 border border-emerald-500/30 text-emerald-400":"bg-slate-800 border border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsx)("i",{className:"fas fa-percent mr-2"}),"Set by Discount %"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>$("manual"),className:`flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${"manual"===O?"bg-emerald-500/20 border border-emerald-500/30 text-emerald-400":"bg-slate-800 border border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsx)("i",{className:"fas fa-pen mr-2"}),"Set Manually"]})]}),"discount"===O&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Bundle Discount"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("input",{type:"range",min:"0",max:"50",step:"5",value:M,onChange:e=>U(e.target.value),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[(0,t.jsx)("span",{children:"0%"}),(0,t.jsx)("span",{children:"10%"}),(0,t.jsx)("span",{children:"20%"}),(0,t.jsx)("span",{children:"30%"}),(0,t.jsx)("span",{children:"40%"}),(0,t.jsx)("span",{children:"50%"})]})]}),(0,t.jsxs)("div",{className:"relative w-24",children:[(0,t.jsx)("input",{type:"number",min:"0",max:"100",step:"1",value:M,onChange:e=>U(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg pl-3 pr-8 py-2 text-white text-center focus:outline-none focus:border-emerald-500/50"}),(0,t.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"%"})]})]}),D.length>0&&ee.calcCompareAtShopify>0&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-slate-400",children:["Current Price: ",(0,t.jsx)("span",{className:"text-white font-medium",children:(0,d.formatCurrency)(parseFloat(w)||0)})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("label",{className:"block text-sm text-slate-400 mb-1.5",children:["Current Price (MSRP) *","discount"===O&&(0,t.jsx)("span",{className:"text-xs text-emerald-400 ml-1",children:"(auto-calculated)"})]}),(0,t.jsxs)("div",{className:"relative max-w-xs",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:w,onChange:e=>{C(e.target.value),"discount"===O&&$("manual")},placeholder:"0.00",className:`w-full bg-slate-800 border rounded-lg pl-8 pr-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 ${"discount"===O?"border-emerald-500/30":"border-slate-700"}`})]}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"The actual selling price. Updates Shopify's price field."})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)("i",{className:"fab fa-shopify text-green-400"}),(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:"Shopify"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-slate-400 mb-1",children:"Compare At Price"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:E,onChange:e=>F(e.target.value),placeholder:ee.calcCompareAtShopify.toFixed(2),className:"w-full bg-slate-700 border border-slate-600 rounded-lg pl-7 pr-3 py-2 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-green-500/50"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-xs text-slate-400 mb-1",children:"Current Price"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:k,onChange:e=>S(e.target.value),placeholder:"Same as MSRP",className:"w-full bg-slate-700 border border-slate-600 rounded-lg pl-7 pr-3 py-2 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-green-500/50"})]})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fab fa-amazon text-orange-400"}),(0,t.jsx)("span",{className:"text-sm font-medium text-white",children:"Amazon"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-slate-400",children:"Markup:"}),(0,t.jsxs)("div",{className:"relative w-20",children:[(0,t.jsx)("input",{type:"number",min:"0",max:"100",step:"1",value:z,onChange:e=>Q(e.target.value),className:"w-full bg-slate-700 border border-orange-500/30 rounded pl-2 pr-6 py-1 text-white text-sm text-center focus:outline-none focus:border-orange-500/50"}),(0,t.jsx)("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-orange-400 text-xs",children:"%"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-xs text-slate-400 mb-1",children:["Compare At Price",(0,t.jsxs)("span",{className:"text-orange-400 ml-1",children:["(+",z,"%)"]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:L,onChange:e=>B(e.target.value),placeholder:ee.calcCompareAtAmazon.toFixed(2),className:"w-full bg-slate-700 border border-slate-600 rounded-lg pl-7 pr-3 py-2 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-orange-500/50"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-xs text-slate-400 mb-1",children:["Current Price",(0,t.jsxs)("span",{className:"text-orange-400 ml-1",children:["(+",z,"%)"]})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:I,onChange:e=>A(e.target.value),placeholder:"Same as MSRP",className:"w-full bg-slate-700 border border-slate-600 rounded-lg pl-7 pr-3 py-2 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-orange-500/50"})]})]})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Components *"}),(0,t.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),(0,t.jsx)("input",{type:"text",value:W,onChange:e=>{K(e.target.value),V(!0)},onFocus:()=>V(!0),placeholder:"Search products by name or SKU...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),H&&et.length>0&&(0,t.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-48 overflow-auto",children:et.map(e=>{let s=J(e.id);return(0,t.jsxs)("button",{type:"button",onClick:()=>(e=>{let t=c.products.find(t=>t.id===e);if(!t)return;let s=parseInt(G)||1;q(e=>[...e,{productId:t.id,productName:t.name,quantity:s}]),K(""),Y("1"),V(!1)})(e.id),className:"w-full px-4 py-2.5 flex items-center justify-between hover:bg-slate-700/50 text-left",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-slate-400",children:["SKU: ",e.sku]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:`text-sm ${s>0?"text-emerald-400":"text-red-400"}`,children:[(0,d.formatNumber)(s)," available"]})})]},e.id)})})]}),(0,t.jsx)("input",{type:"number",min:"1",value:G,onChange:e=>Y(e.target.value),className:"w-20 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2.5 text-white text-center focus:outline-none focus:border-emerald-500/50",placeholder:"Qty"})]}),D.length>0?(0,t.jsx)("div",{className:"space-y-2 mb-4",children:D.map(e=>{let s=c.products.find(t=>t.id===e.productId),a=J(e.productId),l=a<e.quantity,r=(s?.prices.msrp||0)*e.quantity;return(0,t.jsxs)("div",{className:`flex items-center gap-3 p-3 rounded-lg border ${l?"bg-red-500/10 border-red-500/30":"bg-slate-800/50 border-slate-700/50"}`,children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-emerald-500/20 rounded-lg flex items-center justify-center",children:(0,t.jsx)("i",{className:"fas fa-flask text-emerald-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm text-white truncate",children:e.productName}),(0,t.jsxs)("div",{className:"text-xs text-slate-400",children:[(0,d.formatNumber)(a)," available â€¢ MSRP: ",(0,d.formatCurrency)(s?.prices.msrp||0)," each",l&&(0,t.jsxs)("span",{className:"text-red-400 ml-2",children:[(0,t.jsx)("i",{className:"fas fa-exclamation-triangle mr-1"}),"Insufficient stock"]})]})]}),(0,t.jsxs)("div",{className:"text-right mr-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-blue-400",children:(0,d.formatCurrency)(r)}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"subtotal"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>es(e.productId,e.quantity-1),className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded",children:"-"}),(0,t.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>es(e.productId,parseInt(t.target.value)||1),className:"w-16 bg-slate-700 border border-slate-600 rounded-lg px-2 py-1.5 text-white text-center text-sm"}),(0,t.jsx)("button",{type:"button",onClick:()=>es(e.productId,e.quantity+1),className:"w-8 h-8 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded",children:"+"})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.productId,void q(e=>e.filter(e=>e.productId!==t))},className:"p-2 text-slate-500 hover:text-red-400",children:(0,t.jsx)("i",{className:"fas fa-trash"})})]},e.productId)})}):(0,t.jsxs)("div",{className:"p-6 border-2 border-dashed border-slate-700 rounded-lg text-center text-slate-400 mb-4",children:[(0,t.jsx)("i",{className:"fas fa-cubes text-2xl mb-2"}),(0,t.jsx)("p",{children:"No components added yet"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Search for products above to add them"})]}),D.length>0&&(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Bundle Cost"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:(0,d.formatCurrency)(ee.cost)})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Margin"}),(0,t.jsxs)("div",{className:`text-lg font-bold ${ee.margin>=50?"text-emerald-400":ee.margin>=30?"text-amber-400":"text-red-400"}`,children:[ee.margin.toFixed(1),"%"]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Can Build"}),(0,t.jsx)("div",{className:`text-lg font-bold ${ee.availableQty>10?"text-emerald-400":ee.availableQty>0?"text-amber-400":"text-red-400"}`,children:(0,d.formatNumber)(ee.availableQty)}),ee.limitingComponent&&ee.availableQty<10&&(0,t.jsxs)("div",{className:"text-xs text-slate-500 truncate",children:["Limited by: ",ee.limitingComponent]})]})]})]}),"virtual"!==j&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Assembly Instructions"}),(0,t.jsx)("textarea",{value:_,onChange:e=>P(e.target.value),rows:3,placeholder:"Instructions for assembling this bundle...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]})]})})}e.s(["BundleModal",()=>n],19016);var o=e.i(29618);function c({isOpen:e,onClose:n,bundle:c,onEdit:m}){let{state:u,dispatch:x}=(0,r.useApp)(),{success:p}=(0,i.useToast)(),h=(0,o.useConfirm)(),b=e=>u.inventory.filter(t=>t.productId===e).reduce((e,t)=>e+t.quantity,0),g=(0,s.useMemo)(()=>{if(!c)return{cost:0,margin:0,availableQty:0,limitingComponent:""};let e=c.components.reduce((e,t)=>{let s=u.products.find(e=>e.id===t.productId);return e+(s?.cost.rolling||0)*t.quantity},0),t=c.prices.msrp>0?(c.prices.msrp-e)/c.prices.msrp*100:0,s=c.components.length>0?Math.min(...c.components.map(e=>Math.floor(b(e.productId)/e.quantity))):0,a="";if(c.components.length>0){let e=1/0;c.components.forEach(t=>{let s=Math.floor(b(t.productId)/t.quantity);s<e&&(e=s,a=t.productName)})}return{cost:e,margin:t,availableQty:s,limitingComponent:a}},[c,u.products,u.inventory]),f=async()=>{!c||await h({title:"Delete Bundle",message:`Are you sure you want to delete "${c.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",destructive:!0})&&(x({type:"DELETE_BUNDLE",payload:c.id}),p(`Bundle "${c.name}" deleted`),n())};return c?(0,t.jsx)(a.Modal,{open:e,onClose:n,title:c.name,subtitle:`SKU: ${c.sku}`,size:"lg",footer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Button,{variant:"secondary",onClick:f,children:[(0,t.jsx)("i",{className:"fas fa-trash mr-2"}),"Delete"]}),(0,t.jsxs)(l.Button,{onClick:m,children:[(0,t.jsx)("i",{className:"fas fa-edit mr-2"}),"Edit Bundle"]})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(e=>{switch(e){case"virtual":return(0,t.jsxs)("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 text-xs rounded-full border border-blue-500/20",children:[(0,t.jsx)("i",{className:"fas fa-cloud mr-1"}),"Virtual"]});case"physical":return(0,t.jsxs)("span",{className:"px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full border border-emerald-500/20",children:[(0,t.jsx)("i",{className:"fas fa-box mr-1"}),"Physical"]});case"fba_kit":return(0,t.jsxs)("span",{className:"px-2 py-1 bg-orange-500/20 text-orange-400 text-xs rounded-full border border-orange-500/20",children:[(0,t.jsx)("i",{className:"fab fa-amazon mr-1"}),"FBA Kit"]})}})(c.type),(0,t.jsx)("span",{className:`px-2 py-1 text-xs rounded-full ${g.availableQty>10?"bg-emerald-500/10 text-emerald-400":g.availableQty>0?"bg-amber-500/10 text-amber-400":"bg-red-500/10 text-red-400"}`,children:g.availableQty>10?"In Stock":g.availableQty>0?"Limited":"Out of Stock"})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Can Build"}),(0,t.jsx)("div",{className:`text-2xl font-bold ${g.availableQty>10?"text-emerald-400":g.availableQty>0?"text-amber-400":"text-red-400"}`,children:(0,d.formatNumber)(g.availableQty)})]})]}),c.description&&(0,t.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-slate-300 text-sm",children:c.description})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Pricing"}),(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-3",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"MSRP"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:(0,d.formatCurrency)(c.prices.msrp)})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Shopify"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:(0,d.formatCurrency)(c.prices.shopify)})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Amazon"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:(0,d.formatCurrency)(c.prices.amazon)})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Wholesale"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:(0,d.formatCurrency)(c.prices.wholesale)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Cost & Margin"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Component Cost"}),(0,t.jsx)("div",{className:"text-xl font-bold text-white",children:(0,d.formatCurrency)(g.cost)})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Profit per Bundle"}),(0,t.jsx)("div",{className:"text-xl font-bold text-emerald-400",children:(0,d.formatCurrency)(c.prices.msrp-g.cost)})]}),(0,t.jsxs)("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-4 text-center",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 mb-1",children:"Margin"}),(0,t.jsxs)("div",{className:"text-xl font-bold text-emerald-400",children:[g.margin.toFixed(1),"%"]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-white mb-3",children:["Components (",c.components.length,")"]}),(0,t.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-left text-xs text-slate-400 uppercase",children:[(0,t.jsx)("th",{className:"px-4 py-3 font-medium",children:"Product"}),(0,t.jsx)("th",{className:"px-4 py-3 font-medium text-center",children:"Qty per Bundle"}),(0,t.jsx)("th",{className:"px-4 py-3 font-medium text-right",children:"Available Stock"}),(0,t.jsx)("th",{className:"px-4 py-3 font-medium text-right",children:"Unit Cost"}),(0,t.jsx)("th",{className:"px-4 py-3 font-medium text-right",children:"Line Total"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:c.components.map(e=>{let s=u.products.find(t=>t.id===e.productId),a=b(e.productId),l=s?.cost.rolling||0,r=l*e.quantity,i=a<e.quantity;return(0,t.jsxs)("tr",{className:"hover:bg-slate-700/30",children:[(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${i?"bg-red-400":"bg-emerald-400"}`}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white",children:e.productName}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:s?.sku||"Unknown SKU"})]})]})}),(0,t.jsxs)("td",{className:"px-4 py-3 text-center text-white",children:["x ",e.quantity]}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsxs)("span",{className:i?"text-red-400":"text-slate-300",children:[(0,d.formatNumber)(a),i&&(0,t.jsx)("i",{className:"fas fa-exclamation-triangle ml-1 text-xs"})]})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right text-slate-400",children:(0,d.formatCurrency)(l)}),(0,t.jsx)("td",{className:"px-4 py-3 text-right text-white",children:(0,d.formatCurrency)(r)})]},e.productId)})}),(0,t.jsx)("tfoot",{className:"bg-slate-800/30 border-t border-slate-700",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{colSpan:4,className:"px-4 py-3 text-right text-sm font-medium text-slate-400",children:"Total Component Cost:"}),(0,t.jsx)("td",{className:"px-4 py-3 text-right text-lg font-bold text-white",children:(0,d.formatCurrency)(g.cost)})]})})]})}),g.availableQty<10&&g.limitingComponent&&(0,t.jsx)("div",{className:"mt-3 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-amber-400 text-sm",children:[(0,t.jsx)("i",{className:"fas fa-exclamation-triangle"}),(0,t.jsxs)("span",{children:["Limiting component: ",(0,t.jsx)("strong",{children:g.limitingComponent})]})]})})]}),"virtual"!==c.type&&c.assemblyInstructions&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Assembly Instructions"}),(0,t.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-slate-300 text-sm whitespace-pre-wrap",children:c.assemblyInstructions})})]})]})}):null}e.s(["BundleDetailModal",()=>c],92470),e.i(93046);let m=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"],u=["US","CA","MX","UK","AU"];function x({isOpen:e,onClose:n,order:o}){let{state:c,dispatch:x}=(0,r.useApp)(),{success:p,error:h}=(0,i.useToast)(),[b,g]=(0,s.useState)("customer"),[f,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),[C,k]=(0,s.useState)(""),[S,I]=(0,s.useState)(""),[A,_]=(0,s.useState)(""),[P,D]=(0,s.useState)(""),[q,R]=(0,s.useState)("US"),[T,O]=(0,s.useState)(!0),[$,M]=(0,s.useState)(""),[U,E]=(0,s.useState)(""),[F,L]=(0,s.useState)(""),[B,z]=(0,s.useState)(""),[Q,W]=(0,s.useState)("US"),[K,H]=(0,s.useState)([]),[V,G]=(0,s.useState)("0"),[Y,X]=(0,s.useState)("0"),[J,Z]=(0,s.useState)("0"),[ee,et]=(0,s.useState)("");(0,s.useEffect)(()=>{e&&o&&(j(o.customer.name),N(o.customer.email),w(o.customer.phone||""),k(o.customer.address.street),I(o.customer.address.city),_(o.customer.address.state),D(o.customer.address.zip),R(o.customer.address.country),o.billingAddress?(O(!1),M(o.billingAddress.street),E(o.billingAddress.city),L(o.billingAddress.state),z(o.billingAddress.zip),W(o.billingAddress.country)):O(!0),H(o.items.map(e=>({productId:e.productId,productName:e.productName,sku:e.sku,quantity:e.quantity,price:e.price,cost:e.cost}))),G(o.shipping.toString()),X(o.tax.toString()),Z(o.discount.toString()),et(o.notes||""))},[e,o]);let es=(0,s.useMemo)(()=>K.reduce((e,t)=>e+t.price*t.quantity,0),[K]),ea=(0,s.useMemo)(()=>K.reduce((e,t)=>e+t.cost*t.quantity,0),[K]),el=(0,s.useMemo)(()=>es+parseFloat(V||"0")+parseFloat(Y||"0")-parseFloat(J||"0"),[es,V,Y,J]),er=el-ea,ei=el>0?er/el*100:0,ed=(e,t)=>{H(s=>s.map((s,a)=>a===e?{...s,quantity:Math.max(1,t)}:s))};return(0,t.jsx)(a.Modal,{open:e,onClose:n,title:`Edit Order #${o.orderNumber}`,size:"xl",children:(0,t.jsxs)("div",{className:"flex flex-col h-[600px]",children:[(0,t.jsx)("div",{className:"flex border-b border-slate-700 mb-4",children:[{id:"customer",label:"Customer",icon:"fa-user"},{id:"shipping",label:"Shipping",icon:"fa-truck"},{id:"billing",label:"Billing",icon:"fa-credit-card"},{id:"items",label:"Items",icon:"fa-box"},{id:"notes",label:"Notes",icon:"fa-sticky-note"}].map(e=>(0,t.jsxs)("button",{onClick:()=>g(e.id),className:`px-4 py-2 text-sm font-medium transition-colors flex items-center gap-2 ${b===e.id?"text-emerald-400 border-b-2 border-emerald-400":"text-slate-400 hover:text-white"}`,children:[(0,t.jsx)("i",{className:`fas ${e.icon}`}),e.label]},e.id))}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["customer"===b&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Customer Name *"}),(0,t.jsx)("input",{type:"text",value:f,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"John Doe"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Email *"}),(0,t.jsx)("input",{type:"email",value:v,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"john@example.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Phone"}),(0,t.jsx)("input",{type:"tel",value:y,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"+1 555-0123"})]})]})]}),"shipping"===b&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Street Address *"}),(0,t.jsx)("input",{type:"text",value:C,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"123 Main St"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"City *"}),(0,t.jsx)("input",{type:"text",value:S,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"Houston"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"State *"}),(0,t.jsxs)("select",{value:A,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"Select state"}),m.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"ZIP Code *"}),(0,t.jsx)("input",{type:"text",value:P,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",placeholder:"77001"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Country"}),(0,t.jsx)("select",{value:q,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-700",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Shipping Cost"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-3 top-2 text-slate-400",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",value:V,onChange:e=>G(e.target.value),className:"w-full pl-7 pr-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"})]})]})})]}),"billing"===b&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:T,onChange:e=>O(e.target.checked),className:"rounded bg-slate-700 border-slate-600 text-emerald-500 focus:ring-emerald-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Same as shipping address"})]}),!T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Street Address"}),(0,t.jsx)("input",{type:"text",value:$,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"City"}),(0,t.jsx)("input",{type:"text",value:U,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"State"}),(0,t.jsxs)("select",{value:F,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"Select state"}),m.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"ZIP Code"}),(0,t.jsx)("input",{type:"text",value:B,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Country"}),(0,t.jsx)("select",{value:Q,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:u.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]})]})]})]}),"items"===b&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Add Product"}),(0,t.jsxs)("select",{onChange:e=>{e.target.value&&((e=>{let t=c.products.find(t=>t.id===e);if(!t)return;let s=K.findIndex(t=>t.productId===e);s>=0?ed(s,K[s].quantity+1):H(e=>[...e,{productId:t.id,productName:t.name,sku:t.sku,quantity:1,price:t.prices.shopify,cost:t.cost.rolling}])})(e.target.value),e.target.value="")},className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"Select product to add..."}),c.products.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.sku,")"]},e.id))]})]}),(0,t.jsx)("div",{className:"space-y-2",children:K.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-slate-800/50 border border-slate-700 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-white",children:e.productName}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:e.sku})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-slate-400",children:"Qty:"}),(0,t.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:e=>ed(s,parseInt(e.target.value)||1),className:"w-16 px-2 py-1 bg-slate-700 border border-slate-600 rounded text-white text-sm text-center"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-slate-400",children:"Price:"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("span",{className:"absolute left-2 top-1 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:e.price,onChange:e=>{var t;return t=parseFloat(e.target.value)||0,void H(e=>e.map((e,a)=>a===s?{...e,price:Math.max(0,t)}:e))},className:"w-20 pl-5 pr-2 py-1 bg-slate-700 border border-slate-600 rounded text-white text-sm text-right"})]})]}),(0,t.jsx)("div",{className:"text-sm font-medium text-white w-20 text-right",children:(0,d.formatCurrency)(e.price*e.quantity)}),(0,t.jsx)("button",{onClick:()=>{K.length<=1?h("Order must have at least one item"):H(e=>e.filter((e,t)=>t!==s))},className:"p-1 text-slate-400 hover:text-red-400",children:(0,t.jsx)("i",{className:"fas fa-trash text-sm"})})]},s))}),(0,t.jsxs)("div",{className:"pt-4 border-t border-slate-700 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Subtotal"}),(0,t.jsx)("span",{className:"text-white",children:(0,d.formatCurrency)(es)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm items-center",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Tax"}),(0,t.jsxs)("div",{className:"relative w-24",children:[(0,t.jsx)("span",{className:"absolute left-2 top-1 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",value:Y,onChange:e=>X(e.target.value),className:"w-full pl-5 pr-2 py-1 bg-slate-700 border border-slate-600 rounded text-white text-sm text-right"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm items-center",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Discount"}),(0,t.jsxs)("div",{className:"relative w-24",children:[(0,t.jsx)("span",{className:"absolute left-2 top-1 text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",value:J,onChange:e=>Z(e.target.value),className:"w-full pl-5 pr-2 py-1 bg-slate-700 border border-slate-600 rounded text-white text-sm text-right"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-slate-600",children:[(0,t.jsx)("span",{className:"text-white",children:"Total"}),(0,t.jsx)("span",{className:"text-white",children:(0,d.formatCurrency)(el)})]})]})]}),"notes"===b&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Order Notes"}),(0,t.jsx)("textarea",{value:ee,onChange:e=>et(e.target.value),rows:6,className:"w-full px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500 resize-none",placeholder:"Internal notes about this order..."})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-slate-700 mt-4",children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Cancel"}),(0,t.jsxs)(l.Button,{onClick:()=>{if(!f.trim())return void h("Customer name is required");if(!v.trim())return void h("Customer email is required");if(0===K.length)return void h("Order must have at least one item");let e={...o,customer:{name:f,email:v,phone:y||void 0,address:{street:C,city:S,state:A,zip:P,country:q}},billingAddress:T?void 0:{street:$,city:U,state:F,zip:B,country:Q},items:K.map(e=>({...e,picked:o.items.find(t=>t.productId===e.productId)?.picked||!1})),subtotal:es,shipping:parseFloat(V||"0"),tax:parseFloat(Y||"0"),discount:parseFloat(J||"0"),total:el,cogs:ea,profit:er,margin:ei,notes:ee||void 0,updatedAt:new Date};x({type:"UPDATE_ORDER",payload:e}),p("Order updated successfully"),n()},children:[(0,t.jsx)("i",{className:"fas fa-save mr-2"}),"Save Changes"]})]})]})})}e.s(["EditOrderModal",()=>x],47086);var p=e.i(55436),h=e.i(27612),b=e.i(88844);function g({isOpen:e,onClose:n,editPO:o,initialItems:c}){let{state:m,dispatch:u}=(0,r.useApp)(),{success:x,error:g}=(0,i.useToast)(),[f,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(""),[y,w]=(0,s.useState)("USD"),[C,k]=(0,s.useState)(""),[S,I]=(0,s.useState)(""),[A,_]=(0,s.useState)("0"),[P,D]=(0,s.useState)([]),[q,R]=(0,s.useState)(!1),[T,O]=(0,s.useState)(""),[$,M]=(0,s.useState)(!1),[U,E]=(0,s.useState)(""),[F,L]=(0,s.useState)(!1),B=!!o,z=(0,s.useMemo)(()=>{let e=new Set;return m.purchaseOrders.forEach(t=>{t.supplier&&e.add(t.supplier)}),m.products.forEach(t=>{t.supplier&&e.add(t.supplier)}),Array.from(e).sort()},[m.purchaseOrders,m.products]),Q=(0,s.useMemo)(()=>{if(!U.trim())return z.slice(0,5);let e=U.toLowerCase();return z.filter(t=>t.toLowerCase().includes(e)).slice(0,5)},[U,z]);(0,s.useEffect)(()=>{if(e){if(o)j(o.poNumber),N(o.supplier),w(o.currency),k(o.expectedDate?new Date(o.expectedDate).toISOString().split("T")[0]:""),I(o.notes||""),_(o.shipping.toString()),D([...o.items]);else{let e;j((e=m.purchaseOrders.length+1,`PO-${new Date().getFullYear()}-${e.toString().padStart(4,"0")}`)),N(""),w("USD"),k(""),I(""),_("0"),D(c||[])}O(""),E("")}},[e,o,c]);let W=(0,s.useMemo)(()=>{if(!T.trim())return[];let e=T.toLowerCase();return m.products.filter(t=>(t.name.toLowerCase().includes(e)||t.sku.toLowerCase().includes(e))&&!P.some(e=>e.productId===t.id)).slice(0,8)},[T,m.products,P]),K=(0,s.useMemo)(()=>{let e=P.reduce((e,t)=>e+t.quantity*t.unitCost,0),t=parseFloat(A)||0;return{subtotal:e,shipping:t,total:e+t,itemCount:P.length,unitCount:P.reduce((e,t)=>e+t.quantity,0)}},[P,A]),H=(e,t,s)=>{s<0||D(a=>a.map(a=>a.productId===e?{...a,[t]:s}:a))},V=(0,s.useMemo)(()=>!(!f.trim()||!v.trim()||0===P.length||P.some(e=>e.quantity<=0||e.unitCost<0)),[f,v,P]);return(0,t.jsx)(a.Modal,{open:e,onClose:n,title:B?"Edit Purchase Order":"Create Purchase Order",subtitle:B?`Editing ${o?.poNumber}`:"Order inventory from suppliers",size:"xl",footer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Cancel"}),(0,t.jsx)(l.Button,{variant:"secondary",onClick:()=>{if(V){R(!0);try{let e={id:o?.id||crypto.randomUUID(),poNumber:f.trim(),supplier:v.trim(),status:"draft",currency:y,expectedDate:C?new Date(C):void 0,items:P,subtotal:K.subtotal,shipping:K.shipping,total:K.total,notes:S.trim()||void 0,createdAt:o?.createdAt||new Date,updatedAt:new Date};B?(u({type:"UPDATE_PURCHASE_ORDER",payload:e}),x(`PO ${f} updated successfully`)):(u({type:"ADD_PURCHASE_ORDER",payload:e}),x(`PO ${f} saved as draft`)),n()}catch(e){g("Failed to save purchase order")}finally{R(!1)}}},disabled:q||!V,children:"Save as Draft"}),(0,t.jsx)(l.Button,{onClick:()=>{if(V){R(!0);try{let e={id:o?.id||crypto.randomUUID(),poNumber:f.trim(),supplier:v.trim(),status:"sent",currency:y,expectedDate:C?new Date(C):void 0,items:P,subtotal:K.subtotal,shipping:K.shipping,total:K.total,notes:S.trim()||void 0,createdAt:o?.createdAt||new Date,updatedAt:new Date};B?u({type:"UPDATE_PURCHASE_ORDER",payload:e}):u({type:"ADD_PURCHASE_ORDER",payload:e}),x(`PO ${f} created and marked as sent`),n()}catch(e){g("Failed to create purchase order")}finally{R(!1)}}},disabled:q||!V,children:q?"Saving...":B?"Save Changes":"Create & Send"})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"PO Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"PO Number *"}),(0,t.jsx)("input",{type:"text",value:f,onChange:e=>j(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white font-mono focus:outline-none focus:border-emerald-500/50"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Supplier *"}),(0,t.jsx)("input",{type:"text",value:v,onChange:e=>{N(e.target.value),E(e.target.value),L(!0)},onFocus:()=>L(!0),onBlur:()=>setTimeout(()=>L(!1),200),placeholder:"Enter supplier name",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),F&&Q.length>0&&(0,t.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-40 overflow-auto",children:Q.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{N(e),L(!1)},className:"w-full px-4 py-2 text-left text-sm text-white hover:bg-slate-700/50",children:e},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Currency"}),(0,t.jsxs)("select",{value:y,onChange:e=>w(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"USD",children:"USD ($)"}),(0,t.jsx)("option",{value:"CAD",children:"CAD (C$)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Expected Date"}),(0,t.jsx)("input",{type:"date",value:C,onChange:e=>k(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Line Items *"}),(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)(p.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),(0,t.jsx)("input",{type:"text",value:T,onChange:e=>{O(e.target.value),M(!0)},onFocus:()=>M(!0),placeholder:"Search products by name or SKU...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),$&&W.length>0&&(0,t.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-slate-800 border border-slate-700 rounded-lg shadow-lg max-h-48 overflow-auto",children:W.map(e=>{let s,a=(s=e.id,m.inventory.filter(e=>e.productId===s).reduce((e,t)=>e+t.quantity,0));return(0,t.jsxs)("button",{type:"button",onClick:()=>{var t;let s;return t=e.id,void((s=m.products.find(e=>e.id===t))&&(D(e=>[...e,{productId:s.id,productName:s.name,sku:s.sku,quantity:1,receivedQty:0,unitCost:s.cost.rolling}]),O(""),M(!1)))},className:"w-full px-4 py-2.5 flex items-center justify-between hover:bg-slate-700/50 text-left",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-white",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-slate-400",children:["SKU: ",e.sku]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-sm text-slate-300",children:(0,d.formatCurrencyPrecise)(e.cost.rolling)}),(0,t.jsxs)("div",{className:`text-xs ${a<=e.reorderPoint?"text-amber-400":"text-slate-400"}`,children:[(0,d.formatNumber)(a)," in stock"]})]})]},e.id)})})]}),P.length>0?(0,t.jsx)("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-xs text-slate-400 uppercase tracking-wider",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Product"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"SKU"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Qty"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"Unit Cost"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"Line Total"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center w-12"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:P.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-slate-800/30",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white",children:e.productName}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-slate-400 font-mono",children:e.sku}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>H(e.productId,"quantity",parseInt(t.target.value)||0),className:"w-20 mx-auto block bg-slate-700 border border-slate-600 rounded px-2 py-1 text-white text-center text-sm"})}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,t.jsx)("span",{className:"text-slate-400 text-sm",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:e.unitCost,onChange:t=>H(e.productId,"unitCost",parseFloat(t.target.value)||0),className:"w-24 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-white text-right text-sm"})]})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white text-right font-medium",children:(0,d.formatCurrencyPrecise)(e.quantity*e.unitCost)}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:(0,t.jsx)("button",{onClick:()=>{var t;return t=e.productId,void D(e=>e.filter(e=>e.productId!==t))},className:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded",children:(0,t.jsx)(h.Trash2,{className:"w-4 h-4"})})})]},e.productId))})]})}):(0,t.jsxs)("div",{className:"p-8 border-2 border-dashed border-slate-700 rounded-lg text-center text-slate-400",children:[(0,t.jsx)(b.Package,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No items added yet"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Search for products above to add them"})]})]}),P.length>0&&(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)("div",{className:"w-72 space-y-2 bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Items:"}),(0,t.jsxs)("span",{className:"text-white",children:[K.itemCount," (",(0,d.formatNumber)(K.unitCount)," units)"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Subtotal:"}),(0,t.jsx)("span",{className:"text-white",children:(0,d.formatCurrencyPrecise)(K.subtotal)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Shipping:"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-slate-400",children:"$"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:A,onChange:e=>_(e.target.value),className:"w-24 bg-slate-700 border border-slate-600 rounded px-2 py-1 text-white text-right text-sm"})]})]}),(0,t.jsxs)("div",{className:"pt-2 border-t border-slate-700 flex justify-between",children:[(0,t.jsx)("span",{className:"text-white font-medium",children:"Total:"}),(0,t.jsx)("span",{className:"text-white font-bold text-lg",children:(0,d.formatCurrencyPrecise)(K.total)})]}),"CAD"===y&&(0,t.jsx)("div",{className:"text-xs text-slate-500 text-right",children:"CAD values will be converted at current exchange rate"})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{value:S,onChange:e=>I(e.target.value),rows:2,placeholder:"Optional notes for this PO...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]})]})})}e.s(["CreatePOModal",()=>g],54006);var f=e.i(43531),j=e.i(78894),v=e.i(88081),N=e.i(75254);let y=(0,N.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);var w=e.i(37727),C=e.i(52008),k=e.i(87316);function S({isOpen:e,onClose:n,po:o}){let{state:c,dispatch:m}=(0,r.useApp)(),{success:u,error:x,warning:p}=(0,i.useToast)(),[h,b]=(0,s.useState)([]),[g,N]=(0,s.useState)(""),[S,I]=(0,s.useState)(""),[A,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)({}),[q,R]=(0,s.useState)({}),[T,O]=(0,s.useState)({}),[$,M]=(0,s.useState)({}),[U,E]=(0,s.useState)({lotNumber:"",quantity:0});(0,s.useEffect)(()=>{if(e&&o){b(o.items.map(e=>({productId:e.productId,productName:e.productName,sku:e.sku,ordered:e.quantity,previouslyReceived:e.receivedQty,receivingNow:e.quantity-e.receivedQty,condition:"good"}))),N(""),D({}),R({}),O({}),M({}),E({lotNumber:"",quantity:0});let e=c.locations.find(e=>e.isDefault);I(e?.id||c.locations[0]?.id||"")}},[e,o,c.locations]);let F=e=>c.products.find(t=>t.id===e),L=e=>{let t=F(e);return t?.trackSerials===!0},B=(e,t)=>{t.trim()&&((P[e]||[]).includes(t.trim())?p("Serial number already entered"):(D(s=>({...s,[e]:[...s[e]||[],t.trim()]})),R(t=>({...t,[e]:""}))))},z=e=>{let t=F(e);return t?.trackLots===!0},Q=e=>(T[e]||[]).reduce((e,t)=>e+t.quantity,0),W=(0,s.useMemo)(()=>{let e=h.reduce((e,t)=>e+t.ordered,0),t=h.reduce((e,t)=>e+t.previouslyReceived,0),s=h.reduce((e,t)=>e+t.receivingNow,0),a=t+s;return{totalOrdered:e,totalPreviouslyReceived:t,totalReceivingNow:s,totalAfter:a,percentComplete:e>0?a/e*100:0,willBeFullyReceived:a>=e}},[h]),K=(0,s.useMemo)(()=>h.some(e=>"good"!==e.condition&&e.receivingNow>0),[h]);return o?(0,t.jsx)(a.Modal,{open:e,onClose:n,title:"Receive Items",subtitle:`${o.poNumber} from ${o.supplier}`,size:"xl",footer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:()=>{if(o&&!(W.totalReceivingNow<=0)){_(!0);try{let e=o.items.map(e=>{let t=h.find(t=>t.productId===e.productId);return{...e,receivedQty:e.receivedQty+(t?.receivingNow||0)}}),t=e.every(e=>e.receivedQty>=e.quantity),s=o.status;t?s="received":e.some(e=>e.receivedQty>0)&&(s="partial");let a={...o,items:e,status:s,updatedAt:new Date};m({type:"UPDATE_PURCHASE_ORDER",payload:a});let l=c.locations.find(e=>e.id===S)?.name||"";h.forEach(e=>{if(e.receivingNow>0&&"good"===e.condition){if(m({type:"ADJUST_STOCK",payload:{productId:e.productId,locationId:S,adjustment:e.receivingNow}}),L(e.productId)){let t=(P[e.productId]||[]).map(t=>({id:crypto.randomUUID(),serial:t,productId:e.productId,productName:e.productName,sku:e.sku,status:"in_stock",locationId:S,locationName:l,purchaseOrderId:o.id,receivedAt:new Date}));t.length>0&&m({type:"ADD_SERIAL_NUMBERS",payload:t})}if(z(e.productId)){let t=(T[e.productId]||[]).map(t=>({id:crypto.randomUUID(),lotNumber:t.lotNumber,productId:e.productId,productName:e.productName,sku:e.sku,quantity:t.quantity,reservedQty:0,expirationDate:t.expirationDate?new Date(t.expirationDate):void 0,manufacturedDate:t.manufacturedDate?new Date(t.manufacturedDate):void 0,receivedDate:new Date,status:"active",locationId:S,locationName:l,purchaseOrderId:o.id,supplierLotNumber:t.supplierLotNumber,notes:t.notes}));t.length>0&&m({type:"ADD_LOTS",payload:t})}}}),K?p(`Received ${(0,d.formatNumber)(W.totalReceivingNow)} units with some issues noted`):t?u(`PO ${o.poNumber} fully received! ${(0,d.formatNumber)(W.totalReceivingNow)} units added to inventory`):u(`Received ${(0,d.formatNumber)(W.totalReceivingNow)} units on PO ${o.poNumber}`),n()}catch(e){x("Failed to receive items")}finally{_(!1)}}},disabled:A||W.totalReceivingNow<=0,children:A?"Processing...":(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Check,{className:"w-4 h-4"}),"Receive ",(0,d.formatNumber)(W.totalReceivingNow)," Units"]})})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-400",children:"PO Number:"}),(0,t.jsx)("span",{className:"ml-2 text-white font-mono",children:o.poNumber})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Supplier:"}),(0,t.jsx)("span",{className:"ml-2 text-white",children:o.supplier})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Expected:"}),(0,t.jsx)("span",{className:"ml-2 text-white",children:o.expectedDate?(0,d.formatDate)(o.expectedDate):"Not set"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-400",children:"Total Value:"}),(0,t.jsx)("span",{className:"ml-2 text-white font-medium",children:(0,d.formatCurrencyPrecise)(o.total)})]})]})}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-slate-400",children:"Receiving Progress"}),(0,t.jsxs)("span",{className:"text-sm text-white",children:[(0,d.formatNumber)(W.totalAfter)," / ",(0,d.formatNumber)(W.totalOrdered)," units (",W.percentComplete.toFixed(0),"%)"]})]}),(0,t.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2",children:(0,t.jsx)("div",{className:`h-2 rounded-full transition-all ${W.willBeFullyReceived?"bg-emerald-500":"bg-blue-500"}`,style:{width:`${Math.min(W.percentComplete,100)}%`}})}),W.willBeFullyReceived&&(0,t.jsxs)("p",{className:"text-xs text-emerald-400 mt-2",children:[(0,t.jsx)(f.Check,{className:"w-3 h-3 inline mr-1"}),"This will complete the PO"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Receive to Location"}),(0,t.jsx)("select",{value:S,onChange:e=>I(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:c.locations.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white",children:"Items to Receive"}),(0,t.jsx)("button",{onClick:()=>{b(e=>e.map(e=>({...e,receivingNow:e.ordered-e.previouslyReceived,condition:"good"})))},className:"text-sm text-emerald-400 hover:text-emerald-300",children:"Receive All Remaining"})]}),(0,t.jsx)("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-xs text-slate-400 uppercase tracking-wider",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Product"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Ordered"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Previously Received"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Receiving Now"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Condition"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:h.map(e=>{let s,a=e.ordered-e.previouslyReceived,l=a<=0,r=L(e.productId),i=z(e.productId),n=P[e.productId]||[],o=q[e.productId]||"";return(0,t.jsxs)("tr",{className:`${l?"bg-emerald-500/5":"hover:bg-slate-800/30"}`,children:[(0,t.jsxs)("td",{className:"px-4 py-3",colSpan:r&&!l&&e.receivingNow>0?1:void 0,children:[(0,t.jsx)("div",{className:"text-sm text-white",children:e.productName}),(0,t.jsxs)("div",{className:"text-xs text-slate-400 font-mono",children:[e.sku,r&&(0,t.jsxs)("span",{className:"ml-2 text-purple-400",children:[(0,t.jsx)(v.Hash,{className:"w-3 h-3 inline"})," Serial Tracked"]}),i&&(0,t.jsxs)("span",{className:"ml-2 text-purple-400",children:[(0,t.jsx)(C.Layers,{className:"w-3 h-3 inline"})," Lot Tracked"]})]}),r&&!l&&e.receivingNow>0&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-slate-800/50 rounded-lg border border-slate-700/50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-xs text-slate-400",children:["Serial Numbers (",n.length," / ",e.receivingNow,")"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>((e,t)=>{let s=F(e);if(!s)return;let a=[],l=s.serialNextNumber||1;for(let e=0;e<t;e++){let e=`${s.serialPrefix||""}${String(l).padStart(4,"0")}${s.serialSuffix||""}`;a.push(e),l++}D(t=>({...t,[e]:a})),m({type:"UPDATE_PRODUCT",payload:{...s,serialNextNumber:l,updatedAt:new Date}})})(e.productId,e.receivingNow),className:"text-xs text-emerald-400 hover:text-emerald-300 flex items-center gap-1",children:[(0,t.jsx)(y,{className:"w-3 h-3"}),"Auto-Generate"]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)("input",{type:"text",value:o,onChange:t=>R(s=>({...s,[e.productId]:t.target.value})),onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),B(e.productId,o))},placeholder:"Enter or scan serial...",className:"flex-1 bg-slate-700 border border-slate-600 rounded px-3 py-1.5 text-sm text-white placeholder-slate-500 font-mono"}),(0,t.jsx)("button",{type:"button",onClick:()=>B(e.productId,o),className:"px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-sm rounded transition-colors",children:"Add"})]}),n.length>0&&(0,t.jsx)("div",{className:"max-h-24 overflow-y-auto space-y-1",children:n.map((s,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between px-2 py-1 bg-slate-700/50 rounded text-xs",children:[(0,t.jsx)("span",{className:"font-mono text-white",children:s}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.productId,void D(e=>({...e,[t]:(e[t]||[]).filter((e,t)=>t!==a)}))},className:"text-red-400 hover:text-red-300",children:(0,t.jsx)(w.X,{className:"w-3 h-3"})})]},a))}),n.length!==e.receivingNow&&(0,t.jsxs)("div",{className:"mt-2 text-xs text-amber-400 flex items-center gap-1",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-3 h-3"}),n.length<e.receivingNow?`Need ${e.receivingNow-n.length} more serial(s)`:`${n.length-e.receivingNow} extra serial(s)`]})]}),i&&!l&&e.receivingNow>0&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-purple-900/20 rounded-lg border border-purple-500/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-xs text-slate-400 flex items-center gap-1",children:[(0,t.jsx)(C.Layers,{className:"w-3 h-3 text-purple-400"}),"Lot Numbers (",Q(e.productId)," / ",e.receivingNow," units)"]}),(0,t.jsxs)("button",{type:"button",onClick:()=>{E({lotNumber:(e=>{let t=F(e);if(!t)return"";let s=t.lotPrefix||"LOT-",a=new Date().toISOString().slice(0,10).replace(/-/g,""),l=t.lotNextNumber||1;return`${s}${a}-${String(l).padStart(3,"0")}`})(e.productId),quantity:e.receivingNow-Q(e.productId)}),M(t=>({...t,[e.productId]:!0}))},className:"text-xs text-purple-400 hover:text-purple-300 flex items-center gap-1",children:[(0,t.jsx)(y,{className:"w-3 h-3"}),"Add Lot"]})]}),(T[e.productId]||[]).map((s,a)=>(0,t.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-slate-700/50 rounded mb-1 text-xs",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-mono text-white",children:s.lotNumber}),(0,t.jsxs)("span",{className:"text-slate-400 ml-2",children:["x",s.quantity]}),s.expirationDate&&(0,t.jsxs)("span",{className:"text-amber-400 ml-2 flex items-center gap-1 inline-flex",children:[(0,t.jsx)(k.Calendar,{className:"w-3 h-3"}),"Exp: ",s.expirationDate]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.productId,void O(e=>({...e,[t]:(e[t]||[]).filter((e,t)=>t!==a)}))},className:"text-red-400 hover:text-red-300",children:(0,t.jsx)(w.X,{className:"w-3 h-3"})})]},a)),$[e.productId]&&(0,t.jsxs)("div",{className:"mt-2 p-3 bg-slate-800/50 rounded-lg space-y-2",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Lot Number"}),(0,t.jsx)("input",{type:"text",value:U.lotNumber,onChange:e=>E(t=>({...t,lotNumber:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-sm text-white font-mono"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Quantity"}),(0,t.jsx)("input",{type:"number",min:"1",value:U.quantity,onChange:e=>E(t=>({...t,quantity:parseInt(e.target.value)||0})),className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-sm text-white"})]})]}),(s=F(e.productId),s?.expirationTracking===!0&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Expiration Date"}),(0,t.jsx)("input",{type:"date",value:U.expirationDate||"",onChange:e=>E(t=>({...t,expirationDate:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-sm text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Manufactured Date"}),(0,t.jsx)("input",{type:"date",value:U.manufacturedDate||"",onChange:e=>E(t=>({...t,manufacturedDate:e.target.value})),className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-sm text-white"})]})]})),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs text-slate-400 block mb-1",children:"Supplier Lot # (Optional)"}),(0,t.jsx)("input",{type:"text",value:U.supplierLotNumber||"",onChange:e=>E(t=>({...t,supplierLotNumber:e.target.value})),placeholder:"Manufacturer's lot number",className:"w-full bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-sm text-white placeholder-slate-500"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 mt-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>M(t=>({...t,[e.productId]:!1})),className:"px-3 py-1.5 text-sm text-slate-400 hover:text-white",children:"Cancel"}),(0,t.jsx)("button",{type:"button",onClick:()=>((e,t)=>{if(!t.lotNumber.trim()||t.quantity<=0)return;if((T[e]||[]).some(e=>e.lotNumber===t.lotNumber))return void p("Lot number already exists");O(s=>({...s,[e]:[...s[e]||[],{...t}]}));let s=F(e);s&&m({type:"UPDATE_PRODUCT",payload:{...s,lotNextNumber:(s.lotNextNumber||1)+1,updatedAt:new Date}}),E({lotNumber:"",quantity:0}),M(t=>({...t,[e]:!1}))})(e.productId,U),className:"px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded transition-colors",children:"Add Lot"})]})]}),Q(e.productId)!==e.receivingNow&&!$[e.productId]&&(0,t.jsxs)("div",{className:"mt-2 text-xs text-amber-400 flex items-center gap-1",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-3 h-3"}),Q(e.productId)<e.receivingNow?`Need ${e.receivingNow-Q(e.productId)} more units assigned to lots`:`${Q(e.productId)-e.receivingNow} extra units assigned`]})]})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-sm text-white align-top",children:(0,d.formatNumber)(e.ordered)}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-sm align-top",children:(0,t.jsx)("span",{className:e.previouslyReceived>0?"text-emerald-400":"text-slate-400",children:(0,d.formatNumber)(e.previouslyReceived)})}),(0,t.jsx)("td",{className:"px-4 py-3 align-top",children:l?(0,t.jsxs)("div",{className:"text-center text-sm text-emerald-400",children:[(0,t.jsx)(f.Check,{className:"w-4 h-4 inline mr-1"}),"Complete"]}):(0,t.jsx)("input",{type:"number",min:"0",max:a,value:e.receivingNow,onChange:t=>{var s,a;return s=e.productId,a=parseInt(t.target.value)||0,void b(e=>e.map(e=>{if(e.productId===s){let t=Math.max(0,Math.min(a,e.ordered-e.previouslyReceived));return{...e,receivingNow:t}}return e}))},className:"w-20 mx-auto block bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-white text-center text-sm"})}),(0,t.jsx)("td",{className:"px-4 py-3 align-top",children:!l&&e.receivingNow>0&&(0,t.jsxs)("select",{value:e.condition,onChange:t=>{var s,a;return s=e.productId,a=t.target.value,void b(e=>e.map(e=>e.productId===s?{...e,condition:a}:e))},className:`w-full bg-slate-700 border rounded px-2 py-1.5 text-sm ${"good"===e.condition?"border-slate-600 text-white":"border-amber-500/50 text-amber-400"}`,children:[(0,t.jsx)("option",{value:"good",children:"Good"}),(0,t.jsx)("option",{value:"damaged",children:"Damaged"}),(0,t.jsx)("option",{value:"wrong_item",children:"Wrong Item"}),(0,t.jsx)("option",{value:"short",children:"Short"})]})})]},e.productId)})})]})})]}),K&&(0,t.jsxs)("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 flex items-start gap-3",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-amber-400",children:"Issues Noted"}),(0,t.jsx)("div",{className:"text-sm text-slate-300 mt-1",children:"Some items are marked with condition issues. Items marked as damaged, wrong item, or short will still be received but the issues will be logged."})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Receiving Notes (Optional)"}),(0,t.jsx)("textarea",{value:g,onChange:e=>N(e.target.value),rows:2,placeholder:"Note any issues, discrepancies, or special handling...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]})]})}):null}function I({isOpen:e,onClose:n,editWO:o}){let{state:c,dispatch:m}=(0,r.useApp)(),{success:u,error:x}=(0,i.useToast)(),[p,h]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),[v,N]=(0,s.useState)("bundle"),[y,w]=(0,s.useState)("1"),[C,k]=(0,s.useState)("normal"),[S,I]=(0,s.useState)(""),[A,_]=(0,s.useState)(""),[P,D]=(0,s.useState)(!1),q=!!o,R=e=>c.inventory.filter(t=>t.productId===e).reduce((e,t)=>e+t.quantity,0);(0,s.useMemo)(()=>"bundle"===v?c.bundles.find(e=>e.id===b):c.products.find(e=>e.id===b),[b,v,c.bundles,c.products]);let T=(0,s.useMemo)(()=>{let e=parseInt(y)||0;if(!b||e<=0)return[];if("bundle"===v){let t=c.bundles.find(e=>e.id===b);return t?t.components.map(t=>{let s=c.products.find(e=>e.id===t.productId),a=R(t.productId),l=t.quantity*e;return{productId:t.productId,productName:t.productName||s?.name||"Unknown",sku:s?.sku||"",quantityRequired:l,quantityAvailable:a,isShort:a<l,shortBy:Math.max(0,l-a)}}):[]}let t=c.products.find(e=>e.id===b);return t?.components&&0!==t.components.length?t.components.map(t=>{let s=c.products.find(e=>e.id===t.productId),a=R(t.productId),l=t.quantity*e;return{productId:t.productId,productName:t.productName||s?.name||"Unknown",sku:s?.sku||"",quantityRequired:l,quantityAvailable:a,isShort:a<l,shortBy:Math.max(0,l-a)}}):[]},[b,v,y,c.bundles,c.products,c.inventory]),O=(0,s.useMemo)(()=>{if(0===T.length)return{canProduce:!0,maxProducible:parseInt(y)||0,shortComponents:[]};let e=T.filter(e=>e.isShort),t=0===e.length,s=1/0;return T.forEach(e=>{let t=e.quantityRequired/(parseInt(y)||1),a=Math.floor(e.quantityAvailable/t);s=Math.min(s,a)}),s===1/0&&(s=parseInt(y)||0),{canProduce:t,maxProducible:s,shortComponents:e}},[T,y]);(0,s.useEffect)(()=>{if(e)if(o)h(o.woNumber),g(o.outputProductId),w(o.quantityToProduce.toString()),k(o.priority),I(o.dueDate?new Date(o.dueDate).toISOString().split("T")[0]:""),_(o.notes||""),N(c.bundles.some(e=>e.id===o.outputProductId)?"bundle":"product");else{let e;h((e=c.workOrders.length+1,`WO-${e.toString().padStart(4,"0")}`)),g(""),N("bundle"),w("1"),k("normal"),I(""),_("")}},[e,o,c.bundles]);let $=(0,s.useMemo)(()=>!(!p.trim()||!b||!y||0>=parseInt(y)),[p,b,y]);return(0,t.jsx)(a.Modal,{open:e,onClose:n,title:q?"Edit Work Order":"Create Work Order",subtitle:q?`Editing ${o?.woNumber}`:"Schedule a production or assembly task",size:"lg",footer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:()=>{if($){D(!0);try{let e=parseInt(y)||0,t="bundle"===v?c.bundles.find(e=>e.id===b)?.name:c.products.find(e=>e.id===b)?.name,s=T.map(e=>({productId:e.productId,productName:e.productName,quantityRequired:e.quantityRequired,quantityUsed:0})),a={id:o?.id||crypto.randomUUID(),woNumber:p.trim(),status:o?.status||"pending",outputProductId:b,outputProductName:t||"",quantityToProduce:e,quantityProduced:o?.quantityProduced||0,priority:C,dueDate:S?new Date(S):void 0,components:s,notes:A.trim()||void 0,startedAt:o?.startedAt,completedAt:o?.completedAt,createdAt:o?.createdAt||new Date};q?(m({type:"UPDATE_WORK_ORDER",payload:a}),u(`Work Order ${p} updated`)):(m({type:"ADD_WORK_ORDER",payload:a}),u(`Work Order ${p} created`)),n()}catch(e){x("Failed to save work order")}finally{D(!1)}}},disabled:P||!$,children:P?"Saving...":q?"Save Changes":"Create Work Order"})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Work Order Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"WO Number"}),(0,t.jsx)("input",{type:"text",value:p,onChange:e=>h(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white font-mono focus:outline-none focus:border-emerald-500/50",readOnly:q})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Priority"}),(0,t.jsxs)("select",{value:C,onChange:e=>k(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"normal",children:"Normal"}),(0,t.jsx)("option",{value:"high",children:"High"}),(0,t.jsx)("option",{value:"urgent",children:"Urgent"})]})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Output Product"}),(0,t.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,t.jsx)("button",{type:"button",onClick:()=>{N("bundle"),g("")},className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${"bundle"===v?"bg-emerald-500/20 border-emerald-500/30 text-emerald-400":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:"Bundle Assembly"}),(0,t.jsx)("button",{type:"button",onClick:()=>{N("product"),g("")},className:`flex-1 py-2 px-4 rounded-lg border transition-colors ${"product"===v?"bg-emerald-500/20 border-emerald-500/30 text-emerald-400":"bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:"Product Manufacturing"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm text-slate-400 mb-1.5",children:["bundle"===v?"Select Bundle":"Select Product"," *"]}),(0,t.jsxs)("select",{value:b,onChange:e=>g(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsxs)("option",{value:"",children:["Select ",v,"..."]}),"bundle"===v?c.bundles.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.sku,")"]},e.id)):c.products.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.sku,")"]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Quantity to Produce *"}),(0,t.jsx)("input",{type:"number",min:"1",value:y,onChange:e=>w(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"})]})]})]}),b&&"bundle"===v&&T.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Bill of Materials"}),(0,t.jsx)("div",{className:`mb-4 p-3 rounded-lg border ${O.canProduce?"bg-emerald-500/10 border-emerald-500/30":"bg-amber-500/10 border-amber-500/30"}`,children:O.canProduce?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-emerald-400",children:[(0,t.jsx)(f.Check,{className:"w-5 h-5"}),(0,t.jsxs)("span",{className:"text-sm",children:["Sufficient stock for ",(0,d.formatNumber)(parseInt(y)||0)," units"]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-amber-400",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-5 h-5"}),(0,t.jsxs)("span",{className:"text-sm",children:["Can only produce ",(0,d.formatNumber)(O.maxProducible)," units with current stock"]})]})}),(0,t.jsx)("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-xs text-slate-400 uppercase tracking-wider",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Component"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"SKU"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Needed"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Available"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Status"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:T.map(e=>(0,t.jsxs)("tr",{className:e.isShort?"bg-amber-500/5":"",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white",children:e.productName}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-slate-400 font-mono",children:e.sku}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white text-center",children:(0,d.formatNumber)(e.quantityRequired)}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,t.jsx)("span",{className:e.isShort?"text-amber-400":"text-emerald-400",children:(0,d.formatNumber)(e.quantityAvailable)})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.isShort?(0,t.jsxs)("span",{className:"text-xs text-amber-400",children:["Short ",(0,d.formatNumber)(e.shortBy)]}):(0,t.jsxs)("span",{className:"text-xs text-emerald-400",children:[(0,t.jsx)(f.Check,{className:"w-4 h-4 inline"})," OK"]})})]},e.productId))})]})})]}),b&&"product"===v&&0===T.length&&(0,t.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"This product does not have predefined components (BOM). To add components, edit the product and add manufacturing components."})}),b&&"product"===v&&T.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Bill of Materials"}),(0,t.jsx)("div",{className:`mb-4 p-3 rounded-lg border ${O.canProduce?"bg-emerald-500/10 border-emerald-500/30":"bg-amber-500/10 border-amber-500/30"}`,children:O.canProduce?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-emerald-400",children:[(0,t.jsx)(f.Check,{className:"w-5 h-5"}),(0,t.jsxs)("span",{className:"text-sm",children:["Sufficient stock for ",(0,d.formatNumber)(parseInt(y)||0)," units"]})]}):(0,t.jsxs)("div",{className:"flex items-center gap-2 text-amber-400",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-5 h-5"}),(0,t.jsxs)("span",{className:"text-sm",children:["Can only produce ",(0,d.formatNumber)(O.maxProducible)," units with current stock"]})]})}),(0,t.jsx)("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-xs text-slate-400 uppercase tracking-wider",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Component"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"SKU"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Needed"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Available"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Status"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:T.map(e=>(0,t.jsxs)("tr",{className:e.isShort?"bg-amber-500/5":"",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white",children:e.productName}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-slate-400 font-mono",children:e.sku}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white text-center",children:(0,d.formatNumber)(e.quantityRequired)}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,t.jsx)("span",{className:e.isShort?"text-amber-400":"text-emerald-400",children:(0,d.formatNumber)(e.quantityAvailable)})}),(0,t.jsx)("td",{className:"px-4 py-3 text-center",children:e.isShort?(0,t.jsxs)("span",{className:"text-xs text-amber-400",children:["Short ",(0,d.formatNumber)(e.shortBy)]}):(0,t.jsxs)("span",{className:"text-xs text-emerald-400",children:[(0,t.jsx)(f.Check,{className:"w-4 h-4 inline"})," OK"]})})]},e.productId))})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Due Date (Optional)"}),(0,t.jsx)("input",{type:"date",value:S,onChange:e=>I(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{value:A,onChange:e=>_(e.target.value),rows:2,placeholder:"Optional notes for this work order...",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]})]})})}e.s(["ReceivePOModal",()=>S],69777),e.s(["CreateWorkOrderModal",()=>I],4423);var A=e.i(31343),_=e.i(3116),P=e.i(75558),D=e.i(58377);function q({isOpen:e,onClose:n,workOrder:c,onEdit:m}){var u;let{state:x,dispatch:p}=(0,r.useApp)(),{success:h,error:g,warning:v}=(0,i.useToast)(),N=(0,o.useConfirm)(),y=e=>x.inventory.filter(t=>t.productId===e).reduce((e,t)=>e+t.quantity,0),w=(0,s.useMemo)(()=>{if(!c)return{canStart:!0,shortComponents:[]};let e=c.components.filter(e=>y(e.productId)<e.quantityRequired);return{canStart:0===e.length,shortComponents:e}},[c,x.inventory]),C=async()=>{!c||(w.canStart?await N({title:"Start Production",message:`Start production on ${c.woNumber}? This will deduct components from inventory.`,confirmText:"Start Production"})&&(c.components.forEach(e=>{let t=x.locations.find(e=>e.isDefault),s=t?.id||x.locations[0]?.id||"loc-1";p({type:"ADJUST_STOCK",payload:{productId:e.productId,locationId:s,adjustment:-e.quantityRequired}})}),p({type:"UPDATE_WORK_ORDER",payload:{...c,status:"in_progress",startedAt:new Date,components:c.components.map(e=>({...e,quantityUsed:e.quantityRequired}))}}),h(`Started production on ${c.woNumber}`),n()):g("Insufficient stock to start production"))},S=async()=>{if(c&&await N({title:"Complete Work Order",message:`Complete ${c.woNumber}? This will add ${c.quantityToProduce} ${c.outputProductName} to inventory.`,confirmText:"Complete"})){let e=x.locations.find(e=>e.isDefault),t=e?.id||x.locations[0]?.id||"loc-1";p({type:"ADJUST_STOCK",payload:{productId:c.outputProductId,locationId:t,adjustment:c.quantityToProduce}}),p({type:"UPDATE_WORK_ORDER",payload:{...c,status:"completed",quantityProduced:c.quantityToProduce,completedAt:new Date}}),h(`${c.woNumber} completed! ${(0,d.formatNumber)(c.quantityToProduce)} ${c.outputProductName} added to inventory`),n()}},I=async()=>{if(!c)return;let e="in_progress"===c.status?`Cancel ${c.woNumber}? Components have already been deducted and will NOT be returned.`:`Cancel ${c.woNumber}?`;await N({title:"Cancel Work Order",message:e,confirmText:"Cancel Work Order",destructive:!0})&&(p({type:"UPDATE_WORK_ORDER",payload:{...c,status:"cancelled"}}),h(`${c.woNumber} cancelled`),n())};if(!c)return null;let q="completed"===c.status?100:50*("in_progress"===c.status);return(0,t.jsx)(a.Modal,{open:e,onClose:n,title:c.woNumber,subtitle:c.outputProductName,size:"lg",footer:(0,t.jsxs)(t.Fragment,{children:["pending"===c.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:()=>m?.(c),children:"Edit"}),(0,t.jsx)(l.Button,{variant:"secondary",onClick:I,children:"Cancel"}),(0,t.jsxs)(l.Button,{onClick:C,disabled:!w.canStart,children:[(0,t.jsx)(A.Play,{className:"w-4 h-4"}),"Start Production"]})]}),"in_progress"===c.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:I,children:"Cancel"}),(0,t.jsxs)(l.Button,{onClick:S,children:[(0,t.jsx)(f.Check,{className:"w-4 h-4"}),"Complete"]})]}),("completed"===c.status||"cancelled"===c.status)&&(0,t.jsx)(l.Button,{variant:"secondary",onClick:n,children:"Close"})]}),children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(u=c.status,(0,t.jsx)("span",{className:`px-3 py-1 text-sm rounded-full border ${{pending:"bg-slate-500/20 text-slate-400 border-slate-500/30",in_progress:"bg-blue-500/20 text-blue-400 border-blue-500/30",completed:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",cancelled:"bg-red-500/20 text-red-400 border-red-500/30"}[u]}`,children:{pending:"Pending",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled"}[u]})),(e=>{if("normal"===e)return null;let s={high:P.ArrowUp,urgent:D.Flame}[e];return(0,t.jsxs)("span",{className:`flex items-center gap-1 ${{high:"text-amber-400",urgent:"text-red-400"}[e]}`,children:[(0,t.jsx)(s,{className:"w-4 h-4"}),e.charAt(0).toUpperCase()+e.slice(1)]})})(c.priority)]})}),"in_progress"===c.status&&(0,t.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-slate-400",children:"Production Progress"}),(0,t.jsxs)("span",{className:"text-sm text-white",children:[q,"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2",children:(0,t.jsx)("div",{className:"h-2 rounded-full bg-blue-500 transition-all",style:{width:`${q}%`}})})]}),"pending"===c.status&&!w.canStart&&(0,t.jsxs)("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-4 flex items-start gap-3",children:[(0,t.jsx)(j.AlertTriangle,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-amber-400",children:"Insufficient Stock"}),(0,t.jsx)("div",{className:"text-sm text-slate-300 mt-1",children:"Cannot start production. The following components are short:"}),(0,t.jsx)("ul",{className:"mt-2 space-y-1",children:w.shortComponents.map(e=>(0,t.jsxs)("li",{className:"text-sm text-slate-400",children:[e.productName,": need ",(0,d.formatNumber)(e.quantityRequired),", have ",(0,d.formatNumber)(y(e.productId))]},e.productId))})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Output"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-14 h-14 bg-emerald-500/20 rounded-lg flex items-center justify-center",children:(0,t.jsx)(b.Package,{className:"w-7 h-7 text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-lg font-medium text-white",children:c.outputProductName}),(0,t.jsx)("div",{className:"text-sm text-slate-400",children:"completed"===c.status?(0,t.jsxs)("span",{className:"text-emerald-400",children:[(0,d.formatNumber)(c.quantityProduced)," / ",(0,d.formatNumber)(c.quantityToProduce)," produced"]}):(0,t.jsxs)("span",{children:[(0,d.formatNumber)(c.quantityToProduce)," to produce"]})})]})]})]}),c.components.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Components"}),(0,t.jsx)("div",{className:"border border-slate-700 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-xs text-slate-400 uppercase tracking-wider",children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left",children:"Component"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Required"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Used"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center",children:"Available"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:c.components.map(e=>{let s=y(e.productId),a=s<e.quantityRequired&&"pending"===c.status;return(0,t.jsxs)("tr",{className:a?"bg-amber-500/5":"",children:[(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white",children:e.productName}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-white text-center",children:(0,d.formatNumber)(e.quantityRequired)}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:"pending"===c.status?(0,t.jsx)("span",{className:"text-slate-400",children:"-"}):(0,t.jsx)("span",{className:"text-emerald-400",children:(0,d.formatNumber)(e.quantityUsed)})}),(0,t.jsx)("td",{className:"px-4 py-3 text-sm text-center",children:(0,t.jsx)("span",{className:a?"text-amber-400":"text-slate-400",children:(0,d.formatNumber)(s)})})]},e.productId)})})]})})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(k.Calendar,{className:"w-4 h-4 text-slate-400"}),(0,t.jsx)("span",{className:"text-slate-400",children:"Due Date:"}),(0,t.jsx)("span",{className:"text-white",children:c.dueDate?(0,d.formatDate)(c.dueDate):"Not set"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(_.Clock,{className:"w-4 h-4 text-slate-400"}),(0,t.jsx)("span",{className:"text-slate-400",children:"Created:"}),(0,t.jsx)("span",{className:"text-white",children:(0,d.formatDate)(c.createdAt)})]})]})]}),c.notes&&(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-2",children:"Notes"}),(0,t.jsx)("p",{className:"text-sm text-slate-300",children:c.notes})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-white mb-3",children:"Timeline"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"text-white",children:"Created"}),(0,t.jsx)("span",{className:"text-slate-400 ml-2",children:(0,d.formatDateTime)(c.createdAt)})]})]}),c.startedAt&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"text-white",children:"Production Started"}),(0,t.jsx)("span",{className:"text-slate-400 ml-2",children:(0,d.formatDateTime)(c.startedAt)})]})]}),c.completedAt&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"text-white",children:"Completed"}),(0,t.jsx)("span",{className:"text-slate-400 ml-2",children:(0,d.formatDateTime)(c.completedAt)})]})]}),"cancelled"===c.status&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-500"}),(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsx)("span",{className:"text-white",children:"Cancelled"})})]})]})]})]})})}e.s(["WorkOrderDetailModal",()=>q],50938);var R=e.i(56156),T=e.i(33785),O=e.i(15788);T.Warehouse,b.Package,O.Truck;var $=e.i(72664);e.i(59386),e.i(3496);let M=(0,N.default)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);e.s(["Zap",()=>M],39312);let U={damaged_in_transit:"Damaged in Transit",defective:"Defective Product",wrong_item_sent:"Wrong Item Sent",not_as_described:"Not as Described",changed_mind:"Changed Mind",ordered_wrong:"Ordered Wrong",arrived_late:"Arrived Late",better_price_found:"Better Price Found",other:"Other"};function E({isOpen:e,onClose:a,preselectedOrder:l}){let{state:n,dispatch:o}=(0,r.useApp)(),{success:c,error:m}=(0,i.useToast)(),[u,x]=(0,s.useState)("order"),[p,h]=(0,s.useState)(null),[b,g]=(0,s.useState)(""),[f,j]=(0,s.useState)([]),[v,N]=(0,s.useState)(!1),[y,w]=(0,s.useState)(0),[C,k]=(0,s.useState)("");(0,s.useEffect)(()=>{l&&(h(l),x("items"),S(l))},[l]),(0,s.useEffect)(()=>{e||(x("order"),h(null),g(""),j([]),N(!1),w(0),k(""))},[e]);let S=e=>{j(e.items.map(e=>({productId:e.productId,productName:e.productName,sku:e.sku,price:e.price,maxQuantity:e.quantity,quantity:e.quantity,reason:"damaged_in_transit",selected:!1})))},I=n.orders.filter(e=>("shipped"===e.status||"delivered"===e.status)&&(""===b||e.orderNumber.toLowerCase().includes(b.toLowerCase())||e.customer.name.toLowerCase().includes(b.toLowerCase()))),A=f.filter(e=>e.selected),_=()=>{let e=A.reduce((e,t)=>e+t.price*t.quantity,0),t=v&&p?p.shipping:0,s=y/100*e;return{subtotal:e,shipping:t,restockingFee:s,total:e+t-s}};if(!e)return null;let P=_();return(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-full items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:a}),(0,t.jsxs)("div",{className:"relative bg-slate-900 border border-slate-700/50 rounded-2xl shadow-2xl w-full max-w-3xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/50",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-white",children:"Create Return"}),(0,t.jsxs)("p",{className:"text-sm text-slate-400",children:["order"===u&&"Select an order to create a return for","items"===u&&"Select items to return","details"===u&&"Review and confirm return details"]})]}),(0,t.jsx)("button",{onClick:a,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:(0,t.jsx)("i",{className:"fas fa-times"})})]}),(0,t.jsxs)("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:["order"===u&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search orders by number or customer...",value:b,onChange:e=>g(e.target.value),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500"})]}),(0,t.jsx)("div",{className:"space-y-2",children:0===I.length?(0,t.jsxs)("div",{className:"text-center py-8 text-slate-500",children:[(0,t.jsx)("i",{className:"fas fa-box-open text-4xl mb-3"}),(0,t.jsx)("p",{children:"No eligible orders found"}),(0,t.jsx)("p",{className:"text-sm",children:"Only shipped or delivered orders can be returned"})]}):I.map(e=>(0,t.jsx)("button",{onClick:()=>{h(e),S(e),x("items")},className:"w-full p-4 bg-slate-800/50 hover:bg-slate-700/50 border border-slate-700/50 rounded-lg text-left transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.orderNumber}),(0,t.jsx)("div",{className:"text-sm text-slate-400",children:e.customer.name})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-white",children:(0,d.formatCurrency)(e.total)}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:[e.items.reduce((e,t)=>e+t.quantity,0)," items"]})]})]})},e.id))})]}),"items"===u&&p&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-slate-800/30 rounded-lg p-4 mb-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-white font-medium",children:p.orderNumber}),(0,t.jsx)("div",{className:"text-sm text-slate-400",children:p.customer.name})]}),(0,t.jsx)("button",{onClick:()=>{x("order"),h(null)},className:"text-sm text-emerald-400 hover:underline",children:"Change Order"})]})}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Select the items to return:"}),(0,t.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,t.jsx)("div",{className:`p-4 border rounded-lg transition-colors ${e.selected?"border-emerald-500/50 bg-emerald-500/10":"border-slate-700/50 bg-slate-800/30"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("button",{onClick:()=>{var t;return t=e.productId,void j(e=>e.map(e=>e.productId===t?{...e,selected:!e.selected}:e))},className:`mt-1 w-5 h-5 rounded border flex items-center justify-center ${e.selected?"bg-emerald-500 border-emerald-500 text-white":"border-slate-600 text-transparent"}`,children:(0,t.jsx)("i",{className:"fas fa-check text-xs"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-white font-medium",children:e.productName}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:["SKU: ",e.sku]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-white",children:(0,d.formatCurrency)(e.price)}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:["Max qty: ",e.maxQuantity]})]})]}),e.selected&&(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Quantity"}),(0,t.jsx)("input",{type:"number",min:"1",max:e.maxQuantity,value:e.quantity,onChange:t=>{var s,a;return s=e.productId,a=parseInt(t.target.value)||1,void j(e=>e.map(e=>e.productId===s?{...e,quantity:Math.min(Math.max(1,a),e.maxQuantity)}:e))},className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Reason"}),(0,t.jsx)("select",{value:e.reason,onChange:t=>{var s,a;return s=e.productId,a=t.target.value,void j(e=>e.map(e=>e.productId===s?{...e,reason:a}:e))},className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white",children:Object.entries(U).map(([e,s])=>(0,t.jsx)("option",{value:e,children:s},e))})]})]})]})]})},e.productId))})]}),"details"===u&&p&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-white font-medium mb-3",children:"Return Items"}),(0,t.jsx)("div",{className:"bg-slate-800/30 rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-slate-800/50",children:(0,t.jsxs)("tr",{className:"text-left text-xs text-slate-400 uppercase",children:[(0,t.jsx)("th",{className:"px-4 py-2",children:"Product"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center",children:"Qty"}),(0,t.jsx)("th",{className:"px-4 py-2",children:"Reason"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right",children:"Refund"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-slate-700/50",children:A.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"text-white",children:e.productName}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:e.sku})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-center text-white",children:e.quantity}),(0,t.jsx)("td",{className:"px-4 py-3 text-slate-300 text-sm",children:U[e.reason]}),(0,t.jsx)("td",{className:"px-4 py-3 text-right text-white",children:(0,d.formatCurrency)(e.price*e.quantity)})]},e.productId))})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:v,onChange:e=>N(e.target.checked),className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-emerald-500 focus:ring-emerald-500"}),(0,t.jsxs)("span",{className:"text-slate-300",children:["Refund shipping (",(0,d.formatCurrency)(p.shipping),")"]})]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Restocking Fee %"}),(0,t.jsx)("input",{type:"number",min:"0",max:"100",value:y,onChange:e=>w(parseInt(e.target.value)||0),className:"w-full bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 text-white"})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/30 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-white font-medium mb-3",children:"Refund Summary"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-slate-300",children:[(0,t.jsx)("span",{children:"Items Subtotal"}),(0,t.jsx)("span",{children:(0,d.formatCurrency)(P.subtotal)})]}),(0,t.jsxs)("div",{className:"flex justify-between text-slate-300",children:[(0,t.jsx)("span",{children:"Shipping Refund"}),(0,t.jsx)("span",{children:(0,d.formatCurrency)(P.shipping)})]}),P.restockingFee>0&&(0,t.jsxs)("div",{className:"flex justify-between text-red-400",children:[(0,t.jsx)("span",{children:"Restocking Fee"}),(0,t.jsxs)("span",{children:["-",(0,d.formatCurrency)(P.restockingFee)]})]}),(0,t.jsxs)("div",{className:"pt-2 border-t border-slate-700 flex justify-between text-lg",children:[(0,t.jsx)("span",{className:"text-white font-semibold",children:"Total Refund"}),(0,t.jsx)("span",{className:"text-emerald-400 font-bold",children:(0,d.formatCurrency)(P.total)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1",children:"Notes (optional)"}),(0,t.jsx)("textarea",{value:C,onChange:e=>k(e.target.value),rows:3,placeholder:"Add any notes about this return...",className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500 resize-none"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-t border-slate-700/50",children:[(0,t.jsx)("div",{children:"order"!==u&&(0,t.jsxs)("button",{onClick:()=>x("details"===u?"items":"order"),className:"px-4 py-2 text-slate-400 hover:text-white transition-colors flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-arrow-left"}),"Back"]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:a,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 rounded-lg transition-colors",children:"Cancel"}),"items"===u&&(0,t.jsxs)("button",{onClick:()=>x("details"),disabled:0===A.length,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:["Continue",(0,t.jsx)("i",{className:"fas fa-arrow-right"})]}),"details"===u&&(0,t.jsxs)("button",{onClick:()=>{if(!p||0===A.length)return void m("Please select at least one item to return");let e=_(),t=`RET-${String(n.returns.length+1).padStart(4,"0")}`;o({type:"ADD_RETURN",payload:{id:`return-${Date.now()}`,returnNumber:t,orderId:p.id,orderNumber:p.orderNumber,channel:p.channel,status:"requested",customer:{name:p.customer.name,email:p.customer.email},items:A.map(e=>({productId:e.productId,productName:e.productName,sku:e.sku,quantity:e.quantity,quantityReceived:0,reason:e.reason,refundAmount:e.price*e.quantity})),returnShipping:{},refund:{subtotal:e.subtotal,shipping:e.shipping,restockingFee:e.restockingFee,total:e.total},notes:C||void 0,createdAt:new Date,updatedAt:new Date}}),c(`Return ${t} created successfully`),a()},className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg transition-colors flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-check"}),"Create Return"]})]})]})]})]})})}e.s(["CreateReturnModal",()=>E],45560);var F=e.i(18566);function L({isOpen:e,onClose:a}){let l=(0,F.useRouter)(),{state:d,dispatch:n}=(0,r.useApp)(),{success:o,error:c}=(0,i.useToast)(),[m,u]=(0,s.useState)(""),[x,p]=(0,s.useState)("cycle"),[h,b]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[j,v]=(0,s.useState)("all"),[N,y]=(0,s.useState)(""),[w,C]=(0,s.useState)([]),k=(0,s.useMemo)(()=>Array.from(new Set(d.products.map(e=>e.category))).sort(),[d.products]),S=(0,s.useMemo)(()=>{let e=d.products;if(h&&(e=e.filter(e=>d.inventory.some(t=>t.productId===e.id&&t.locationId===h))),N){let t=N.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t))}return e},[d.products,d.inventory,h,N]),I=()=>{u(""),p("cycle"),b(""),f(""),v("all"),y(""),C([]),a()};return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-full items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:I}),(0,t.jsxs)("div",{className:"relative bg-slate-900 border border-slate-700/50 rounded-2xl shadow-2xl w-full max-w-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/50",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-white",children:"Create Stock Count"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Set up a new inventory count"})]}),(0,t.jsx)("button",{onClick:I,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:(0,t.jsx)("i",{className:"fas fa-times"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Count Name"}),(0,t.jsx)("input",{type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"e.g., Monthly Full Count - December",className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Count Type"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("button",{onClick:()=>p("full"),className:`p-4 rounded-lg border text-left transition-colors ${"full"===x?"bg-purple-500/20 border-purple-500 text-purple-400":"bg-slate-800/50 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsx)("i",{className:"fas fa-boxes mb-2"}),(0,t.jsx)("div",{className:"font-medium",children:"Full Count"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Count all items at location"})]}),(0,t.jsxs)("button",{onClick:()=>p("cycle"),className:`p-4 rounded-lg border text-left transition-colors ${"cycle"===x?"bg-blue-500/20 border-blue-500 text-blue-400":"bg-slate-800/50 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsx)("i",{className:"fas fa-sync-alt mb-2"}),(0,t.jsx)("div",{className:"font-medium",children:"Cycle Count"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Count specific category or zone"})]}),(0,t.jsxs)("button",{onClick:()=>p("spot"),className:`p-4 rounded-lg border text-left transition-colors ${"spot"===x?"bg-amber-500/20 border-amber-500 text-amber-400":"bg-slate-800/50 border-slate-700 text-slate-400 hover:border-slate-600"}`,children:[(0,t.jsx)("i",{className:"fas fa-search mb-2"}),(0,t.jsx)("div",{className:"font-medium",children:"Spot Check"}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:"Count specific items only"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Location"}),(0,t.jsxs)("select",{value:h,onChange:e=>b(e.target.value),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"Select a location..."}),d.locations.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),"cycle"===x&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Category (Optional)"}),(0,t.jsxs)("select",{value:g,onChange:e=>f(e.target.value),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"All Categories"}),k.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})]}),"spot"!==x&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Include Items"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>v("all"),className:`px-4 py-2 rounded-lg border transition-colors ${"all"===j?"bg-emerald-500/20 border-emerald-500 text-emerald-400":"bg-slate-800/50 border-slate-700 text-slate-400"}`,children:"All Items"}),(0,t.jsx)("button",{onClick:()=>v("low_stock"),className:`px-4 py-2 rounded-lg border transition-colors ${"low_stock"===j?"bg-amber-500/20 border-amber-500 text-amber-400":"bg-slate-800/50 border-slate-700 text-slate-400"}`,children:"Low Stock Only"}),(0,t.jsx)("button",{onClick:()=>v("high_value"),className:`px-4 py-2 rounded-lg border transition-colors ${"high_value"===j?"bg-purple-500/20 border-purple-500 text-purple-400":"bg-slate-800/50 border-slate-700 text-slate-400"}`,children:"High Value Only"})]})]}),"spot"===x&&h&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:["Select Items to Count (",w.length," selected)"]}),(0,t.jsxs)("div",{className:"relative mb-3",children:[(0,t.jsx)("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),(0,t.jsx)("input",{type:"text",value:N,onChange:e=>y(e.target.value),placeholder:"Search products...",className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500"})]}),(0,t.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2 border border-slate-700 rounded-lg p-2",children:0===S.length?(0,t.jsx)("p",{className:"text-center py-4 text-slate-500",children:"No products found at this location"}):S.map(e=>(0,t.jsxs)("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${w.includes(e.id)?"bg-emerald-500/20 border border-emerald-500/30":"hover:bg-slate-800/50 border border-transparent"}`,children:[(0,t.jsx)("input",{type:"checkbox",checked:w.includes(e.id),onChange:()=>{var t;return t=e.id,void C(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"w-4 h-4 rounded border-slate-600 bg-slate-700 text-emerald-500 focus:ring-emerald-500"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:e.sku})]}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:[d.inventory.find(t=>t.productId===e.id&&t.locationId===h)?.quantity||0," in stock"]})]},e.id))})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-700/50",children:[(0,t.jsx)("button",{onClick:I,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 rounded-lg transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{let e;if(!m.trim())return void c("Please enter a count name");if(!h)return void c("Please select a location");if("spot"===x&&0===w.length)return void c("Please select at least one product for spot check");let t=d.products.filter(e=>d.inventory.some(t=>t.productId===e.id&&t.locationId===h));if(g&&"cycle"===x&&(t=t.filter(e=>e.category===g)),"spot"===x&&(t=t.filter(e=>w.includes(e.id))),"low_stock"===j?t=t.filter(e=>{let t=d.inventory.find(t=>t.productId===e.id&&t.locationId===h);return t&&t.quantity<=e.reorderPoint}):"high_value"===j&&(t=t.filter(e=>e.cost.rolling>=10)),0===t.length)return void c("No products match the selected criteria");let s=t.map(e=>{let t=d.inventory.find(t=>t.productId===e.id&&t.locationId===h);return{productId:e.id,productName:e.name,sku:e.sku,binLocation:t?.binLocation,systemQty:t?.quantity||0,countedQty:null,variance:0,varianceValue:0,status:"pending"}}),r=d.locations.find(e=>e.id===h),i=(e=d.stockCounts.length+1,`SC-${String(e).padStart(4,"0")}`),u={id:`sc-${Date.now()}`,countNumber:i,name:m,type:x,status:"draft",location:h,locationName:r?.name||"",category:g||void 0,items:s,summary:{totalItems:s.length,countedItems:0,matchedItems:0,discrepancyItems:0,totalVariance:0},createdAt:new Date,updatedAt:new Date};n({type:"ADD_STOCK_COUNT",payload:u}),o(`Stock count ${i} created with ${s.length} items`),a(),l.push(`/inventory/counts/${u.id}`)},disabled:!m.trim()||!h||"spot"===x&&0===w.length,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-plus"}),"Create Count"]})]})]})]})}):null}function B({isOpen:e,onClose:a,preselectedProduct:l}){let d=(0,F.useRouter)(),{state:n,dispatch:o}=(0,r.useApp)(),{success:c,error:m}=(0,i.useToast)(),[u,x]=(0,s.useState)(""),[p,h]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(!1),[y,w]=(0,s.useState)([]),C=(e,t)=>{let s=n.inventory.find(s=>s.productId===e&&s.locationId===t);return s?.quantity||0},k=(0,s.useMemo)(()=>{if(!u)return[];let e=n.products.filter(e=>C(e.id,u)>0&&!y.some(t=>t.productId===e.id));if(f){let t=f.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t))}return e},[n.products,n.inventory,u,f,y]),S=()=>{x(""),h(""),g(""),j(""),N(!1),w([]),a()};if((0,s.useMemo)(()=>{if(l&&u&&!y.some(e=>e.productId===l.id)){let e=C(l.id,u);e>0&&w([{productId:l.id,productName:l.name,sku:l.sku,requestedQty:Math.min(1,e)}])}},[l,u]),!e)return null;let I=y.reduce((e,t)=>e+t.requestedQty,0);return(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex min-h-full items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:S}),(0,t.jsxs)("div",{className:"relative bg-slate-900 border border-slate-700/50 rounded-2xl shadow-2xl w-full max-w-2xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-slate-700/50",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-white",children:"Create Stock Transfer"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Move inventory between locations"})]}),(0,t.jsx)("button",{onClick:S,className:"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors",children:(0,t.jsx)("i",{className:"fas fa-times"})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6 max-h-[60vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"From Location"}),(0,t.jsxs)("select",{value:u,onChange:e=>{x(e.target.value),w([])},className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:outline-none focus:border-emerald-500",children:[(0,t.jsx)("option",{value:"",children:"Select source..."}),n.locations.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"To Location"}),(0,t.jsxs)("select",{value:p,onChange:e=>h(e.target.value),disabled:!u,className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 focus:outline-none focus:border-emerald-500 disabled:opacity-50",children:[(0,t.jsx)("option",{value:"",children:"Select destination..."}),n.locations.filter(e=>e.id!==u).map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),u&&p&&(0,t.jsxs)("div",{className:"flex items-center justify-center gap-4 py-2",children:[(0,t.jsx)("div",{className:"text-slate-400 font-medium",children:n.locations.find(e=>e.id===u)?.name}),(0,t.jsx)("i",{className:"fas fa-arrow-right text-emerald-400 text-xl"}),(0,t.jsx)("div",{className:"text-slate-400 font-medium",children:n.locations.find(e=>e.id===p)?.name})]}),u&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Add Products to Transfer"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("i",{className:"fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Search products at source location...",value:f,onChange:e=>{j(e.target.value),N(!0)},onFocus:()=>N(!0),className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg pl-10 pr-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500"}),v&&f&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 bg-slate-800 border border-slate-700 rounded-lg mt-1 max-h-60 overflow-y-auto z-10",children:0===k.length?(0,t.jsx)("div",{className:"p-4 text-center text-slate-500",children:"No products found"}):k.slice(0,10).map(e=>(0,t.jsxs)("button",{onClick:()=>{let t;return t=C(e.id,u),void(w([...y,{productId:e.id,productName:e.name,sku:e.sku,requestedQty:Math.min(1,t)}]),j(""),N(!1))},className:"w-full flex items-center justify-between p-3 hover:bg-slate-700 transition-colors text-left",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-white",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-slate-400",children:e.sku})]}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:[C(e.id,u)," available"]})]},e.id))})]}),y.length>0&&(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[y.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-4 p-3 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"text-white",children:e.productName}),(0,t.jsxs)("div",{className:"text-sm text-slate-400",children:[e.sku," â€¢ Available: ",C(e.productId,u)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-slate-400",children:"Qty:"}),(0,t.jsx)("input",{type:"number",min:1,max:C(e.productId,u),value:e.requestedQty,onChange:e=>{var t;let a;return t=parseInt(e.target.value)||1,a=C(y[s].productId,u),void w(y.map((e,l)=>l===s?{...e,requestedQty:Math.min(Math.max(1,t),a)}:e))},className:"w-20 bg-slate-700/50 border border-slate-600 rounded px-2 py-1 text-white text-center focus:outline-none focus:border-emerald-500"})]}),(0,t.jsx)("button",{onClick:()=>{w(y.filter((e,t)=>t!==s))},className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",children:(0,t.jsx)("i",{className:"fas fa-times"})})]},e.productId)),(0,t.jsxs)("div",{className:"flex justify-end pt-2 text-slate-400",children:["Total: ",y.length," product",1!==y.length?"s":"",", ",I," unit",1!==I?"s":""]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Notes (optional)"}),(0,t.jsx)("textarea",{value:b,onChange:e=>g(e.target.value),placeholder:"Reason for transfer, special instructions...",rows:3,className:"w-full bg-slate-800/50 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder-slate-500 focus:outline-none focus:border-emerald-500 resize-none"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-700/50",children:[(0,t.jsx)("button",{onClick:S,className:"px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 rounded-lg transition-colors",children:"Cancel"}),(0,t.jsxs)("button",{onClick:()=>{let e;if(!u)return void m("Please select a source location");if(!p)return void m("Please select a destination location");if(u===p)return void m("Source and destination must be different");if(0===y.length)return void m("Please add at least one product to transfer");let t=n.locations.find(e=>e.id===u),s=n.locations.find(e=>e.id===p),a=(e=n.transfers.length+1,`TRF-${String(e).padStart(4,"0")}`),l={id:`trf-${Date.now()}`,transferNumber:a,status:"pending",fromLocation:u,fromLocationName:t?.name||"",toLocation:p,toLocationName:s?.name||"",items:y.map(e=>({productId:e.productId,productName:e.productName,sku:e.sku,requestedQty:e.requestedQty,shippedQty:0,receivedQty:0,status:"pending"})),notes:b||void 0,createdAt:new Date,updatedAt:new Date};o({type:"ADD_TRANSFER",payload:l}),c(`Transfer ${a} created`),S(),d.push(`/inventory/transfers/${l.id}`)},disabled:!u||!p||0===y.length,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-slate-700 disabled:text-slate-500 text-white rounded-lg transition-colors flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-exchange-alt"}),"Create Transfer"]})]})]})]})})}e.s(["CreateStockCountModal",()=>L],93737),e.s(["CreateTransferModal",()=>B],90628);let z=[{id:"tpl-usps-small",name:"Auto-assign USPS for small orders",description:"Orders under $50 with weight less than 1lb ship USPS First Class",category:"shipping",trigger:{type:"order_created"},conditions:[{field:"total",operator:"less_than",value:50}],actions:[{type:"assign_carrier",config:{carrier:"usps"}},{type:"assign_service",config:{service:"first_class"}}]},{id:"tpl-ups-heavy",name:"Use UPS for heavy orders",description:"Orders over 5lbs ship via UPS Ground",category:"shipping",trigger:{type:"order_created"},conditions:[{field:"weight",operator:"greater_than",value:80}],actions:[{type:"assign_carrier",config:{carrier:"ups"}},{type:"assign_service",config:{service:"ground"}}]},{id:"tpl-fedex-express",name:"FedEx for high-value orders",description:"Orders over $200 ship FedEx with signature required",category:"shipping",trigger:{type:"order_created"},conditions:[{field:"total",operator:"greater_than",value:200}],actions:[{type:"assign_carrier",config:{carrier:"fedex"}},{type:"assign_service",config:{service:"express_saver"}}]},{id:"tpl-prime-tag",name:"Tag Amazon Prime orders as urgent",description:"Add PRIME tag and set high priority for Amazon Prime orders",category:"tagging",trigger:{type:"order_created"},conditions:[{field:"is_prime",operator:"equals",value:!0}],actions:[{type:"set_order_tag",config:{tag:"PRIME"}},{type:"set_priority",config:{priority:"high"}}]},{id:"tpl-wholesale-tag",name:"Tag wholesale orders",description:"Add WHOLESALE tag and notify team for bulk orders",category:"tagging",trigger:{type:"order_created"},conditions:[{field:"item_count",operator:"greater_than",value:10}],actions:[{type:"set_order_tag",config:{tag:"WHOLESALE"}},{type:"send_notification",config:{message:"New wholesale order received"}}]},{id:"tpl-international-tag",name:"Tag international orders",description:"Flag orders shipping outside the US",category:"tagging",trigger:{type:"order_created"},conditions:[{field:"shipping_country",operator:"not_equals",value:"US"}],actions:[{type:"set_order_tag",config:{tag:"INTERNATIONAL"}},{type:"set_priority",config:{priority:"low"}}]},{id:"tpl-fragile-tag",name:"Tag fragile product orders",description:"Add FRAGILE tag when order contains specific SKUs",category:"tagging",trigger:{type:"order_created"},conditions:[{field:"contains_sku",operator:"contains",value:"4L"}],actions:[{type:"set_order_tag",config:{tag:"FRAGILE"}}]},{id:"tpl-low-stock-alert",name:"Create PO when stock is low",description:"Automatically create a PO draft and notify when stock drops below threshold",category:"inventory",trigger:{type:"low_stock",threshold:50},conditions:[],actions:[{type:"create_po_draft",config:{quantity:100}},{type:"send_notification",config:{message:"Low stock alert! PO draft created."}}]},{id:"tpl-critical-stock",name:"Critical stock email alert",description:"Send urgent email when stock is critically low",category:"inventory",trigger:{type:"low_stock",threshold:10},conditions:[],actions:[{type:"send_email",config:{recipient:"admin@company.com",subject:"URGENT: Critical stock level"}},{type:"send_notification",config:{message:"CRITICAL: Stock nearly depleted!"}}]},{id:"tpl-new-order-notify",name:"Notify on new Shopify orders",description:"Send notification when a new Shopify order is received",category:"notification",trigger:{type:"order_created"},conditions:[{field:"channel",operator:"equals",value:"shopify"}],actions:[{type:"send_notification",config:{message:"New Shopify order received!"}}]},{id:"tpl-vip-customer",name:"VIP customer alert",description:"Notify when orders come from VIP email domains",category:"notification",trigger:{type:"order_created"},conditions:[{field:"total",operator:"greater_than",value:500}],actions:[{type:"set_order_tag",config:{tag:"VIP"}},{type:"set_priority",config:{priority:"urgent"}},{type:"send_notification",config:{message:"VIP order received - prioritize!"}}]},{id:"tpl-gripper-sticker",name:"Add gripper sticker to every bottle",description:"Automatically add gripper stickers to orders containing bottles",category:"shipping",trigger:{type:"order_created"},conditions:[{field:"contains_sku",operator:"contains",value:"CN"}],actions:[{type:"add_fulfillment_item",config:{productId:"gripper-sku",quantity:1}}]}],Q=[{type:"order_created",icon:"ShoppingCart",label:"New Order",description:"When an order is created"},{type:"order_status_changed",icon:"ArrowLeftRight",label:"Status Change",description:"When order status changes"},{type:"low_stock",icon:"AlertTriangle",label:"Low Stock",description:"When stock falls below threshold"},{type:"item_received",icon:"PackageCheck",label:"Item Received",description:"When inventory is received"},{type:"daily",icon:"Clock",label:"Scheduled",description:"Run at a specific time daily"},{type:"manual",icon:"Hand",label:"Manual",description:"Run manually when triggered"}],W=[{type:"set_order_tag",label:"Add Order Tag",icon:"Tag"},{type:"set_priority",label:"Set Priority",icon:"Flag"},{type:"assign_carrier",label:"Assign Carrier",icon:"Truck"},{type:"assign_service",label:"Assign Shipping Service",icon:"Package"},{type:"select_box",label:"Select Box",icon:"Box"},{type:"add_fulfillment_item",label:"Add Fulfillment Item",icon:"Plus"},{type:"send_notification",label:"Send Notification",icon:"Bell"},{type:"create_po_draft",label:"Create PO Draft",icon:"FileText"},{type:"send_email",label:"Send Email",icon:"Mail"},{type:"set_location",label:"Set Location",icon:"MapPin"}],K=[{value:"equals",label:"equals"},{value:"not_equals",label:"does not equal"},{value:"contains",label:"contains"},{value:"greater_than",label:"is greater than"},{value:"less_than",label:"is less than"},{value:"in_list",label:"is one of"}],H=[{value:"low",label:"Low"},{value:"normal",label:"Normal"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],V=[{value:"usps",label:"USPS"},{value:"ups",label:"UPS"},{value:"fedex",label:"FedEx"},{value:"dhl",label:"DHL"}],G={usps:[{value:"first_class",label:"First Class"},{value:"priority",label:"Priority Mail"},{value:"priority_express",label:"Priority Express"},{value:"ground_advantage",label:"Ground Advantage"}],ups:[{value:"ground",label:"UPS Ground"},{value:"three_day_select",label:"3 Day Select"},{value:"second_day_air",label:"2nd Day Air"},{value:"next_day_air",label:"Next Day Air"}],fedex:[{value:"ground",label:"FedEx Ground"},{value:"home_delivery",label:"Home Delivery"},{value:"express_saver",label:"Express Saver"},{value:"standard_overnight",label:"Standard Overnight"}],dhl:[{value:"express",label:"DHL Express"},{value:"express_worldwide",label:"Express Worldwide"}]};function Y(e){switch(e.type){case"order_created":return"New Order";case"order_status_changed":if(e.toStatus)return`Status â†’ ${e.toStatus}`;return"Status Change";case"low_stock":return`Low Stock (â‰¤${e.threshold||50})`;case"item_received":return"Item Received";case"daily":return`Daily at ${e.time}`;case"manual":return"Manual";default:return"Unknown"}}function X(e){switch(e.type){case"set_order_tag":return`Add tag "${e.config.tag}"`;case"set_priority":return`Set priority to ${e.config.priority}`;case"assign_carrier":return`Assign ${e.config.carrier?.toUpperCase()}`;case"assign_service":return`Use ${e.config.service}`;case"select_box":return`Select box ${e.config.boxId}`;case"send_notification":return"Send notification";case"add_fulfillment_item":return`Add item (qty: ${e.config.quantity||1})`;case"set_location":return"Set location";case"create_po_draft":return"Create PO draft";case"send_email":return"Send email";default:return"Unknown action"}}e.s(["getActionLabel",()=>X,"getTriggerLabel",()=>Y],7292);var J=e.i(63059),Z=e.i(73375),ee=e.i(7233),et=e.i(1928);let es=(0,N.default)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]);e.s(["ArrowLeftRight",()=>es],15505);let ea=(0,N.default)("package-check",[["path",{d:"m16 16 2 2 4-4",key:"gfu2re"}],["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]);e.s(["PackageCheck",()=>ea],95729);var el=e.i(99181),er=e.i(51975);let ei=(0,N.default)("flag",[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]]);var ed=e.i(45423),en=e.i(78583),eo=e.i(63488),ec=e.i(46897),em=e.i(83086);let eu=(0,N.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>eu],87130);let ex=["template","basic","trigger","conditions","actions","review"],ep={order_created:et.ShoppingCart,order_status_changed:es,low_stock:j.AlertTriangle,item_received:ea,daily:_.Clock,manual:el.Hand},eh={set_order_tag:er.Tag,set_priority:ei,assign_carrier:O.Truck,assign_service:b.Package,select_box:$.Box,send_notification:ed.Bell,add_fulfillment_item:ee.Plus,create_po_draft:en.FileText,send_email:eo.Mail,set_location:ec.MapPin};function eb({isOpen:e,onClose:d,editRule:n}){let o,c,{state:m,dispatch:u}=(0,r.useApp)(),{success:x,error:p}=(0,i.useToast)(),h=!!n,[b,g]=(0,s.useState)("template"),[j,v]=(0,s.useState)(""),[N,y]=(0,s.useState)(""),[C,k]=(0,s.useState)(!0),[S,I]=(0,s.useState)(10),[_,P]=(0,s.useState)({type:"order_created"}),[D,q]=(0,s.useState)([]),[T,O]=(0,s.useState)([]),[$,U]=(0,s.useState)(""),[E,F]=(0,s.useState)(""),[L,B]=(0,s.useState)(50),[et,es]=(0,s.useState)("09:00"),[ea,el]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(e)if(n)if(v(n.name),y(n.description||""),k(n.enabled),I(n.priority),P(n.trigger),q(n.conditions),O(n.actions),g("basic"),"order_status_changed"===n.trigger.type){let e=n.trigger;U(e.fromStatus||""),F(e.toStatus||"")}else"low_stock"===n.trigger.type?B(n.trigger.threshold||50):"daily"===n.trigger.type&&es(n.trigger.time||"09:00");else v(""),y(""),k(!0),I(10),P({type:"order_created"}),q([]),O([]),U(""),F(""),B(50),es("09:00"),g("template")},[e,n]);let er=ex.indexOf(b),ei=er>+!!h,ed=er<ex.length-1,en=(0,s.useMemo)(()=>{switch(b){case"template":case"trigger":case"conditions":return!0;case"basic":return j.trim().length>0;case"actions":return T.length>0;case"review":return j.trim().length>0&&T.length>0;default:return!1}},[b,j,T]),eo=()=>{q([...D,{id:crypto.randomUUID(),field:"",operator:"equals",value:""}])},ec=(e,t,s)=>{let a=[...D];a[e]={...a[e],[t]:s},q(a)},eb=()=>{O([...T,{id:crypto.randomUUID(),type:"set_order_tag",config:{}}])},eg=(e,t,s)=>{let a=[...T];a[e]={...a[e],config:{...a[e].config,[t]:s}},O(a)},ef=()=>{switch(_.type){case"order_status_changed":return{type:"order_status_changed",...$&&{fromStatus:$},...E&&{toStatus:E}};case"low_stock":return{type:"low_stock",threshold:L};case"daily":return{type:"daily",time:et};default:return _}},ej=()=>["order_created","order_status_changed"].includes(_.type)?r.conditionFields.order:["low_stock","item_received"].includes(_.type)?r.conditionFields.inventory:r.conditionFields.order;return(0,t.jsxs)(a.Modal,{open:e,onClose:d,title:h?"Edit Automation Rule":"Create Automation Rule",subtitle:"template"===b?"Choose a template or start from scratch":void 0,size:"lg",footer:"template"!==b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Button,{variant:"secondary",onClick:ei?()=>{ei&&g(ex[er-1])}:d,children:ei?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z.ChevronLeft,{className:"w-4 h-4"}),"Back"]}):"Cancel"}),"review"===b?(0,t.jsx)(l.Button,{onClick:()=>{if(en){el(!0);try{let e={id:n?.id||crypto.randomUUID(),name:j.trim(),description:N.trim()||void 0,enabled:C,trigger:ef(),conditions:D,actions:T,priority:S,createdAt:n?.createdAt||new Date,updatedAt:new Date};h?(u({type:"UPDATE_AUTOMATION_RULE",payload:e}),x(`Rule "${j}" updated`)):(u({type:"ADD_AUTOMATION_RULE",payload:e}),x(`Rule "${j}" created`)),d()}catch(e){p("Failed to save rule")}finally{el(!1)}}},disabled:ea||!en,children:ea?"Saving...":h?"Save Changes":"Create Rule"}):(0,t.jsxs)(l.Button,{onClick:()=>{ed&&g(ex[er+1])},disabled:!en,children:["Next",(0,t.jsx)(J.ChevronRight,{className:"w-4 h-4"})]})]}):void 0,children:["template"!==b&&(o=h?ex.slice(1):ex,c=h?er-1:er,(0,t.jsx)("div",{className:"flex items-center justify-center gap-2 mb-6",children:o.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors ${s===c?"bg-emerald-500 text-white":s<c?"bg-emerald-500/20 text-emerald-400":"bg-slate-700 text-slate-400"}`,children:s<c?(0,t.jsx)(f.Check,{className:"w-4 h-4"}):s+1}),s<o.length-1&&(0,t.jsx)("div",{className:`w-8 h-0.5 mx-1 ${s<c?"bg-emerald-500/50":"bg-slate-700"}`})]},e))})),(()=>{switch(b){case"template":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center pb-4",children:[(0,t.jsx)(em.Sparkles,{className:"w-12 h-12 text-emerald-400 mx-auto mb-3"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-white",children:"Start with a Template"}),(0,t.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Choose a pre-built rule or start from scratch"})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-3 max-h-80 overflow-y-auto pr-2",children:z.map(e=>(0,t.jsx)("button",{onClick:()=>{v(e.name),y(e.description),P(e.trigger),q(e.conditions.map(e=>({...e,id:crypto.randomUUID()}))),O(e.actions.map(e=>({...e,id:crypto.randomUUID()}))),"low_stock"===e.trigger.type&&B(e.trigger.threshold||50),g("basic")},className:"text-left p-4 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:border-emerald-500/50 hover:bg-slate-800 transition-all",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(M,{className:"w-5 h-5 text-emerald-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-white truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-slate-400 mt-0.5 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)("span",{className:"px-2 py-0.5 rounded bg-slate-700 text-xs text-slate-300",children:Y(e.trigger)}),(0,t.jsxs)("span",{className:"text-xs text-slate-500",children:[e.actions.length," action",1!==e.actions.length?"s":""]})]})]}),(0,t.jsx)(J.ChevronRight,{className:"w-5 h-5 text-slate-500 flex-shrink-0"})]})},e.id))}),(0,t.jsx)("div",{className:"pt-4 border-t border-slate-700/50",children:(0,t.jsxs)(l.Button,{variant:"secondary",className:"w-full",onClick:()=>g("basic"),children:[(0,t.jsx)(ee.Plus,{className:"w-4 h-4"}),"Start from Scratch"]})})]});case"basic":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Rule Name *"}),(0,t.jsx)("input",{type:"text",value:j,onChange:e=>v(e.target.value),placeholder:"e.g., Auto-assign USPS for orders under $50",className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50",autoFocus:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Description (Optional)"}),(0,t.jsx)("textarea",{value:N,onChange:e=>y(e.target.value),placeholder:"What does this rule do?",rows:3,className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 resize-none"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Priority"}),(0,t.jsx)("input",{type:"number",min:1,max:100,value:S,onChange:e=>I(parseInt(e.target.value)||10),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Lower numbers run first"})]}),(0,t.jsx)("div",{className:"flex items-end pb-6",children:(0,t.jsx)("div",{className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg p-4",children:(0,t.jsx)(R.Toggle,{checked:C,onChange:k,label:"Enabled"})})})]})]});case"trigger":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-3",children:"When should this rule run?"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Q.map(e=>{let s=ep[e.type]||M,a=_.type===e.type;return(0,t.jsxs)("button",{onClick:()=>P({type:e.type}),className:`p-4 border rounded-lg text-left transition-all ${a?"border-emerald-500 bg-emerald-500/10":"border-slate-700 hover:border-slate-600 bg-slate-800/50"}`,children:[(0,t.jsx)(s,{className:`w-5 h-5 mb-2 ${a?"text-emerald-400":"text-slate-400"}`}),(0,t.jsx)("div",{className:`font-medium ${a?"text-white":"text-slate-300"}`,children:e.label}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-0.5",children:e.description})]},e.type)})})]}),"order_status_changed"===_.type&&(0,t.jsx)("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"From Status (Optional)"}),(0,t.jsxs)("select",{value:$,onChange:e=>U(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Any status"}),(0,t.jsx)("option",{value:"to_pick",children:"To Pick"}),(0,t.jsx)("option",{value:"picking",children:"Picking"}),(0,t.jsx)("option",{value:"to_pack",children:"To Pack"}),(0,t.jsx)("option",{value:"packing",children:"Packing"}),(0,t.jsx)("option",{value:"ready",children:"Ready"}),(0,t.jsx)("option",{value:"shipped",children:"Shipped"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"To Status (Optional)"}),(0,t.jsxs)("select",{value:E,onChange:e=>F(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Any status"}),(0,t.jsx)("option",{value:"to_pick",children:"To Pick"}),(0,t.jsx)("option",{value:"picking",children:"Picking"}),(0,t.jsx)("option",{value:"to_pack",children:"To Pack"}),(0,t.jsx)("option",{value:"packing",children:"Packing"}),(0,t.jsx)("option",{value:"ready",children:"Ready"}),(0,t.jsx)("option",{value:"shipped",children:"Shipped"})]})]})]})}),"low_stock"===_.type&&(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Stock Threshold"}),(0,t.jsx)("input",{type:"number",min:0,value:L,onChange:e=>B(parseInt(e.target.value)||50),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Rule triggers when stock falls to or below this level"})]}),"daily"===_.type&&(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400 mb-1.5",children:"Run Time"}),(0,t.jsx)("input",{type:"time",value:et,onChange:e=>es(e.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2.5 text-white focus:outline-none focus:border-emerald-500/50"})]})]});case"conditions":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400",children:"Conditions (Optional)"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"Only run this rule when these conditions are met"})]}),(0,t.jsxs)(l.Button,{variant:"secondary",size:"sm",onClick:eo,children:[(0,t.jsx)(ee.Plus,{className:"w-4 h-4"}),"Add"]})]}),0===D.length?(0,t.jsxs)("div",{className:"text-center py-8 text-slate-400",children:[(0,t.jsx)(eu,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"No conditions - rule will run for all matching triggers"})]}):(0,t.jsx)("div",{className:"space-y-3",children:D.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-slate-800/50 rounded-lg",children:[s>0&&(0,t.jsx)("span",{className:"text-xs text-slate-500 px-2",children:"AND"}),(0,t.jsxs)("select",{value:e.field,onChange:e=>ec(s,"field",e.target.value),className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select field..."}),ej().map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,t.jsx)("select",{value:e.operator,onChange:e=>ec(s,"operator",e.target.value),className:"w-36 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:K.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,t.jsx)("input",{type:"text",value:e.value,onChange:e=>ec(s,"value",e.target.value),placeholder:"Value...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),(0,t.jsx)("button",{onClick:()=>{q(D.filter((e,t)=>t!==s))},className:"p-2 text-slate-400 hover:text-red-400 transition-colors",children:(0,t.jsx)(w.X,{className:"w-4 h-4"})})]},e.id))})]});case"actions":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-slate-400",children:"Actions *"}),(0,t.jsx)("p",{className:"text-xs text-slate-500 mt-0.5",children:"What should happen when this rule triggers?"})]}),(0,t.jsxs)(l.Button,{variant:"secondary",size:"sm",onClick:eb,children:[(0,t.jsx)(ee.Plus,{className:"w-4 h-4"}),"Add"]})]}),0===T.length?(0,t.jsxs)("div",{className:"text-center py-8 text-slate-400 border-2 border-dashed border-slate-700 rounded-lg",children:[(0,t.jsx)(A.Play,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-sm",children:"Add at least one action"}),(0,t.jsxs)(l.Button,{variant:"secondary",size:"sm",className:"mt-3",onClick:eb,children:[(0,t.jsx)(ee.Plus,{className:"w-4 h-4"}),"Add Action"]})]}):(0,t.jsx)("div",{className:"space-y-3",children:T.map((e,s)=>{let a=eh[e.type]||M;return(0,t.jsxs)("div",{className:"p-4 bg-slate-800/50 rounded-lg border border-slate-700/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(a,{className:"w-4 h-4 text-emerald-400"})}),(0,t.jsxs)("select",{value:e.type,onChange:e=>{var t,a;let l;return t="type",a=e.target.value,l=[...T],void(l[s]={...l[s],type:a,config:{}},O(l))},className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select action..."}),W.map(e=>(0,t.jsx)("option",{value:e.type,children:e.label},e.type))]}),(0,t.jsx)("button",{onClick:()=>{O(T.filter((e,t)=>t!==s))},className:"p-2 text-slate-400 hover:text-red-400 transition-colors",children:(0,t.jsx)(w.X,{className:"w-4 h-4"})})]}),"set_order_tag"===e.type&&(0,t.jsx)("input",{type:"text",value:e.config.tag||"",onChange:e=>eg(s,"tag",e.target.value),placeholder:"Tag name (e.g., PRIORITY, FRAGILE)",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),"set_priority"===e.type&&(0,t.jsxs)("select",{value:e.config.priority||"",onChange:e=>eg(s,"priority",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select priority..."}),H.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),"assign_carrier"===e.type&&(0,t.jsxs)("select",{value:e.config.carrier||"",onChange:e=>eg(s,"carrier",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select carrier..."}),V.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),"assign_service"===e.type&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("select",{value:e.config.carrier||"",onChange:e=>eg(s,"carrier",e.target.value),className:"bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Carrier..."}),V.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}),(0,t.jsxs)("select",{value:e.config.service||"",onChange:e=>eg(s,"service",e.target.value),className:"bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Service..."}),(G[e.config.carrier]||[]).map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),"select_box"===e.type&&(0,t.jsxs)("select",{value:e.config.boxId||"",onChange:e=>eg(s,"boxId",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select box..."}),m.boxes.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),"add_fulfillment_item"===e.type&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("select",{value:e.config.productId||"",onChange:e=>eg(s,"productId",e.target.value),className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select product..."}),m.products.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.sku,")"]},e.id))]}),(0,t.jsx)("input",{type:"number",min:1,value:e.config.quantity||1,onChange:e=>eg(s,"quantity",parseInt(e.target.value)||1),className:"w-20 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50"})]}),"send_notification"===e.type&&(0,t.jsx)("input",{type:"text",value:e.config.message||"",onChange:e=>eg(s,"message",e.target.value),placeholder:"Notification message...",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),"create_po_draft"===e.type&&(0,t.jsx)("input",{type:"number",min:1,value:e.config.quantity||100,onChange:e=>eg(s,"quantity",parseInt(e.target.value)||100),placeholder:"Quantity to order...",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),"send_email"===e.type&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("input",{type:"email",value:e.config.recipient||"",onChange:e=>eg(s,"recipient",e.target.value),placeholder:"Recipient email...",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"}),(0,t.jsx)("input",{type:"text",value:e.config.subject||"",onChange:e=>eg(s,"subject",e.target.value),placeholder:"Email subject...",className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50"})]}),"set_location"===e.type&&(0,t.jsxs)("select",{value:e.config.locationId||"",onChange:e=>eg(s,"locationId",e.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-emerald-500/50",children:[(0,t.jsx)("option",{value:"",children:"Select location..."}),m.locations.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]},e.id)})})]});case"review":return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center pb-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-3",children:(0,t.jsx)(f.Check,{className:"w-8 h-8 text-emerald-400"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-white",children:"Review Your Rule"}),(0,t.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Make sure everything looks correct"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-lg font-medium text-white",children:j}),(0,t.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs ${C?"bg-emerald-500/20 text-emerald-400":"bg-slate-600/50 text-slate-400"}`,children:C?"Active":"Disabled"})]}),N&&(0,t.jsx)("p",{className:"text-sm text-slate-400",children:N})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 uppercase mb-2",children:"Trigger"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(M,{className:"w-4 h-4 text-emerald-400"}),(0,t.jsx)("span",{className:"text-white",children:Y(ef())})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-500 uppercase mb-2",children:"Conditions"}),0===D.length?(0,t.jsx)("span",{className:"text-slate-400 text-sm",children:"No conditions (runs for all matching triggers)"}):(0,t.jsx)("div",{className:"space-y-1",children:D.map((e,s)=>{let a=ej().find(t=>t.value===e.field);return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[s>0&&(0,t.jsx)("span",{className:"text-slate-500",children:"AND"}),(0,t.jsx)("span",{className:"text-white",children:a?.label||e.field}),(0,t.jsx)("span",{className:"text-slate-400",children:e.operator.replace("_"," ")}),(0,t.jsx)("span",{className:"text-emerald-400",children:String(e.value)})]},e.id)})})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"text-xs text-slate-500 uppercase mb-2",children:["Actions (",T.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:T.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(A.Play,{className:"w-3 h-3 text-emerald-400"}),(0,t.jsx)("span",{className:"text-white",children:X(e)})]},e.id))})]})]})]});default:return null}})()]})}e.s(["AutomationRuleModal",()=>eb],71034),e.i(57417),er.Tag,$.Box,er.Tag,b.Package,O.Truck,e.s([],59802)}]);