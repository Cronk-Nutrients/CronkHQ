{"version":3,"sources":["../../../../context/OrganizationContext.tsx","../../../../types/organization.ts"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useEffect, useState, ReactNode, useCallback } from 'react'\nimport {\n  doc,\n  getDoc,\n  setDoc,\n  collection,\n  query,\n  where,\n  getDocs,\n  addDoc,\n  updateDoc,\n  deleteDoc,\n  serverTimestamp,\n  Timestamp,\n  onSnapshot,\n} from 'firebase/firestore'\nimport { db } from '@/lib/firebase'\nimport { useAuth } from './AuthContext'\nimport {\n  Organization,\n  OrganizationMember,\n  OrganizationInvite,\n  MemberRole,\n  PlanType,\n  PLAN_LIMITS,\n  DEFAULT_ORG_SETTINGS,\n  generateSlug,\n  generateInviteToken,\n  hasPermission,\n  RolePermissions,\n  ROLE_PERMISSIONS,\n} from '@/types/organization'\n\n// Demo organization data\nconst DEMO_ORGANIZATION: Organization = {\n  id: 'demo-org-id',\n  name: 'Cronk Nutrients (Demo)',\n  slug: 'cronk-demo',\n  plan: 'enterprise',\n  planLimits: PLAN_LIMITS.enterprise,\n  settings: {\n    ...DEFAULT_ORG_SETTINGS,\n    timezone: 'America/Chicago',\n    currency: 'USD',\n  },\n  createdAt: new Date(),\n  updatedAt: new Date(),\n  ownerId: 'demo-user-id',\n}\n\nconst DEMO_MEMBER: OrganizationMember = {\n  id: 'demo-member-id',\n  organizationId: 'demo-org-id',\n  userId: 'demo-user-id',\n  email: 'demo@cronknutrients.com',\n  displayName: 'Demo User',\n  role: 'owner',\n  joinedAt: new Date(),\n}\n\ninterface OrganizationContextType {\n  // State\n  organization: Organization | null\n  membership: OrganizationMember | null\n  members: OrganizationMember[]\n  invites: OrganizationInvite[]\n  loading: boolean\n  error: string | null\n\n  // Computed\n  isOwner: boolean\n  isAdmin: boolean\n  permissions: RolePermissions | null\n  hasOrganization: boolean\n  needsSetup: boolean\n\n  // Organization management\n  createOrganization: (name: string, plan?: PlanType) => Promise<Organization>\n  updateOrganization: (data: Partial<Organization>) => Promise<void>\n  switchOrganization: (orgId: string) => Promise<void>\n\n  // Member management\n  inviteMember: (email: string, role: MemberRole) => Promise<OrganizationInvite>\n  updateMemberRole: (memberId: string, role: MemberRole) => Promise<void>\n  removeMember: (memberId: string) => Promise<void>\n  revokeInvite: (inviteId: string) => Promise<void>\n\n  // Invite handling\n  checkPendingInvites: (email: string) => Promise<OrganizationInvite[]>\n  acceptInvite: (inviteId: string) => Promise<void>\n  declineInvite: (inviteId: string) => Promise<void>\n\n  // Utilities\n  clearError: () => void\n  refreshOrganization: () => Promise<void>\n}\n\nconst OrganizationContext = createContext<OrganizationContextType | undefined>(undefined)\n\nexport function OrganizationProvider({ children }: { children: ReactNode }) {\n  const { user, userProfile, isDemo, loading: authLoading } = useAuth()\n\n  const [organization, setOrganization] = useState<Organization | null>(null)\n  const [membership, setMembership] = useState<OrganizationMember | null>(null)\n  const [members, setMembers] = useState<OrganizationMember[]>([])\n  const [invites, setInvites] = useState<OrganizationInvite[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  // Computed values\n  const isOwner = membership?.role === 'owner'\n  const isAdmin = membership?.role === 'admin' || membership?.role === 'owner'\n  const permissions = membership ? ROLE_PERMISSIONS[membership.role] : null\n  const hasOrganization = !!organization\n  const needsSetup = !authLoading && !isDemo && !!user && !organization && !loading\n\n  // Clear error\n  const clearError = useCallback(() => setError(null), [])\n\n  // Fetch organization data\n  const fetchOrganization = useCallback(async (orgId: string) => {\n    try {\n      const orgDoc = await getDoc(doc(db, 'organizations', orgId))\n      if (orgDoc.exists()) {\n        const data = orgDoc.data()\n        return {\n          ...data,\n          id: orgDoc.id,\n          createdAt: data.createdAt?.toDate() || new Date(),\n          updatedAt: data.updatedAt?.toDate() || new Date(),\n        } as Organization\n      }\n      return null\n    } catch (err) {\n      console.error('Error fetching organization:', err)\n      return null\n    }\n  }, [])\n\n  // Fetch user's membership\n  const fetchMembership = useCallback(async (userId: string) => {\n    try {\n      const membershipsQuery = query(\n        collection(db, 'organization_members'),\n        where('userId', '==', userId)\n      )\n      const snapshot = await getDocs(membershipsQuery)\n\n      if (!snapshot.empty) {\n        const doc = snapshot.docs[0]\n        const data = doc.data()\n        return {\n          ...data,\n          id: doc.id,\n          joinedAt: data.joinedAt?.toDate() || new Date(),\n          lastActiveAt: data.lastActiveAt?.toDate(),\n        } as OrganizationMember\n      }\n      return null\n    } catch (err) {\n      console.error('Error fetching membership:', err)\n      return null\n    }\n  }, [])\n\n  // Fetch all members of an organization\n  const fetchMembers = useCallback(async (orgId: string) => {\n    try {\n      const membersQuery = query(\n        collection(db, 'organization_members'),\n        where('organizationId', '==', orgId)\n      )\n      const snapshot = await getDocs(membersQuery)\n\n      return snapshot.docs.map(doc => {\n        const data = doc.data()\n        return {\n          ...data,\n          id: doc.id,\n          joinedAt: data.joinedAt?.toDate() || new Date(),\n          lastActiveAt: data.lastActiveAt?.toDate(),\n        } as OrganizationMember\n      })\n    } catch (err) {\n      console.error('Error fetching members:', err)\n      return []\n    }\n  }, [])\n\n  // Fetch pending invites for an organization\n  const fetchInvites = useCallback(async (orgId: string) => {\n    try {\n      const invitesQuery = query(\n        collection(db, 'organization_invites'),\n        where('organizationId', '==', orgId),\n        where('status', '==', 'pending')\n      )\n      const snapshot = await getDocs(invitesQuery)\n\n      return snapshot.docs.map(doc => {\n        const data = doc.data()\n        return {\n          ...data,\n          id: doc.id,\n          createdAt: data.createdAt?.toDate() || new Date(),\n          expiresAt: data.expiresAt?.toDate() || new Date(),\n          acceptedAt: data.acceptedAt?.toDate(),\n        } as OrganizationInvite\n      })\n    } catch (err) {\n      console.error('Error fetching invites:', err)\n      return []\n    }\n  }, [])\n\n  // Initialize organization data\n  useEffect(() => {\n    if (authLoading) return\n\n    // Handle demo mode\n    if (isDemo) {\n      setOrganization(DEMO_ORGANIZATION)\n      setMembership(DEMO_MEMBER)\n      setMembers([DEMO_MEMBER])\n      setInvites([])\n      setLoading(false)\n      return\n    }\n\n    // No user, clear state\n    if (!user) {\n      setOrganization(null)\n      setMembership(null)\n      setMembers([])\n      setInvites([])\n      setLoading(false)\n      return\n    }\n\n    // Fetch user's organization\n    const initOrganization = async () => {\n      setLoading(true)\n      try {\n        // First, find user's membership\n        const userMembership = await fetchMembership(user.uid)\n\n        if (userMembership) {\n          setMembership(userMembership)\n\n          // Fetch the organization\n          const org = await fetchOrganization(userMembership.organizationId)\n          if (org) {\n            setOrganization(org)\n\n            // Fetch all members if user has permission\n            if (hasPermission(userMembership.role, 'canManageMembers')) {\n              const orgMembers = await fetchMembers(userMembership.organizationId)\n              setMembers(orgMembers)\n\n              const orgInvites = await fetchInvites(userMembership.organizationId)\n              setInvites(orgInvites)\n            } else {\n              setMembers([userMembership])\n              setInvites([])\n            }\n          }\n        } else {\n          // No membership found - user needs to create or join an org\n          setOrganization(null)\n          setMembership(null)\n          setMembers([])\n          setInvites([])\n        }\n      } catch (err) {\n        console.error('Error initializing organization:', err)\n        setError('Failed to load organization data')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    initOrganization()\n  }, [user, isDemo, authLoading, fetchMembership, fetchOrganization, fetchMembers, fetchInvites])\n\n  // Create a new organization\n  const createOrganization = useCallback(async (name: string, plan: PlanType = 'free'): Promise<Organization> => {\n    if (!user) throw new Error('Must be logged in to create an organization')\n    if (isDemo) throw new Error('Cannot create organization in demo mode')\n\n    try {\n      setError(null)\n\n      // Generate unique slug\n      let slug = generateSlug(name)\n      let slugExists = true\n      let attempts = 0\n\n      while (slugExists && attempts < 10) {\n        const slugQuery = query(\n          collection(db, 'organizations'),\n          where('slug', '==', slug)\n        )\n        const slugSnapshot = await getDocs(slugQuery)\n        slugExists = !slugSnapshot.empty\n\n        if (slugExists) {\n          slug = `${generateSlug(name)}-${Math.random().toString(36).substring(2, 6)}`\n          attempts++\n        }\n      }\n\n      // Create organization\n      const orgData = {\n        name,\n        slug,\n        plan,\n        planLimits: PLAN_LIMITS[plan],\n        settings: DEFAULT_ORG_SETTINGS,\n        ownerId: user.uid,\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n      }\n\n      const orgRef = await addDoc(collection(db, 'organizations'), orgData)\n\n      // Create owner membership\n      const displayName = userProfile?.displayName || user.displayName || null\n      const memberData = {\n        organizationId: orgRef.id,\n        userId: user.uid,\n        email: user.email || '',\n        ...(displayName && { displayName }),\n        role: 'owner' as MemberRole,\n        joinedAt: serverTimestamp(),\n      }\n\n      await addDoc(collection(db, 'organization_members'), memberData)\n\n      // Update user document with organizationId\n      await setDoc(doc(db, 'users', user.uid), {\n        organizationId: orgRef.id,\n      }, { merge: true })\n\n      const newOrg: Organization = {\n        ...orgData,\n        id: orgRef.id,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      }\n\n      const newMember: OrganizationMember = {\n        ...memberData,\n        id: 'temp-id',\n        displayName: displayName || '',\n        joinedAt: new Date(),\n      }\n\n      setOrganization(newOrg)\n      setMembership(newMember)\n      setMembers([newMember])\n\n      return newOrg\n    } catch (err) {\n      console.error('Error creating organization:', err)\n      setError('Failed to create organization')\n      throw err\n    }\n  }, [user, userProfile, isDemo])\n\n  // Update organization\n  const updateOrganization = useCallback(async (data: Partial<Organization>) => {\n    if (!organization || !membership) throw new Error('No organization')\n    if (!hasPermission(membership.role, 'canManageOrganization')) {\n      throw new Error('Insufficient permissions')\n    }\n    if (isDemo) throw new Error('Cannot update organization in demo mode')\n\n    try {\n      setError(null)\n\n      await updateDoc(doc(db, 'organizations', organization.id), {\n        ...data,\n        updatedAt: serverTimestamp(),\n      })\n\n      setOrganization(prev => prev ? { ...prev, ...data, updatedAt: new Date() } : null)\n    } catch (err) {\n      console.error('Error updating organization:', err)\n      setError('Failed to update organization')\n      throw err\n    }\n  }, [organization, membership, isDemo])\n\n  // Switch organization (for users with multiple orgs)\n  const switchOrganization = useCallback(async (orgId: string) => {\n    if (!user) throw new Error('Must be logged in')\n    if (isDemo) throw new Error('Cannot switch organization in demo mode')\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      // Verify user is a member of this org\n      const memberQuery = query(\n        collection(db, 'organization_members'),\n        where('organizationId', '==', orgId),\n        where('userId', '==', user.uid)\n      )\n      const memberSnapshot = await getDocs(memberQuery)\n\n      if (memberSnapshot.empty) {\n        throw new Error('You are not a member of this organization')\n      }\n\n      // Fetch the new organization\n      const org = await fetchOrganization(orgId)\n      if (!org) throw new Error('Organization not found')\n\n      const memberDoc = memberSnapshot.docs[0]\n      const memberData = memberDoc.data()\n      const newMembership: OrganizationMember = {\n        ...memberData,\n        id: memberDoc.id,\n        joinedAt: memberData.joinedAt?.toDate() || new Date(),\n      } as OrganizationMember\n\n      // Update user's current organization\n      await setDoc(doc(db, 'users', user.uid), {\n        organizationId: orgId,\n      }, { merge: true })\n\n      setOrganization(org)\n      setMembership(newMembership)\n\n      // Fetch members if permitted\n      if (hasPermission(newMembership.role, 'canManageMembers')) {\n        const orgMembers = await fetchMembers(orgId)\n        setMembers(orgMembers)\n\n        const orgInvites = await fetchInvites(orgId)\n        setInvites(orgInvites)\n      } else {\n        setMembers([newMembership])\n        setInvites([])\n      }\n    } catch (err) {\n      console.error('Error switching organization:', err)\n      setError('Failed to switch organization')\n      throw err\n    } finally {\n      setLoading(false)\n    }\n  }, [user, isDemo, fetchOrganization, fetchMembers, fetchInvites])\n\n  // Invite a member\n  const inviteMember = useCallback(async (email: string, role: MemberRole): Promise<OrganizationInvite> => {\n    if (!organization || !membership || !user) throw new Error('No organization')\n    if (!hasPermission(membership.role, 'canManageMembers')) {\n      throw new Error('Insufficient permissions')\n    }\n    if (isDemo) throw new Error('Cannot invite members in demo mode')\n\n    try {\n      setError(null)\n\n      // Check if user is already a member\n      const existingMemberQuery = query(\n        collection(db, 'organization_members'),\n        where('organizationId', '==', organization.id),\n        where('email', '==', email.toLowerCase())\n      )\n      const existingMember = await getDocs(existingMemberQuery)\n      if (!existingMember.empty) {\n        throw new Error('User is already a member')\n      }\n\n      // Check for existing pending invite\n      const existingInviteQuery = query(\n        collection(db, 'organization_invites'),\n        where('organizationId', '==', organization.id),\n        where('email', '==', email.toLowerCase()),\n        where('status', '==', 'pending')\n      )\n      const existingInvite = await getDocs(existingInviteQuery)\n      if (!existingInvite.empty) {\n        throw new Error('An invitation is already pending for this email')\n      }\n\n      // Create invite\n      const invitedByName = userProfile?.displayName || user.displayName || null\n      const inviteData = {\n        organizationId: organization.id,\n        email: email.toLowerCase(),\n        role,\n        invitedBy: user.uid,\n        ...(invitedByName && { invitedByName }),\n        organizationName: organization.name,\n        status: 'pending' as const,\n        token: generateInviteToken(),\n        createdAt: serverTimestamp(),\n        expiresAt: Timestamp.fromDate(new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)), // 7 days\n      }\n\n      const inviteRef = await addDoc(collection(db, 'organization_invites'), inviteData)\n\n      const newInvite: OrganizationInvite = {\n        ...inviteData,\n        id: inviteRef.id,\n        createdAt: new Date(),\n        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),\n      }\n\n      setInvites(prev => [...prev, newInvite])\n\n      return newInvite\n    } catch (err) {\n      console.error('Error inviting member:', err)\n      setError(err instanceof Error ? err.message : 'Failed to send invitation')\n      throw err\n    }\n  }, [organization, membership, user, userProfile, isDemo])\n\n  // Update member role\n  const updateMemberRole = useCallback(async (memberId: string, role: MemberRole) => {\n    if (!organization || !membership) throw new Error('No organization')\n    if (!hasPermission(membership.role, 'canManageMembers')) {\n      throw new Error('Insufficient permissions')\n    }\n    if (isDemo) throw new Error('Cannot update members in demo mode')\n\n    try {\n      setError(null)\n\n      await updateDoc(doc(db, 'organization_members', memberId), { role })\n\n      setMembers(prev =>\n        prev.map(m => m.id === memberId ? { ...m, role } : m)\n      )\n    } catch (err) {\n      console.error('Error updating member role:', err)\n      setError('Failed to update member role')\n      throw err\n    }\n  }, [organization, membership, isDemo])\n\n  // Remove member\n  const removeMember = useCallback(async (memberId: string) => {\n    if (!organization || !membership) throw new Error('No organization')\n    if (!hasPermission(membership.role, 'canManageMembers')) {\n      throw new Error('Insufficient permissions')\n    }\n    if (isDemo) throw new Error('Cannot remove members in demo mode')\n\n    try {\n      setError(null)\n\n      // Get the member being removed\n      const memberToRemove = members.find(m => m.id === memberId)\n      if (memberToRemove?.role === 'owner') {\n        throw new Error('Cannot remove the organization owner')\n      }\n\n      await deleteDoc(doc(db, 'organization_members', memberId))\n\n      setMembers(prev => prev.filter(m => m.id !== memberId))\n    } catch (err) {\n      console.error('Error removing member:', err)\n      setError(err instanceof Error ? err.message : 'Failed to remove member')\n      throw err\n    }\n  }, [organization, membership, members, isDemo])\n\n  // Revoke invite\n  const revokeInvite = useCallback(async (inviteId: string) => {\n    if (!organization || !membership) throw new Error('No organization')\n    if (!hasPermission(membership.role, 'canManageMembers')) {\n      throw new Error('Insufficient permissions')\n    }\n    if (isDemo) throw new Error('Cannot revoke invites in demo mode')\n\n    try {\n      setError(null)\n\n      await updateDoc(doc(db, 'organization_invites', inviteId), {\n        status: 'revoked',\n      })\n\n      setInvites(prev => prev.filter(i => i.id !== inviteId))\n    } catch (err) {\n      console.error('Error revoking invite:', err)\n      setError('Failed to revoke invitation')\n      throw err\n    }\n  }, [organization, membership, isDemo])\n\n  // Check for pending invites for an email\n  const checkPendingInvites = useCallback(async (email: string): Promise<OrganizationInvite[]> => {\n    try {\n      const invitesQuery = query(\n        collection(db, 'organization_invites'),\n        where('email', '==', email.toLowerCase()),\n        where('status', '==', 'pending')\n      )\n      const snapshot = await getDocs(invitesQuery)\n\n      return snapshot.docs.map(doc => {\n        const data = doc.data()\n        return {\n          ...data,\n          id: doc.id,\n          createdAt: data.createdAt?.toDate() || new Date(),\n          expiresAt: data.expiresAt?.toDate() || new Date(),\n        } as OrganizationInvite\n      }).filter(invite => invite.expiresAt > new Date())\n    } catch (err) {\n      console.error('Error checking invites:', err)\n      return []\n    }\n  }, [])\n\n  // Accept invite\n  const acceptInvite = useCallback(async (inviteId: string) => {\n    if (!user) throw new Error('Must be logged in')\n    if (isDemo) throw new Error('Cannot accept invites in demo mode')\n\n    try {\n      setLoading(true)\n      setError(null)\n\n      // Get the invite\n      const inviteDoc = await getDoc(doc(db, 'organization_invites', inviteId))\n      if (!inviteDoc.exists()) throw new Error('Invite not found')\n\n      const invite = inviteDoc.data()\n      if (invite.status !== 'pending') throw new Error('Invite is no longer valid')\n      if (invite.email !== user.email?.toLowerCase()) throw new Error('This invite is for a different email')\n      if (invite.expiresAt.toDate() < new Date()) throw new Error('Invite has expired')\n\n      // Create membership\n      const displayName = userProfile?.displayName || user.displayName || null\n      const memberData = {\n        organizationId: invite.organizationId,\n        userId: user.uid,\n        email: user.email,\n        ...(displayName && { displayName }),\n        role: invite.role,\n        invitedBy: invite.invitedBy,\n        joinedAt: serverTimestamp(),\n      }\n\n      await addDoc(collection(db, 'organization_members'), memberData)\n\n      // Update invite status\n      await updateDoc(doc(db, 'organization_invites', inviteId), {\n        status: 'accepted',\n        acceptedAt: serverTimestamp(),\n      })\n\n      // Update user's organization\n      await setDoc(doc(db, 'users', user.uid), {\n        organizationId: invite.organizationId,\n      }, { merge: true })\n\n      // Fetch the organization\n      const org = await fetchOrganization(invite.organizationId)\n      if (org) {\n        setOrganization(org)\n        setMembership({\n          ...memberData,\n          id: 'new-member',\n          displayName: displayName || '',\n          joinedAt: new Date(),\n        } as OrganizationMember)\n      }\n    } catch (err) {\n      console.error('Error accepting invite:', err)\n      setError(err instanceof Error ? err.message : 'Failed to accept invitation')\n      throw err\n    } finally {\n      setLoading(false)\n    }\n  }, [user, userProfile, isDemo, fetchOrganization])\n\n  // Decline invite\n  const declineInvite = useCallback(async (inviteId: string) => {\n    if (isDemo) throw new Error('Cannot decline invites in demo mode')\n\n    try {\n      setError(null)\n\n      await updateDoc(doc(db, 'organization_invites', inviteId), {\n        status: 'revoked',\n      })\n    } catch (err) {\n      console.error('Error declining invite:', err)\n      setError('Failed to decline invitation')\n      throw err\n    }\n  }, [isDemo])\n\n  // Refresh organization data\n  const refreshOrganization = useCallback(async () => {\n    if (!organization || isDemo) return\n\n    try {\n      setLoading(true)\n      const org = await fetchOrganization(organization.id)\n      if (org) setOrganization(org)\n\n      if (membership && hasPermission(membership.role, 'canManageMembers')) {\n        const orgMembers = await fetchMembers(organization.id)\n        setMembers(orgMembers)\n\n        const orgInvites = await fetchInvites(organization.id)\n        setInvites(orgInvites)\n      }\n    } catch (err) {\n      console.error('Error refreshing organization:', err)\n    } finally {\n      setLoading(false)\n    }\n  }, [organization, membership, isDemo, fetchOrganization, fetchMembers, fetchInvites])\n\n  const value: OrganizationContextType = {\n    // State\n    organization,\n    membership,\n    members,\n    invites,\n    loading,\n    error,\n\n    // Computed\n    isOwner,\n    isAdmin,\n    permissions,\n    hasOrganization,\n    needsSetup,\n\n    // Organization management\n    createOrganization,\n    updateOrganization,\n    switchOrganization,\n\n    // Member management\n    inviteMember,\n    updateMemberRole,\n    removeMember,\n    revokeInvite,\n\n    // Invite handling\n    checkPendingInvites,\n    acceptInvite,\n    declineInvite,\n\n    // Utilities\n    clearError,\n    refreshOrganization,\n  }\n\n  return (\n    <OrganizationContext.Provider value={value}>\n      {children}\n    </OrganizationContext.Provider>\n  )\n}\n\n// Hook to use organization context\nexport function useOrganization() {\n  const context = useContext(OrganizationContext)\n  if (context === undefined) {\n    throw new Error('useOrganization must be used within an OrganizationProvider')\n  }\n  return context\n}\n","// Organization Types for Multi-Tenant Architecture\n\nexport type PlanType = 'free' | 'starter' | 'professional' | 'enterprise';\nexport type MemberRole = 'owner' | 'admin' | 'manager' | 'staff' | 'viewer';\nexport type InviteStatus = 'pending' | 'accepted' | 'expired' | 'revoked';\n\nexport interface PlanLimits {\n  users: number;\n  products: number;\n  ordersPerMonth: number;\n  locations: number;\n}\n\nexport interface OrganizationSettings {\n  timezone: string;\n  currency: string;\n  dateFormat: string;\n  autoJoinDomain?: boolean; // Allow users with matching domain to auto-join\n  requireApproval?: boolean; // Require admin approval for new members\n  defaultMemberRole: MemberRole;\n}\n\nexport interface Organization {\n  id: string;\n  name: string;\n  slug: string; // URL-friendly identifier (unique)\n  domain?: string; // Company email domain for auto-join\n  logo?: string;\n  plan: PlanType;\n  planLimits: PlanLimits;\n  settings: OrganizationSettings;\n  createdAt: Date;\n  updatedAt: Date;\n  ownerId: string; // User ID of the organization owner\n}\n\nexport interface OrganizationMember {\n  id: string;\n  organizationId: string;\n  userId: string;\n  email: string;\n  displayName?: string;\n  role: MemberRole;\n  invitedBy?: string; // User ID who invited this member\n  joinedAt: Date;\n  lastActiveAt?: Date;\n}\n\nexport interface OrganizationInvite {\n  id: string;\n  organizationId: string;\n  email: string;\n  role: MemberRole;\n  invitedBy: string; // User ID\n  invitedByName?: string;\n  organizationName?: string;\n  status: InviteStatus;\n  expiresAt: Date;\n  createdAt: Date;\n  acceptedAt?: Date;\n  token: string; // Unique token for accepting invite\n}\n\n// Extended user profile with organization info\nexport interface UserWithOrg {\n  id: string;\n  email: string;\n  displayName?: string;\n  organizationId?: string; // Current/primary organization\n  organizations?: string[]; // All organizations user belongs to\n  currentOrgRole?: MemberRole;\n}\n\n// Default plan limits by plan type\nexport const PLAN_LIMITS: Record<PlanType, PlanLimits> = {\n  free: {\n    users: 1,\n    products: 50,\n    ordersPerMonth: 100,\n    locations: 1,\n  },\n  starter: {\n    users: 3,\n    products: 500,\n    ordersPerMonth: 1000,\n    locations: 2,\n  },\n  professional: {\n    users: 10,\n    products: 5000,\n    ordersPerMonth: 10000,\n    locations: 5,\n  },\n  enterprise: {\n    users: -1, // Unlimited\n    products: -1,\n    ordersPerMonth: -1,\n    locations: -1,\n  },\n};\n\n// Default organization settings\nexport const DEFAULT_ORG_SETTINGS: OrganizationSettings = {\n  timezone: 'America/Chicago',\n  currency: 'USD',\n  dateFormat: 'MM/DD/YYYY',\n  autoJoinDomain: false,\n  requireApproval: false,\n  defaultMemberRole: 'staff',\n};\n\n// Role permissions\nexport interface RolePermissions {\n  canManageOrganization: boolean;\n  canManageMembers: boolean;\n  canManageIntegrations: boolean;\n  canManageProducts: boolean;\n  canManageOrders: boolean;\n  canManageInventory: boolean;\n  canViewReports: boolean;\n  canExportData: boolean;\n}\n\nexport const ROLE_PERMISSIONS: Record<MemberRole, RolePermissions> = {\n  owner: {\n    canManageOrganization: true,\n    canManageMembers: true,\n    canManageIntegrations: true,\n    canManageProducts: true,\n    canManageOrders: true,\n    canManageInventory: true,\n    canViewReports: true,\n    canExportData: true,\n  },\n  admin: {\n    canManageOrganization: true,\n    canManageMembers: true,\n    canManageIntegrations: true,\n    canManageProducts: true,\n    canManageOrders: true,\n    canManageInventory: true,\n    canViewReports: true,\n    canExportData: true,\n  },\n  manager: {\n    canManageOrganization: false,\n    canManageMembers: false,\n    canManageIntegrations: false,\n    canManageProducts: true,\n    canManageOrders: true,\n    canManageInventory: true,\n    canViewReports: true,\n    canExportData: true,\n  },\n  staff: {\n    canManageOrganization: false,\n    canManageMembers: false,\n    canManageIntegrations: false,\n    canManageProducts: false,\n    canManageOrders: true,\n    canManageInventory: true,\n    canViewReports: false,\n    canExportData: false,\n  },\n  viewer: {\n    canManageOrganization: false,\n    canManageMembers: false,\n    canManageIntegrations: false,\n    canManageProducts: false,\n    canManageOrders: false,\n    canManageInventory: false,\n    canViewReports: true,\n    canExportData: false,\n  },\n};\n\n// Helper to check if a role has a specific permission\nexport function hasPermission(role: MemberRole, permission: keyof RolePermissions): boolean {\n  return ROLE_PERMISSIONS[role]?.[permission] ?? false;\n}\n\n// Helper to check if user can perform role assignment\nexport function canAssignRole(assignerRole: MemberRole, targetRole: MemberRole): boolean {\n  const roleHierarchy: MemberRole[] = ['owner', 'admin', 'manager', 'staff', 'viewer'];\n  const assignerIndex = roleHierarchy.indexOf(assignerRole);\n  const targetIndex = roleHierarchy.indexOf(targetRole);\n\n  // Can only assign roles lower than your own (higher index)\n  // Owner can assign any role, admin can assign manager and below, etc.\n  if (assignerRole === 'owner') return true;\n  if (assignerRole === 'admin') return targetIndex > 0; // Can't assign owner\n  return false; // Only owner and admin can assign roles\n}\n\n// Generate a URL-friendly slug from organization name\nexport function generateSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .slice(0, 50);\n}\n\n// Generate a unique invite token\nexport function generateInviteToken(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let token = '';\n  for (let i = 0; i < 32; i++) {\n    token += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return token;\n}\n"],"names":[],"mappings":"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"}