module.exports=[90761,50121,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(18740),f=a.i(53131);let g={free:{users:1,products:50,ordersPerMonth:100,locations:1},starter:{users:3,products:500,ordersPerMonth:1e3,locations:2},professional:{users:10,products:5e3,ordersPerMonth:1e4,locations:5},enterprise:{users:-1,products:-1,ordersPerMonth:-1,locations:-1}},h={timezone:"America/Chicago",currency:"USD",dateFormat:"MM/DD/YYYY",autoJoinDomain:!1,requireApproval:!1,defaultMemberRole:"staff"},i={owner:{canManageOrganization:!0,canManageMembers:!0,canManageIntegrations:!0,canManageProducts:!0,canManageOrders:!0,canManageInventory:!0,canViewReports:!0,canExportData:!0},admin:{canManageOrganization:!0,canManageMembers:!0,canManageIntegrations:!0,canManageProducts:!0,canManageOrders:!0,canManageInventory:!0,canViewReports:!0,canExportData:!0},manager:{canManageOrganization:!1,canManageMembers:!1,canManageIntegrations:!1,canManageProducts:!0,canManageOrders:!0,canManageInventory:!0,canViewReports:!0,canExportData:!0},staff:{canManageOrganization:!1,canManageMembers:!1,canManageIntegrations:!1,canManageProducts:!1,canManageOrders:!0,canManageInventory:!0,canViewReports:!1,canExportData:!1},viewer:{canManageOrganization:!1,canManageMembers:!1,canManageIntegrations:!1,canManageProducts:!1,canManageOrders:!1,canManageInventory:!1,canViewReports:!0,canExportData:!1}};function j(a,b){return i[a]?.[b]??!1}function k(a){return a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,50)}function l(){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b="";for(let c=0;c<32;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b}a.s(["DEFAULT_ORG_SETTINGS",0,h,"PLAN_LIMITS",0,g,"ROLE_PERMISSIONS",0,i,"generateInviteToken",()=>l,"generateSlug",()=>k,"hasPermission",()=>j],50121);let m={id:"demo-org-id",name:"Cronk Nutrients (Demo)",slug:"cronk-demo",plan:"enterprise",planLimits:g.enterprise,settings:{...h,timezone:"America/Chicago",currency:"USD"},createdAt:new Date,updatedAt:new Date,ownerId:"demo-user-id"},n={id:"demo-member-id",organizationId:"demo-org-id",userId:"demo-user-id",email:"demo@cronknutrients.com",displayName:"Demo User",role:"owner",joinedAt:new Date},o=(0,c.createContext)(void 0);function p({children:a}){let{user:p,userProfile:q,isDemo:r,loading:s}=(0,f.useAuth)(),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(null),F=v?.role==="owner",G=v?.role==="admin"||v?.role==="owner",H=v?i[v.role]:null,I=!!t,J=!s&&!r&&!!p&&!t&&!B,K=(0,c.useCallback)(()=>E(null),[]),L=(0,c.useCallback)(async a=>{try{let b=await (0,d.getDoc)((0,d.doc)(e.db,"organizations",a));if(b.exists()){let a=b.data();return{...a,id:b.id,createdAt:a.createdAt?.toDate()||new Date,updatedAt:a.updatedAt?.toDate()||new Date}}return null}catch(a){return console.error("Error fetching organization:",a),null}},[]),M=(0,c.useCallback)(async a=>{try{let b=(0,d.query)((0,d.collection)(e.db,"organization_members"),(0,d.where)("userId","==",a)),c=await (0,d.getDocs)(b);if(!c.empty){let a=c.docs[0],b=a.data();return{...b,id:a.id,joinedAt:b.joinedAt?.toDate()||new Date,lastActiveAt:b.lastActiveAt?.toDate()}}return null}catch(a){return console.error("Error fetching membership:",a),null}},[]),N=(0,c.useCallback)(async a=>{try{let b=(0,d.query)((0,d.collection)(e.db,"organization_members"),(0,d.where)("organizationId","==",a));return(await (0,d.getDocs)(b)).docs.map(a=>{let b=a.data();return{...b,id:a.id,joinedAt:b.joinedAt?.toDate()||new Date,lastActiveAt:b.lastActiveAt?.toDate()}})}catch(a){return console.error("Error fetching members:",a),[]}},[]),O=(0,c.useCallback)(async a=>{try{let b=(0,d.query)((0,d.collection)(e.db,"organization_invites"),(0,d.where)("organizationId","==",a),(0,d.where)("status","==","pending"));return(await (0,d.getDocs)(b)).docs.map(a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt?.toDate()||new Date,expiresAt:b.expiresAt?.toDate()||new Date,acceptedAt:b.acceptedAt?.toDate()}})}catch(a){return console.error("Error fetching invites:",a),[]}},[]);(0,c.useEffect)(()=>{if(!s){if(r){u(m),w(n),y([n]),A([]),C(!1);return}if(!p){u(null),w(null),y([]),A([]),C(!1);return}(async()=>{C(!0);try{let a=await M(p.uid);if(a){w(a);let b=await L(a.organizationId);if(b)if(u(b),j(a.role,"canManageMembers")){let b=await N(a.organizationId);y(b);let c=await O(a.organizationId);A(c)}else y([a]),A([])}else u(null),w(null),y([]),A([])}catch(a){console.error("Error initializing organization:",a),E("Failed to load organization data")}finally{C(!1)}})()}},[p,r,s,M,L,N,O]);let P=(0,c.useCallback)(async(a,b="free")=>{if(!p)throw Error("Must be logged in to create an organization");if(r)throw Error("Cannot create organization in demo mode");try{E(null);let c=k(a),f=!0,i=0;for(;f&&i<10;){let b=(0,d.query)((0,d.collection)(e.db,"organizations"),(0,d.where)("slug","==",c));(f=!(await (0,d.getDocs)(b)).empty)&&(c=`${k(a)}-${Math.random().toString(36).substring(2,6)}`,i++)}let j={name:a,slug:c,plan:b,planLimits:g[b],settings:h,ownerId:p.uid,createdAt:(0,d.serverTimestamp)(),updatedAt:(0,d.serverTimestamp)()},l=await (0,d.addDoc)((0,d.collection)(e.db,"organizations"),j),m=q?.displayName||p.displayName||null,n={organizationId:l.id,userId:p.uid,email:p.email||"",...m&&{displayName:m},role:"owner",joinedAt:(0,d.serverTimestamp)()};await (0,d.addDoc)((0,d.collection)(e.db,"organization_members"),n),await (0,d.setDoc)((0,d.doc)(e.db,"users",p.uid),{organizationId:l.id},{merge:!0});let o={...j,id:l.id,createdAt:new Date,updatedAt:new Date},r={...n,id:"temp-id",displayName:m||"",joinedAt:new Date};return u(o),w(r),y([r]),o}catch(a){throw console.error("Error creating organization:",a),E("Failed to create organization"),a}},[p,q,r]),Q=(0,c.useCallback)(async a=>{if(!t||!v)throw Error("No organization");if(!j(v.role,"canManageOrganization"))throw Error("Insufficient permissions");if(r)throw Error("Cannot update organization in demo mode");try{E(null),await (0,d.updateDoc)((0,d.doc)(e.db,"organizations",t.id),{...a,updatedAt:(0,d.serverTimestamp)()}),u(b=>b?{...b,...a,updatedAt:new Date}:null)}catch(a){throw console.error("Error updating organization:",a),E("Failed to update organization"),a}},[t,v,r]),R=(0,c.useCallback)(async a=>{if(!p)throw Error("Must be logged in");if(r)throw Error("Cannot switch organization in demo mode");try{C(!0),E(null);let b=(0,d.query)((0,d.collection)(e.db,"organization_members"),(0,d.where)("organizationId","==",a),(0,d.where)("userId","==",p.uid)),c=await (0,d.getDocs)(b);if(c.empty)throw Error("You are not a member of this organization");let f=await L(a);if(!f)throw Error("Organization not found");let g=c.docs[0],h=g.data(),i={...h,id:g.id,joinedAt:h.joinedAt?.toDate()||new Date};if(await (0,d.setDoc)((0,d.doc)(e.db,"users",p.uid),{organizationId:a},{merge:!0}),u(f),w(i),j(i.role,"canManageMembers")){let b=await N(a);y(b);let c=await O(a);A(c)}else y([i]),A([])}catch(a){throw console.error("Error switching organization:",a),E("Failed to switch organization"),a}finally{C(!1)}},[p,r,L,N,O]),S=(0,c.useCallback)(async(a,b)=>{if(!t||!v||!p)throw Error("No organization");if(!j(v.role,"canManageMembers"))throw Error("Insufficient permissions");if(r)throw Error("Cannot invite members in demo mode");try{E(null);let c=(0,d.query)((0,d.collection)(e.db,"organization_members"),(0,d.where)("organizationId","==",t.id),(0,d.where)("email","==",a.toLowerCase()));if(!(await (0,d.getDocs)(c)).empty)throw Error("User is already a member");let f=(0,d.query)((0,d.collection)(e.db,"organization_invites"),(0,d.where)("organizationId","==",t.id),(0,d.where)("email","==",a.toLowerCase()),(0,d.where)("status","==","pending"));if(!(await (0,d.getDocs)(f)).empty)throw Error("An invitation is already pending for this email");let g=q?.displayName||p.displayName||null,h={organizationId:t.id,email:a.toLowerCase(),role:b,invitedBy:p.uid,...g&&{invitedByName:g},organizationName:t.name,status:"pending",token:l(),createdAt:(0,d.serverTimestamp)(),expiresAt:d.Timestamp.fromDate(new Date(Date.now()+6048e5))},i=await (0,d.addDoc)((0,d.collection)(e.db,"organization_invites"),h),j={...h,id:i.id,createdAt:new Date,expiresAt:new Date(Date.now()+6048e5)};return A(a=>[...a,j]),j}catch(a){throw console.error("Error inviting member:",a),E(a instanceof Error?a.message:"Failed to send invitation"),a}},[t,v,p,q,r]),T=(0,c.useCallback)(async(a,b)=>{if(!t||!v)throw Error("No organization");if(!j(v.role,"canManageMembers"))throw Error("Insufficient permissions");if(r)throw Error("Cannot update members in demo mode");try{E(null),await (0,d.updateDoc)((0,d.doc)(e.db,"organization_members",a),{role:b}),y(c=>c.map(c=>c.id===a?{...c,role:b}:c))}catch(a){throw console.error("Error updating member role:",a),E("Failed to update member role"),a}},[t,v,r]),U=(0,c.useCallback)(async a=>{if(!t||!v)throw Error("No organization");if(!j(v.role,"canManageMembers"))throw Error("Insufficient permissions");if(r)throw Error("Cannot remove members in demo mode");try{E(null);let b=x.find(b=>b.id===a);if(b?.role==="owner")throw Error("Cannot remove the organization owner");await (0,d.deleteDoc)((0,d.doc)(e.db,"organization_members",a)),y(b=>b.filter(b=>b.id!==a))}catch(a){throw console.error("Error removing member:",a),E(a instanceof Error?a.message:"Failed to remove member"),a}},[t,v,x,r]),V=(0,c.useCallback)(async a=>{if(!t||!v)throw Error("No organization");if(!j(v.role,"canManageMembers"))throw Error("Insufficient permissions");if(r)throw Error("Cannot revoke invites in demo mode");try{E(null),await (0,d.updateDoc)((0,d.doc)(e.db,"organization_invites",a),{status:"revoked"}),A(b=>b.filter(b=>b.id!==a))}catch(a){throw console.error("Error revoking invite:",a),E("Failed to revoke invitation"),a}},[t,v,r]),W=(0,c.useCallback)(async a=>{try{let b=(0,d.query)((0,d.collection)(e.db,"organization_invites"),(0,d.where)("email","==",a.toLowerCase()),(0,d.where)("status","==","pending"));return(await (0,d.getDocs)(b)).docs.map(a=>{let b=a.data();return{...b,id:a.id,createdAt:b.createdAt?.toDate()||new Date,expiresAt:b.expiresAt?.toDate()||new Date}}).filter(a=>a.expiresAt>new Date)}catch(a){return console.error("Error checking invites:",a),[]}},[]),X=(0,c.useCallback)(async a=>{if(!p)throw Error("Must be logged in");if(r)throw Error("Cannot accept invites in demo mode");try{C(!0),E(null);let b=await (0,d.getDoc)((0,d.doc)(e.db,"organization_invites",a));if(!b.exists())throw Error("Invite not found");let c=b.data();if("pending"!==c.status)throw Error("Invite is no longer valid");if(c.email!==p.email?.toLowerCase())throw Error("This invite is for a different email");if(c.expiresAt.toDate()<new Date)throw Error("Invite has expired");let f=q?.displayName||p.displayName||null,g={organizationId:c.organizationId,userId:p.uid,email:p.email,...f&&{displayName:f},role:c.role,invitedBy:c.invitedBy,joinedAt:(0,d.serverTimestamp)()};await (0,d.addDoc)((0,d.collection)(e.db,"organization_members"),g),await (0,d.updateDoc)((0,d.doc)(e.db,"organization_invites",a),{status:"accepted",acceptedAt:(0,d.serverTimestamp)()}),await (0,d.setDoc)((0,d.doc)(e.db,"users",p.uid),{organizationId:c.organizationId},{merge:!0});let h=await L(c.organizationId);h&&(u(h),w({...g,id:"new-member",displayName:f||"",joinedAt:new Date}))}catch(a){throw console.error("Error accepting invite:",a),E(a instanceof Error?a.message:"Failed to accept invitation"),a}finally{C(!1)}},[p,q,r,L]),Y=(0,c.useCallback)(async a=>{if(r)throw Error("Cannot decline invites in demo mode");try{E(null),await (0,d.updateDoc)((0,d.doc)(e.db,"organization_invites",a),{status:"revoked"})}catch(a){throw console.error("Error declining invite:",a),E("Failed to decline invitation"),a}},[r]),Z=(0,c.useCallback)(async()=>{if(t&&!r)try{C(!0);let a=await L(t.id);if(a&&u(a),v&&j(v.role,"canManageMembers")){let a=await N(t.id);y(a);let b=await O(t.id);A(b)}}catch(a){console.error("Error refreshing organization:",a)}finally{C(!1)}},[t,v,r,L,N,O]);return(0,b.jsx)(o.Provider,{value:{organization:t,membership:v,members:x,invites:z,loading:B,error:D,isOwner:F,isAdmin:G,permissions:H,hasOrganization:I,needsSetup:J,createOrganization:P,updateOrganization:Q,switchOrganization:R,inviteMember:S,updateMemberRole:T,removeMember:U,revokeInvite:V,checkPendingInvites:W,acceptInvite:X,declineInvite:Y,clearError:K,refreshOrganization:Z},children:a})}function q(){let a=(0,c.useContext)(o);if(void 0===a)throw Error("useOrganization must be used within an OrganizationProvider");return a}a.s(["OrganizationProvider",()=>p,"useOrganization",()=>q],90761)}];

//# sourceMappingURL=context_OrganizationContext_tsx_88aecfd3._.js.map