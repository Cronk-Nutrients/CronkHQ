{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/1TB%20SSD/inventory-app/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert, App } from 'firebase-admin/app'\nimport { getFirestore, Firestore } from 'firebase-admin/firestore'\n\nlet adminApp: App | undefined\nlet adminDb: Firestore | undefined\n\nfunction getAdminApp(): App {\n  if (adminApp) {\n    return adminApp\n  }\n\n  const apps = getApps()\n  if (apps.length > 0) {\n    adminApp = apps[0]\n    return adminApp\n  }\n\n  // Initialize Firebase Admin\n  // For production, use environment variables\n  // For local development, you can use a service account JSON file\n\n  const projectId = process.env.FIREBASE_PROJECT_ID\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL\n  const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n')\n\n  if (!projectId || !clientEmail || !privateKey) {\n    throw new Error(\n      'Firebase Admin SDK credentials not found. Please set FIREBASE_PROJECT_ID, FIREBASE_CLIENT_EMAIL, and FIREBASE_PRIVATE_KEY environment variables.'\n    )\n  }\n\n  adminApp = initializeApp({\n    credential: cert({\n      projectId,\n      clientEmail,\n      privateKey,\n    }),\n  })\n\n  return adminApp\n}\n\nexport function getAdminDb(): Firestore {\n  if (adminDb) {\n    return adminDb\n  }\n\n  getAdminApp()\n  adminDb = getFirestore()\n  return adminDb\n}\n\n// Export a lazy-initialized adminDb for convenience\nexport { getAdminDb as adminDb }\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACP,IAAI,UAAU;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,IAAA,mNAAO;IACpB,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,WAAW,IAAI,CAAC,EAAE;QAClB,OAAO;IACT;IAEA,4BAA4B;IAC5B,4CAA4C;IAC5C,iEAAiE;IAEjE,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;IACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;IACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;IAErE,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,YAAY;QAC7C,MAAM,IAAI,MACR;IAEJ;IAEA,WAAW,IAAA,yNAAa,EAAC;QACvB,YAAY,IAAA,gNAAI,EAAC;YACf;YACA;YACA;QACF;IACF;IAEA,OAAO;AACT;AAEO,SAAS;IACd,IAAI,SAAS;QACX,OAAO;IACT;IAEA;IACA,UAAU,IAAA,oOAAY;IACtB,OAAO;AACT"}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/1TB%20SSD/inventory-app/app/api/shopify/sync-orders/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getAdminDb } from '@/lib/firebase-admin'\nimport { FieldValue } from 'firebase-admin/firestore'\n\ninterface ShopifyLineItem {\n  id: number\n  product_id: number | null\n  variant_id: number | null\n  sku: string | null\n  name: string\n  title: string\n  variant_title: string | null\n  quantity: number\n  price: string\n  total_discount: string\n  requires_shipping: boolean\n  fulfillable_quantity: number\n  fulfillment_status: string | null\n  grams: number\n  vendor: string | null\n  properties: { name: string; value: string }[]\n  gift_card: boolean\n  taxable: boolean\n  tax_lines: { title: string; price: string; rate: number }[]\n}\n\ninterface ShopifyAddress {\n  first_name: string\n  last_name: string\n  company: string | null\n  address1: string\n  address2: string | null\n  city: string\n  province: string\n  province_code: string\n  country: string\n  country_code: string\n  zip: string\n  phone: string | null\n  name: string\n  latitude: number | null\n  longitude: number | null\n}\n\ninterface ShopifyFulfillment {\n  id: number\n  order_id: number\n  status: string\n  created_at: string\n  updated_at: string\n  tracking_company: string | null\n  tracking_number: string | null\n  tracking_numbers: string[]\n  tracking_url: string | null\n  tracking_urls: string[]\n  shipment_status: string | null\n  line_items: ShopifyLineItem[]\n}\n\ninterface ShopifyRefundLineItem {\n  id: number\n  quantity: number\n  line_item_id: number\n  restock_type: string\n  subtotal: string\n  total_tax: string\n}\n\ninterface ShopifyRefund {\n  id: number\n  order_id: number\n  created_at: string\n  note: string | null\n  user_id: number | null\n  processed_at: string\n  refund_line_items: ShopifyRefundLineItem[]\n  transactions: {\n    id: number\n    amount: string\n    kind: string\n    gateway: string\n    status: string\n  }[]\n}\n\ninterface ShopifyOrder {\n  id: number\n  order_number: number\n  name: string\n  email: string\n  phone: string | null\n  created_at: string\n  updated_at: string\n  processed_at: string\n  closed_at: string | null\n  cancelled_at: string | null\n  cancel_reason: string | null\n\n  financial_status: string\n  fulfillment_status: string | null\n\n  currency: string\n  subtotal_price: string\n  total_price: string\n  total_tax: string\n  total_discounts: string\n  total_shipping_price_set: { shop_money: { amount: string } }\n  total_weight: number\n\n  note: string | null\n  note_attributes: { name: string; value: string }[]\n  tags: string\n\n  customer: {\n    id: number\n    email: string\n    first_name: string\n    last_name: string\n    phone: string | null\n    orders_count: number\n    total_spent: string\n    tags: string\n  } | null\n\n  billing_address: ShopifyAddress | null\n  shipping_address: ShopifyAddress | null\n\n  line_items: ShopifyLineItem[]\n  shipping_lines: {\n    id: number\n    title: string\n    price: string\n    code: string | null\n    source: string\n    carrier_identifier: string | null\n    requested_fulfillment_service_id: string | null\n  }[]\n\n  discount_codes: {\n    code: string\n    amount: string\n    type: string\n  }[]\n  discount_applications: {\n    type: string\n    title: string | null\n    description: string | null\n    value: string\n    value_type: string\n    allocation_method: string\n    target_selection: string\n    target_type: string\n  }[]\n\n  fulfillments: ShopifyFulfillment[]\n  refunds: ShopifyRefund[]\n\n  payment_gateway_names: string[]\n  processing_method: string\n  source_name: string\n\n  tax_lines: { title: string; price: string; rate: number }[]\n\n  browser_ip: string | null\n  landing_site: string | null\n  referring_site: string | null\n\n  location_id: number | null\n\n  gateway: string\n  test: boolean\n  confirmed: boolean\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const {\n      organizationId,\n      importMode = 'unfulfilled',  // 'unfulfilled' | 'all' | 'date_range'\n      startDate,                   // ISO date string for date_range mode\n      endDate,                     // ISO date string for date_range mode\n      includeStatus = 'any'        // 'any' | 'open' | 'closed' | 'cancelled'\n    } = body\n\n    if (!organizationId) {\n      return NextResponse.json({ success: false, error: 'Missing organization ID' }, { status: 400 })\n    }\n\n    let adminDb\n    try {\n      adminDb = getAdminDb()\n    } catch (adminError: any) {\n      console.error('Firebase Admin init error:', adminError)\n      return NextResponse.json({\n        success: false,\n        error: 'Server configuration error. Please contact support.'\n      }, { status: 500 })\n    }\n\n    // Get Shopify credentials\n    const orgDoc = await adminDb.collection('organizations').doc(organizationId).get()\n    if (!orgDoc.exists) {\n      return NextResponse.json({ success: false, error: 'Organization not found' }, { status: 404 })\n    }\n\n    const orgData = orgDoc.data()\n    const shopify = orgData?.shopify\n\n    if (!shopify?.isConnected || !shopify?.accessToken) {\n      return NextResponse.json({ success: false, error: 'Shopify not connected' }, { status: 400 })\n    }\n\n    // Build query parameters based on import mode\n    const queryParams = new URLSearchParams()\n    queryParams.set('limit', '250')\n\n    if (importMode === 'unfulfilled') {\n      queryParams.set('status', 'open')\n      queryParams.set('fulfillment_status', 'unfulfilled')\n    } else if (importMode === 'date_range') {\n      if (startDate) {\n        queryParams.set('created_at_min', new Date(startDate).toISOString())\n      }\n      if (endDate) {\n        queryParams.set('created_at_max', new Date(endDate).toISOString())\n      }\n      if (includeStatus !== 'any') {\n        queryParams.set('status', includeStatus)\n      }\n    } else {\n      // Import all - no filters except status if specified\n      if (includeStatus !== 'any') {\n        queryParams.set('status', includeStatus)\n      }\n    }\n\n    // Get existing orders by Shopify ID\n    const ordersRef = adminDb.collection('organizations').doc(organizationId).collection('orders')\n    const existingSnapshot = await ordersRef.where('shopifyId', '!=', null).get()\n    const existingByShopifyId = new Map<string, string>()\n    existingSnapshot.docs.forEach((docSnap) => {\n      const docData = docSnap.data()\n      if (docData.shopifyId) {\n        existingByShopifyId.set(docData.shopifyId, docSnap.id)\n      }\n    })\n\n    // Get products for SKU matching\n    const productsRef = adminDb.collection('organizations').doc(organizationId).collection('products')\n    const productsSnapshot = await productsRef.get()\n    const productsBySku = new Map<string, string>()\n    productsSnapshot.docs.forEach((docSnap) => {\n      const docData = docSnap.data()\n      if (docData.sku) {\n        productsBySku.set(docData.sku.toLowerCase(), docSnap.id)\n      }\n    })\n\n    // Get or create Shopify sales channel\n    const channelsRef = adminDb.collection('organizations').doc(organizationId).collection('salesChannels')\n    const shopifyChannelSnap = await channelsRef.where('code', '==', 'shopify').limit(1).get()\n\n    let shopifyChannelId = ''\n    let shopifyChannelName = 'Shopify'\n    let shopifyChannelCode = 'shopify'\n\n    if (!shopifyChannelSnap.empty) {\n      const channelDoc = shopifyChannelSnap.docs[0]\n      shopifyChannelId = channelDoc.id\n      const channelData = channelDoc.data()\n      shopifyChannelName = channelData.name || 'Shopify'\n      shopifyChannelCode = channelData.code || 'shopify'\n    }\n\n    let imported = 0\n    let totalImportedRevenue = 0\n    let updated = 0\n    let skipped = 0\n    let totalFetched = 0\n    let pageInfo: string | null = null\n\n    // Paginate through all orders\n    do {\n      let shopifyUrl = `https://${shopify.storeName}.myshopify.com/admin/api/2024-01/orders.json?${queryParams.toString()}`\n\n      if (pageInfo) {\n        shopifyUrl = `https://${shopify.storeName}.myshopify.com/admin/api/2024-01/orders.json?page_info=${pageInfo}&limit=250`\n      }\n\n      const response = await fetch(shopifyUrl, {\n        headers: {\n          'X-Shopify-Access-Token': shopify.accessToken,\n          'Content-Type': 'application/json',\n        },\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        console.error('Shopify fetch orders error:', errorText)\n        return NextResponse.json({\n          success: false,\n          error: `Failed to fetch orders: ${response.status}`,\n          imported,\n          updated,\n          skipped\n        }, { status: 400 })\n      }\n\n      // Check for pagination link header\n      const linkHeader = response.headers.get('link')\n      pageInfo = null\n      if (linkHeader) {\n        const nextMatch = linkHeader.match(/<[^>]*page_info=([^>&]+)[^>]*>;\\s*rel=\"next\"/)\n        if (nextMatch) {\n          pageInfo = nextMatch[1]\n        }\n      }\n\n      const data = await response.json()\n      const shopifyOrders: ShopifyOrder[] = data.orders || []\n      totalFetched += shopifyOrders.length\n\n      for (const shopifyOrder of shopifyOrders) {\n        const shopifyId = shopifyOrder.id.toString()\n        const existingDocId = existingByShopifyId.get(shopifyId)\n\n        // Map line items with full details\n        const lineItems = (shopifyOrder.line_items || []).map((item) => {\n          const sku = item.sku?.toLowerCase()\n          return {\n            id: `li_${item.id}`,\n            shopifyLineItemId: item.id.toString(),\n            productId: sku ? productsBySku.get(sku) || null : null,\n            shopifyProductId: item.product_id?.toString() || null,\n            shopifyVariantId: item.variant_id?.toString() || null,\n            sku: item.sku || '',\n            name: item.name,\n            title: item.title,\n            variantTitle: item.variant_title || null,\n            quantity: item.quantity,\n            price: parseFloat(item.price) || 0,\n            totalDiscount: parseFloat(item.total_discount) || 0,\n            requiresShipping: item.requires_shipping,\n            fulfillableQuantity: item.fulfillable_quantity,\n            fulfillmentStatus: item.fulfillment_status || 'unfulfilled',\n            grams: item.grams,\n            vendor: item.vendor,\n            properties: item.properties || [],\n            giftCard: item.gift_card,\n            taxable: item.taxable,\n            taxLines: (item.tax_lines || []).map(t => ({\n              title: t.title,\n              price: parseFloat(t.price) || 0,\n              rate: t.rate\n            }))\n          }\n        })\n\n        // Map shipping address\n        const shippingAddress = shopifyOrder.shipping_address ? {\n          firstName: shopifyOrder.shipping_address.first_name || '',\n          lastName: shopifyOrder.shipping_address.last_name || '',\n          name: shopifyOrder.shipping_address.name || '',\n          company: shopifyOrder.shipping_address.company || null,\n          address1: shopifyOrder.shipping_address.address1 || '',\n          address2: shopifyOrder.shipping_address.address2 || null,\n          city: shopifyOrder.shipping_address.city || '',\n          province: shopifyOrder.shipping_address.province || '',\n          provinceCode: shopifyOrder.shipping_address.province_code || '',\n          country: shopifyOrder.shipping_address.country || '',\n          countryCode: shopifyOrder.shipping_address.country_code || '',\n          zip: shopifyOrder.shipping_address.zip || '',\n          phone: shopifyOrder.shipping_address.phone || null,\n          latitude: shopifyOrder.shipping_address.latitude,\n          longitude: shopifyOrder.shipping_address.longitude\n        } : null\n\n        // Map billing address\n        const billingAddress = shopifyOrder.billing_address ? {\n          firstName: shopifyOrder.billing_address.first_name || '',\n          lastName: shopifyOrder.billing_address.last_name || '',\n          name: shopifyOrder.billing_address.name || '',\n          company: shopifyOrder.billing_address.company || null,\n          address1: shopifyOrder.billing_address.address1 || '',\n          address2: shopifyOrder.billing_address.address2 || null,\n          city: shopifyOrder.billing_address.city || '',\n          province: shopifyOrder.billing_address.province || '',\n          provinceCode: shopifyOrder.billing_address.province_code || '',\n          country: shopifyOrder.billing_address.country || '',\n          countryCode: shopifyOrder.billing_address.country_code || '',\n          zip: shopifyOrder.billing_address.zip || '',\n          phone: shopifyOrder.billing_address.phone || null,\n          latitude: shopifyOrder.billing_address.latitude,\n          longitude: shopifyOrder.billing_address.longitude\n        } : null\n\n        // Map customer\n        const customer = shopifyOrder.customer ? {\n          id: shopifyOrder.customer.id?.toString() || '',\n          email: shopifyOrder.email || shopifyOrder.customer.email || '',\n          firstName: shopifyOrder.customer.first_name || '',\n          lastName: shopifyOrder.customer.last_name || '',\n          phone: shopifyOrder.customer.phone || shopifyOrder.phone || null,\n          ordersCount: shopifyOrder.customer.orders_count || 0,\n          totalSpent: parseFloat(shopifyOrder.customer.total_spent) || 0,\n          tags: shopifyOrder.customer.tags || ''\n        } : {\n          id: '',\n          email: shopifyOrder.email || '',\n          firstName: '',\n          lastName: '',\n          phone: shopifyOrder.phone || null,\n          ordersCount: 0,\n          totalSpent: 0,\n          tags: ''\n        }\n\n        // Map fulfillments\n        const fulfillments = (shopifyOrder.fulfillments || []).map((f) => ({\n          id: f.id.toString(),\n          status: f.status,\n          createdAt: new Date(f.created_at),\n          updatedAt: new Date(f.updated_at),\n          trackingCompany: f.tracking_company,\n          trackingNumber: f.tracking_number,\n          trackingNumbers: f.tracking_numbers || [],\n          trackingUrl: f.tracking_url,\n          trackingUrls: f.tracking_urls || [],\n          shipmentStatus: f.shipment_status,\n          lineItemIds: (f.line_items || []).map(li => li.id.toString())\n        }))\n\n        // Map refunds\n        const refunds = (shopifyOrder.refunds || []).map((r) => ({\n          id: r.id.toString(),\n          createdAt: new Date(r.created_at),\n          processedAt: new Date(r.processed_at),\n          note: r.note,\n          lineItems: (r.refund_line_items || []).map(rli => ({\n            id: rli.id.toString(),\n            lineItemId: rli.line_item_id.toString(),\n            quantity: rli.quantity,\n            restockType: rli.restock_type,\n            subtotal: parseFloat(rli.subtotal) || 0,\n            totalTax: parseFloat(rli.total_tax) || 0\n          })),\n          transactions: (r.transactions || []).map(t => ({\n            id: t.id.toString(),\n            amount: parseFloat(t.amount) || 0,\n            kind: t.kind,\n            gateway: t.gateway,\n            status: t.status\n          }))\n        }))\n\n        // Map discount codes\n        const discountCodes = (shopifyOrder.discount_codes || []).map(d => ({\n          code: d.code,\n          amount: parseFloat(d.amount) || 0,\n          type: d.type\n        }))\n\n        // Map discount applications\n        const discountApplications = (shopifyOrder.discount_applications || []).map(d => ({\n          type: d.type,\n          title: d.title,\n          description: d.description,\n          value: parseFloat(d.value) || 0,\n          valueType: d.value_type,\n          allocationMethod: d.allocation_method,\n          targetSelection: d.target_selection,\n          targetType: d.target_type\n        }))\n\n        // Map shipping lines\n        const shippingLines = (shopifyOrder.shipping_lines || []).map(s => ({\n          id: s.id.toString(),\n          title: s.title,\n          price: parseFloat(s.price) || 0,\n          code: s.code,\n          source: s.source,\n          carrierIdentifier: s.carrier_identifier,\n          requestedFulfillmentServiceId: s.requested_fulfillment_service_id\n        }))\n\n        // Map tax lines\n        const taxLines = (shopifyOrder.tax_lines || []).map(t => ({\n          title: t.title,\n          price: parseFloat(t.price) || 0,\n          rate: t.rate\n        }))\n\n        // Determine internal status based on Shopify statuses\n        let internalStatus = 'pending'\n        if (shopifyOrder.cancelled_at) {\n          internalStatus = 'cancelled'\n        } else if (shopifyOrder.closed_at) {\n          internalStatus = 'completed'\n        } else if (shopifyOrder.fulfillment_status === 'fulfilled') {\n          internalStatus = 'shipped'\n        } else if (shopifyOrder.fulfillment_status === 'partial') {\n          internalStatus = 'partially_shipped'\n        } else if (shopifyOrder.financial_status === 'paid') {\n          internalStatus = 'processing'\n        }\n\n        const orderData = {\n          shopifyId,\n          shopifyOrderNumber: `#${shopifyOrder.order_number}`,\n          shopifyOrderName: shopifyOrder.name,\n\n          status: internalStatus,\n          fulfillmentStatus: shopifyOrder.fulfillment_status || 'unfulfilled',\n          paymentStatus: shopifyOrder.financial_status || 'pending',\n\n          customer,\n          shippingAddress,\n          billingAddress,\n\n          lineItems,\n          shippingLines,\n\n          subtotal: parseFloat(shopifyOrder.subtotal_price) || 0,\n          shippingTotal: parseFloat(shopifyOrder.total_shipping_price_set?.shop_money?.amount) || 0,\n          taxTotal: parseFloat(shopifyOrder.total_tax) || 0,\n          discountTotal: parseFloat(shopifyOrder.total_discounts) || 0,\n          total: parseFloat(shopifyOrder.total_price) || 0,\n          currency: shopifyOrder.currency || 'USD',\n          totalWeight: shopifyOrder.total_weight || 0,\n\n          taxLines,\n          discountCodes,\n          discountApplications,\n\n          fulfillments,\n          refunds,\n\n          shippingMethod: shippingLines[0]?.title || null,\n          paymentGateway: shopifyOrder.gateway || null,\n          paymentGatewayNames: shopifyOrder.payment_gateway_names || [],\n          processingMethod: shopifyOrder.processing_method || null,\n\n          note: shopifyOrder.note || null,\n          noteAttributes: shopifyOrder.note_attributes || [],\n          tags: shopifyOrder.tags ? shopifyOrder.tags.split(',').map((t: string) => t.trim()) : [],\n\n          browserIp: shopifyOrder.browser_ip,\n          landingSite: shopifyOrder.landing_site,\n          referringSite: shopifyOrder.referring_site,\n          sourceName: shopifyOrder.source_name,\n\n          shopifyLocationId: shopifyOrder.location_id?.toString() || null,\n          isTestOrder: shopifyOrder.test || false,\n          confirmed: shopifyOrder.confirmed || false,\n\n          shopifyCreatedAt: new Date(shopifyOrder.created_at),\n          shopifyUpdatedAt: new Date(shopifyOrder.updated_at),\n          shopifyProcessedAt: shopifyOrder.processed_at ? new Date(shopifyOrder.processed_at) : null,\n          shopifyClosedAt: shopifyOrder.closed_at ? new Date(shopifyOrder.closed_at) : null,\n          shopifyCancelledAt: shopifyOrder.cancelled_at ? new Date(shopifyOrder.cancelled_at) : null,\n          cancelReason: shopifyOrder.cancel_reason || null,\n\n          updatedAt: new Date(),\n          source: 'shopify',\n\n          // Sales channel info\n          channelId: shopifyChannelId,\n          channelCode: shopifyChannelCode,\n          channelName: shopifyChannelName,\n\n          // Source details\n          sourceDetails: {\n            platform: 'shopify',\n            externalId: shopifyId,\n            externalOrderNumber: shopifyOrder.name,\n            importedAt: new Date(),\n          },\n        }\n\n        const orderTotal = parseFloat(shopifyOrder.total_price) || 0\n\n        if (existingDocId) {\n          // Update existing order\n          await ordersRef.doc(existingDocId).update(orderData)\n          updated++\n        } else {\n          // Create new order\n          await ordersRef.add({\n            ...orderData,\n            createdAt: new Date(),\n          })\n          imported++\n          totalImportedRevenue += orderTotal\n        }\n      }\n\n      // Continue pagination if there are more orders\n    } while (pageInfo)\n\n    // Update last sync time\n    await adminDb.collection('organizations').doc(organizationId).update({\n      'shopify.lastSyncOrders': new Date(),\n    })\n\n    // Update Shopify channel stats\n    if (shopifyChannelId && imported > 0) {\n      try {\n        await channelsRef.doc(shopifyChannelId).update({\n          'stats.totalOrders': FieldValue.increment(imported),\n          'stats.pendingOrders': FieldValue.increment(imported),\n          'stats.totalRevenue': FieldValue.increment(totalImportedRevenue),\n          'stats.lastOrderAt': new Date(),\n          'integration.lastSyncAt': new Date(),\n        })\n      } catch (channelUpdateError) {\n        console.error('Error updating channel stats:', channelUpdateError)\n        // Don't fail the sync for this\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      imported,\n      updated,\n      skipped,\n      total: totalFetched,\n    })\n  } catch (error: any) {\n    console.error('Sync orders error:', error)\n    return NextResponse.json({\n      success: false,\n      error: error.message || 'Sync failed'\n    }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AA4KO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EACJ,cAAc,EACd,aAAa,aAAa,EAC1B,SAAS,EACT,OAAO,EACP,gBAAgB,MAAa,0CAA0C;QAAlD,EACtB,GAAG;QAEJ,IAAI,CAAC,gBAAgB;YACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,IAAI;QACJ,IAAI;YACF,UAAU,IAAA,wIAAU;QACtB,EAAE,OAAO,YAAiB;YACxB,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;YACT,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,0BAA0B;QAC1B,MAAM,SAAS,MAAM,QAAQ,UAAU,CAAC,iBAAiB,GAAG,CAAC,gBAAgB,GAAG;QAChF,IAAI,CAAC,OAAO,MAAM,EAAE;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9F;QAEA,MAAM,UAAU,OAAO,IAAI;QAC3B,MAAM,UAAU,SAAS;QAEzB,IAAI,CAAC,SAAS,eAAe,CAAC,SAAS,aAAa;YAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC7F;QAEA,8CAA8C;QAC9C,MAAM,cAAc,IAAI;QACxB,YAAY,GAAG,CAAC,SAAS;QAEzB,IAAI,eAAe,eAAe;YAChC,YAAY,GAAG,CAAC,UAAU;YAC1B,YAAY,GAAG,CAAC,sBAAsB;QACxC,OAAO,IAAI,eAAe,cAAc;YACtC,IAAI,WAAW;gBACb,YAAY,GAAG,CAAC,kBAAkB,IAAI,KAAK,WAAW,WAAW;YACnE;YACA,IAAI,SAAS;gBACX,YAAY,GAAG,CAAC,kBAAkB,IAAI,KAAK,SAAS,WAAW;YACjE;YACA,IAAI,kBAAkB,OAAO;gBAC3B,YAAY,GAAG,CAAC,UAAU;YAC5B;QACF,OAAO;YACL,qDAAqD;YACrD,IAAI,kBAAkB,OAAO;gBAC3B,YAAY,GAAG,CAAC,UAAU;YAC5B;QACF;QAEA,oCAAoC;QACpC,MAAM,YAAY,QAAQ,UAAU,CAAC,iBAAiB,GAAG,CAAC,gBAAgB,UAAU,CAAC;QACrF,MAAM,mBAAmB,MAAM,UAAU,KAAK,CAAC,aAAa,MAAM,MAAM,GAAG;QAC3E,MAAM,sBAAsB,IAAI;QAChC,iBAAiB,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,UAAU,QAAQ,IAAI;YAC5B,IAAI,QAAQ,SAAS,EAAE;gBACrB,oBAAoB,GAAG,CAAC,QAAQ,SAAS,EAAE,QAAQ,EAAE;YACvD;QACF;QAEA,gCAAgC;QAChC,MAAM,cAAc,QAAQ,UAAU,CAAC,iBAAiB,GAAG,CAAC,gBAAgB,UAAU,CAAC;QACvF,MAAM,mBAAmB,MAAM,YAAY,GAAG;QAC9C,MAAM,gBAAgB,IAAI;QAC1B,iBAAiB,IAAI,CAAC,OAAO,CAAC,CAAC;YAC7B,MAAM,UAAU,QAAQ,IAAI;YAC5B,IAAI,QAAQ,GAAG,EAAE;gBACf,cAAc,GAAG,CAAC,QAAQ,GAAG,CAAC,WAAW,IAAI,QAAQ,EAAE;YACzD;QACF;QAEA,sCAAsC;QACtC,MAAM,cAAc,QAAQ,UAAU,CAAC,iBAAiB,GAAG,CAAC,gBAAgB,UAAU,CAAC;QACvF,MAAM,qBAAqB,MAAM,YAAY,KAAK,CAAC,QAAQ,MAAM,WAAW,KAAK,CAAC,GAAG,GAAG;QAExF,IAAI,mBAAmB;QACvB,IAAI,qBAAqB;QACzB,IAAI,qBAAqB;QAEzB,IAAI,CAAC,mBAAmB,KAAK,EAAE;YAC7B,MAAM,aAAa,mBAAmB,IAAI,CAAC,EAAE;YAC7C,mBAAmB,WAAW,EAAE;YAChC,MAAM,cAAc,WAAW,IAAI;YACnC,qBAAqB,YAAY,IAAI,IAAI;YACzC,qBAAqB,YAAY,IAAI,IAAI;QAC3C;QAEA,IAAI,WAAW;QACf,IAAI,uBAAuB;QAC3B,IAAI,UAAU;QACd,IAAI,UAAU;QACd,IAAI,eAAe;QACnB,IAAI,WAA0B;QAE9B,8BAA8B;QAC9B,GAAG;YACD,IAAI,aAAa,CAAC,QAAQ,EAAE,QAAQ,SAAS,CAAC,6CAA6C,EAAE,YAAY,QAAQ,IAAI;YAErH,IAAI,UAAU;gBACZ,aAAa,CAAC,QAAQ,EAAE,QAAQ,SAAS,CAAC,uDAAuD,EAAE,SAAS,UAAU,CAAC;YACzH;YAEA,MAAM,WAAW,MAAM,MAAM,YAAY;gBACvC,SAAS;oBACP,0BAA0B,QAAQ,WAAW;oBAC7C,gBAAgB;gBAClB;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,YAAY,MAAM,SAAS,IAAI;gBACrC,QAAQ,KAAK,CAAC,+BAA+B;gBAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;oBACvB,SAAS;oBACT,OAAO,CAAC,wBAAwB,EAAE,SAAS,MAAM,EAAE;oBACnD;oBACA;oBACA;gBACF,GAAG;oBAAE,QAAQ;gBAAI;YACnB;YAEA,mCAAmC;YACnC,MAAM,aAAa,SAAS,OAAO,CAAC,GAAG,CAAC;YACxC,WAAW;YACX,IAAI,YAAY;gBACd,MAAM,YAAY,WAAW,KAAK,CAAC;gBACnC,IAAI,WAAW;oBACb,WAAW,SAAS,CAAC,EAAE;gBACzB;YACF;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,MAAM,gBAAgC,KAAK,MAAM,IAAI,EAAE;YACvD,gBAAgB,cAAc,MAAM;YAEpC,KAAK,MAAM,gBAAgB,cAAe;gBACxC,MAAM,YAAY,aAAa,EAAE,CAAC,QAAQ;gBAC1C,MAAM,gBAAgB,oBAAoB,GAAG,CAAC;gBAE9C,mCAAmC;gBACnC,MAAM,YAAY,CAAC,aAAa,UAAU,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC;oBACrD,MAAM,MAAM,KAAK,GAAG,EAAE;oBACtB,OAAO;wBACL,IAAI,CAAC,GAAG,EAAE,KAAK,EAAE,EAAE;wBACnB,mBAAmB,KAAK,EAAE,CAAC,QAAQ;wBACnC,WAAW,MAAM,cAAc,GAAG,CAAC,QAAQ,OAAO;wBAClD,kBAAkB,KAAK,UAAU,EAAE,cAAc;wBACjD,kBAAkB,KAAK,UAAU,EAAE,cAAc;wBACjD,KAAK,KAAK,GAAG,IAAI;wBACjB,MAAM,KAAK,IAAI;wBACf,OAAO,KAAK,KAAK;wBACjB,cAAc,KAAK,aAAa,IAAI;wBACpC,UAAU,KAAK,QAAQ;wBACvB,OAAO,WAAW,KAAK,KAAK,KAAK;wBACjC,eAAe,WAAW,KAAK,cAAc,KAAK;wBAClD,kBAAkB,KAAK,iBAAiB;wBACxC,qBAAqB,KAAK,oBAAoB;wBAC9C,mBAAmB,KAAK,kBAAkB,IAAI;wBAC9C,OAAO,KAAK,KAAK;wBACjB,QAAQ,KAAK,MAAM;wBACnB,YAAY,KAAK,UAAU,IAAI,EAAE;wBACjC,UAAU,KAAK,SAAS;wBACxB,SAAS,KAAK,OAAO;wBACrB,UAAU,CAAC,KAAK,SAAS,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;gCACzC,OAAO,EAAE,KAAK;gCACd,OAAO,WAAW,EAAE,KAAK,KAAK;gCAC9B,MAAM,EAAE,IAAI;4BACd,CAAC;oBACH;gBACF;gBAEA,uBAAuB;gBACvB,MAAM,kBAAkB,aAAa,gBAAgB,GAAG;oBACtD,WAAW,aAAa,gBAAgB,CAAC,UAAU,IAAI;oBACvD,UAAU,aAAa,gBAAgB,CAAC,SAAS,IAAI;oBACrD,MAAM,aAAa,gBAAgB,CAAC,IAAI,IAAI;oBAC5C,SAAS,aAAa,gBAAgB,CAAC,OAAO,IAAI;oBAClD,UAAU,aAAa,gBAAgB,CAAC,QAAQ,IAAI;oBACpD,UAAU,aAAa,gBAAgB,CAAC,QAAQ,IAAI;oBACpD,MAAM,aAAa,gBAAgB,CAAC,IAAI,IAAI;oBAC5C,UAAU,aAAa,gBAAgB,CAAC,QAAQ,IAAI;oBACpD,cAAc,aAAa,gBAAgB,CAAC,aAAa,IAAI;oBAC7D,SAAS,aAAa,gBAAgB,CAAC,OAAO,IAAI;oBAClD,aAAa,aAAa,gBAAgB,CAAC,YAAY,IAAI;oBAC3D,KAAK,aAAa,gBAAgB,CAAC,GAAG,IAAI;oBAC1C,OAAO,aAAa,gBAAgB,CAAC,KAAK,IAAI;oBAC9C,UAAU,aAAa,gBAAgB,CAAC,QAAQ;oBAChD,WAAW,aAAa,gBAAgB,CAAC,SAAS;gBACpD,IAAI;gBAEJ,sBAAsB;gBACtB,MAAM,iBAAiB,aAAa,eAAe,GAAG;oBACpD,WAAW,aAAa,eAAe,CAAC,UAAU,IAAI;oBACtD,UAAU,aAAa,eAAe,CAAC,SAAS,IAAI;oBACpD,MAAM,aAAa,eAAe,CAAC,IAAI,IAAI;oBAC3C,SAAS,aAAa,eAAe,CAAC,OAAO,IAAI;oBACjD,UAAU,aAAa,eAAe,CAAC,QAAQ,IAAI;oBACnD,UAAU,aAAa,eAAe,CAAC,QAAQ,IAAI;oBACnD,MAAM,aAAa,eAAe,CAAC,IAAI,IAAI;oBAC3C,UAAU,aAAa,eAAe,CAAC,QAAQ,IAAI;oBACnD,cAAc,aAAa,eAAe,CAAC,aAAa,IAAI;oBAC5D,SAAS,aAAa,eAAe,CAAC,OAAO,IAAI;oBACjD,aAAa,aAAa,eAAe,CAAC,YAAY,IAAI;oBAC1D,KAAK,aAAa,eAAe,CAAC,GAAG,IAAI;oBACzC,OAAO,aAAa,eAAe,CAAC,KAAK,IAAI;oBAC7C,UAAU,aAAa,eAAe,CAAC,QAAQ;oBAC/C,WAAW,aAAa,eAAe,CAAC,SAAS;gBACnD,IAAI;gBAEJ,eAAe;gBACf,MAAM,WAAW,aAAa,QAAQ,GAAG;oBACvC,IAAI,aAAa,QAAQ,CAAC,EAAE,EAAE,cAAc;oBAC5C,OAAO,aAAa,KAAK,IAAI,aAAa,QAAQ,CAAC,KAAK,IAAI;oBAC5D,WAAW,aAAa,QAAQ,CAAC,UAAU,IAAI;oBAC/C,UAAU,aAAa,QAAQ,CAAC,SAAS,IAAI;oBAC7C,OAAO,aAAa,QAAQ,CAAC,KAAK,IAAI,aAAa,KAAK,IAAI;oBAC5D,aAAa,aAAa,QAAQ,CAAC,YAAY,IAAI;oBACnD,YAAY,WAAW,aAAa,QAAQ,CAAC,WAAW,KAAK;oBAC7D,MAAM,aAAa,QAAQ,CAAC,IAAI,IAAI;gBACtC,IAAI;oBACF,IAAI;oBACJ,OAAO,aAAa,KAAK,IAAI;oBAC7B,WAAW;oBACX,UAAU;oBACV,OAAO,aAAa,KAAK,IAAI;oBAC7B,aAAa;oBACb,YAAY;oBACZ,MAAM;gBACR;gBAEA,mBAAmB;gBACnB,MAAM,eAAe,CAAC,aAAa,YAAY,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACjE,IAAI,EAAE,EAAE,CAAC,QAAQ;wBACjB,QAAQ,EAAE,MAAM;wBAChB,WAAW,IAAI,KAAK,EAAE,UAAU;wBAChC,WAAW,IAAI,KAAK,EAAE,UAAU;wBAChC,iBAAiB,EAAE,gBAAgB;wBACnC,gBAAgB,EAAE,eAAe;wBACjC,iBAAiB,EAAE,gBAAgB,IAAI,EAAE;wBACzC,aAAa,EAAE,YAAY;wBAC3B,cAAc,EAAE,aAAa,IAAI,EAAE;wBACnC,gBAAgB,EAAE,eAAe;wBACjC,aAAa,CAAC,EAAE,UAAU,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,KAAM,GAAG,EAAE,CAAC,QAAQ;oBAC5D,CAAC;gBAED,cAAc;gBACd,MAAM,UAAU,CAAC,aAAa,OAAO,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,CAAC;wBACvD,IAAI,EAAE,EAAE,CAAC,QAAQ;wBACjB,WAAW,IAAI,KAAK,EAAE,UAAU;wBAChC,aAAa,IAAI,KAAK,EAAE,YAAY;wBACpC,MAAM,EAAE,IAAI;wBACZ,WAAW,CAAC,EAAE,iBAAiB,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,MAAO,CAAC;gCACjD,IAAI,IAAI,EAAE,CAAC,QAAQ;gCACnB,YAAY,IAAI,YAAY,CAAC,QAAQ;gCACrC,UAAU,IAAI,QAAQ;gCACtB,aAAa,IAAI,YAAY;gCAC7B,UAAU,WAAW,IAAI,QAAQ,KAAK;gCACtC,UAAU,WAAW,IAAI,SAAS,KAAK;4BACzC,CAAC;wBACD,cAAc,CAAC,EAAE,YAAY,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;gCAC7C,IAAI,EAAE,EAAE,CAAC,QAAQ;gCACjB,QAAQ,WAAW,EAAE,MAAM,KAAK;gCAChC,MAAM,EAAE,IAAI;gCACZ,SAAS,EAAE,OAAO;gCAClB,QAAQ,EAAE,MAAM;4BAClB,CAAC;oBACH,CAAC;gBAED,qBAAqB;gBACrB,MAAM,gBAAgB,CAAC,aAAa,cAAc,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;wBAClE,MAAM,EAAE,IAAI;wBACZ,QAAQ,WAAW,EAAE,MAAM,KAAK;wBAChC,MAAM,EAAE,IAAI;oBACd,CAAC;gBAED,4BAA4B;gBAC5B,MAAM,uBAAuB,CAAC,aAAa,qBAAqB,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;wBAChF,MAAM,EAAE,IAAI;wBACZ,OAAO,EAAE,KAAK;wBACd,aAAa,EAAE,WAAW;wBAC1B,OAAO,WAAW,EAAE,KAAK,KAAK;wBAC9B,WAAW,EAAE,UAAU;wBACvB,kBAAkB,EAAE,iBAAiB;wBACrC,iBAAiB,EAAE,gBAAgB;wBACnC,YAAY,EAAE,WAAW;oBAC3B,CAAC;gBAED,qBAAqB;gBACrB,MAAM,gBAAgB,CAAC,aAAa,cAAc,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;wBAClE,IAAI,EAAE,EAAE,CAAC,QAAQ;wBACjB,OAAO,EAAE,KAAK;wBACd,OAAO,WAAW,EAAE,KAAK,KAAK;wBAC9B,MAAM,EAAE,IAAI;wBACZ,QAAQ,EAAE,MAAM;wBAChB,mBAAmB,EAAE,kBAAkB;wBACvC,+BAA+B,EAAE,gCAAgC;oBACnE,CAAC;gBAED,gBAAgB;gBAChB,MAAM,WAAW,CAAC,aAAa,SAAS,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;wBACxD,OAAO,EAAE,KAAK;wBACd,OAAO,WAAW,EAAE,KAAK,KAAK;wBAC9B,MAAM,EAAE,IAAI;oBACd,CAAC;gBAED,sDAAsD;gBACtD,IAAI,iBAAiB;gBACrB,IAAI,aAAa,YAAY,EAAE;oBAC7B,iBAAiB;gBACnB,OAAO,IAAI,aAAa,SAAS,EAAE;oBACjC,iBAAiB;gBACnB,OAAO,IAAI,aAAa,kBAAkB,KAAK,aAAa;oBAC1D,iBAAiB;gBACnB,OAAO,IAAI,aAAa,kBAAkB,KAAK,WAAW;oBACxD,iBAAiB;gBACnB,OAAO,IAAI,aAAa,gBAAgB,KAAK,QAAQ;oBACnD,iBAAiB;gBACnB;gBAEA,MAAM,YAAY;oBAChB;oBACA,oBAAoB,CAAC,CAAC,EAAE,aAAa,YAAY,EAAE;oBACnD,kBAAkB,aAAa,IAAI;oBAEnC,QAAQ;oBACR,mBAAmB,aAAa,kBAAkB,IAAI;oBACtD,eAAe,aAAa,gBAAgB,IAAI;oBAEhD;oBACA;oBACA;oBAEA;oBACA;oBAEA,UAAU,WAAW,aAAa,cAAc,KAAK;oBACrD,eAAe,WAAW,aAAa,wBAAwB,EAAE,YAAY,WAAW;oBACxF,UAAU,WAAW,aAAa,SAAS,KAAK;oBAChD,eAAe,WAAW,aAAa,eAAe,KAAK;oBAC3D,OAAO,WAAW,aAAa,WAAW,KAAK;oBAC/C,UAAU,aAAa,QAAQ,IAAI;oBACnC,aAAa,aAAa,YAAY,IAAI;oBAE1C;oBACA;oBACA;oBAEA;oBACA;oBAEA,gBAAgB,aAAa,CAAC,EAAE,EAAE,SAAS;oBAC3C,gBAAgB,aAAa,OAAO,IAAI;oBACxC,qBAAqB,aAAa,qBAAqB,IAAI,EAAE;oBAC7D,kBAAkB,aAAa,iBAAiB,IAAI;oBAEpD,MAAM,aAAa,IAAI,IAAI;oBAC3B,gBAAgB,aAAa,eAAe,IAAI,EAAE;oBAClD,MAAM,aAAa,IAAI,GAAG,aAAa,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAc,EAAE,IAAI,MAAM,EAAE;oBAExF,WAAW,aAAa,UAAU;oBAClC,aAAa,aAAa,YAAY;oBACtC,eAAe,aAAa,cAAc;oBAC1C,YAAY,aAAa,WAAW;oBAEpC,mBAAmB,aAAa,WAAW,EAAE,cAAc;oBAC3D,aAAa,aAAa,IAAI,IAAI;oBAClC,WAAW,aAAa,SAAS,IAAI;oBAErC,kBAAkB,IAAI,KAAK,aAAa,UAAU;oBAClD,kBAAkB,IAAI,KAAK,aAAa,UAAU;oBAClD,oBAAoB,aAAa,YAAY,GAAG,IAAI,KAAK,aAAa,YAAY,IAAI;oBACtF,iBAAiB,aAAa,SAAS,GAAG,IAAI,KAAK,aAAa,SAAS,IAAI;oBAC7E,oBAAoB,aAAa,YAAY,GAAG,IAAI,KAAK,aAAa,YAAY,IAAI;oBACtF,cAAc,aAAa,aAAa,IAAI;oBAE5C,WAAW,IAAI;oBACf,QAAQ;oBAER,qBAAqB;oBACrB,WAAW;oBACX,aAAa;oBACb,aAAa;oBAEb,iBAAiB;oBACjB,eAAe;wBACb,UAAU;wBACV,YAAY;wBACZ,qBAAqB,aAAa,IAAI;wBACtC,YAAY,IAAI;oBAClB;gBACF;gBAEA,MAAM,aAAa,WAAW,aAAa,WAAW,KAAK;gBAE3D,IAAI,eAAe;oBACjB,wBAAwB;oBACxB,MAAM,UAAU,GAAG,CAAC,eAAe,MAAM,CAAC;oBAC1C;gBACF,OAAO;oBACL,mBAAmB;oBACnB,MAAM,UAAU,GAAG,CAAC;wBAClB,GAAG,SAAS;wBACZ,WAAW,IAAI;oBACjB;oBACA;oBACA,wBAAwB;gBAC1B;YACF;QAEA,+CAA+C;QACjD,QAAS,SAAS;QAElB,wBAAwB;QACxB,MAAM,QAAQ,UAAU,CAAC,iBAAiB,GAAG,CAAC,gBAAgB,MAAM,CAAC;YACnE,0BAA0B,IAAI;QAChC;QAEA,+BAA+B;QAC/B,IAAI,oBAAoB,WAAW,GAAG;YACpC,IAAI;gBACF,MAAM,YAAY,GAAG,CAAC,kBAAkB,MAAM,CAAC;oBAC7C,qBAAqB,kOAAU,CAAC,SAAS,CAAC;oBAC1C,uBAAuB,kOAAU,CAAC,SAAS,CAAC;oBAC5C,sBAAsB,kOAAU,CAAC,SAAS,CAAC;oBAC3C,qBAAqB,IAAI;oBACzB,0BAA0B,IAAI;gBAChC;YACF,EAAE,OAAO,oBAAoB;gBAC3B,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,+BAA+B;YACjC;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA;YACA;YACA,OAAO;QACT;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}