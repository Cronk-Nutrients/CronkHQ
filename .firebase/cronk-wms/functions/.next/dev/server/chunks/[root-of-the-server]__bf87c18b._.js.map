{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/1TB%20SSD/inventory-app/lib/firebase-admin.ts"],"sourcesContent":["import { initializeApp, getApps, cert, App } from 'firebase-admin/app'\nimport { getFirestore, Firestore } from 'firebase-admin/firestore'\n\nlet adminApp: App | undefined\nlet adminDb: Firestore | undefined\n\nfunction getAdminApp(): App {\n  if (adminApp) {\n    return adminApp\n  }\n\n  const apps = getApps()\n  if (apps.length > 0) {\n    adminApp = apps[0]\n    return adminApp\n  }\n\n  // Initialize Firebase Admin\n  // For production, use environment variables\n  // For local development, you can use a service account JSON file\n\n  const projectId = process.env.FIREBASE_PROJECT_ID\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL\n  const privateKey = process.env.FIREBASE_PRIVATE_KEY?.replace(/\\\\n/g, '\\n')\n\n  if (!projectId || !clientEmail || !privateKey) {\n    throw new Error(\n      'Firebase Admin SDK credentials not found. Please set FIREBASE_PROJECT_ID, FIREBASE_CLIENT_EMAIL, and FIREBASE_PRIVATE_KEY environment variables.'\n    )\n  }\n\n  adminApp = initializeApp({\n    credential: cert({\n      projectId,\n      clientEmail,\n      privateKey,\n    }),\n  })\n\n  return adminApp\n}\n\nexport function getAdminDb(): Firestore {\n  if (adminDb) {\n    return adminDb\n  }\n\n  getAdminApp()\n  adminDb = getFirestore()\n  return adminDb\n}\n\n// Export a lazy-initialized adminDb for convenience\nexport { getAdminDb as adminDb }\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;;AAEA,IAAI;AACJ,IAAI;AAEJ,SAAS;IACP,IAAI,UAAU;QACZ,OAAO;IACT;IAEA,MAAM,OAAO,IAAA,mNAAO;IACpB,IAAI,KAAK,MAAM,GAAG,GAAG;QACnB,WAAW,IAAI,CAAC,EAAE;QAClB,OAAO;IACT;IAEA,4BAA4B;IAC5B,4CAA4C;IAC5C,iEAAiE;IAEjE,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB;IACjD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB;IACrD,MAAM,aAAa,QAAQ,GAAG,CAAC,oBAAoB,EAAE,QAAQ,QAAQ;IAErE,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,YAAY;QAC7C,MAAM,IAAI,MACR;IAEJ;IAEA,WAAW,IAAA,yNAAa,EAAC;QACvB,YAAY,IAAA,gNAAI,EAAC;YACf;YACA;YACA;QACF;IACF;IAEA,OAAO;AACT;AAEO,SAAS;IACd,IAAI,SAAS;QACX,OAAO;IACT;IAEA;IACA,UAAU,IAAA,oOAAY;IACtB,OAAO;AACT"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/1TB%20SSD/inventory-app/app/api/shopify/sync-products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getAdminDb } from '@/lib/firebase-admin'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { organizationId } = await request.json()\n\n    if (!organizationId) {\n      return NextResponse.json({ success: false, error: 'Missing organization ID' }, { status: 400 })\n    }\n\n    const adminDb = getAdminDb()\n\n    // Get Shopify credentials from organization\n    const orgDoc = await adminDb.collection('organizations').doc(organizationId).get()\n    if (!orgDoc.exists) {\n      return NextResponse.json({ success: false, error: 'Organization not found' }, { status: 404 })\n    }\n\n    const orgData = orgDoc.data()\n    const shopify = orgData?.shopify\n\n    if (!shopify?.isConnected || !shopify?.accessToken) {\n      return NextResponse.json({ success: false, error: 'Shopify not connected' }, { status: 400 })\n    }\n\n    // Fetch products from Shopify\n    const shopifyUrl = `https://${shopify.storeName}.myshopify.com/admin/api/2024-01/products.json?limit=250`\n\n    const response = await fetch(shopifyUrl, {\n      headers: {\n        'X-Shopify-Access-Token': shopify.accessToken,\n        'Content-Type': 'application/json',\n      },\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error('Shopify fetch products error:', errorText)\n      return NextResponse.json({ success: false, error: 'Failed to fetch products' }, { status: 400 })\n    }\n\n    const data = await response.json()\n    const shopifyProducts = data.products || []\n\n    // Get existing products by SKU\n    const productsRef = adminDb.collection('organizations').doc(organizationId).collection('products')\n    const existingSnapshot = await productsRef.get()\n    const existingBySku = new Map<string, string>()\n    existingSnapshot.docs.forEach((docSnap) => {\n      const docData = docSnap.data()\n      if (docData.sku) {\n        existingBySku.set(docData.sku.toLowerCase(), docSnap.id)\n      }\n    })\n\n    let imported = 0\n    let updated = 0\n    let skipped = 0\n\n    // Process each Shopify product\n    for (const shopifyProduct of shopifyProducts) {\n      for (const variant of shopifyProduct.variants || []) {\n        const sku = variant.sku?.trim()\n        if (!sku) {\n          skipped++\n          continue\n        }\n\n        const existingId = existingBySku.get(sku.toLowerCase())\n\n        if (existingId) {\n          // Update existing product with Shopify link\n          await productsRef.doc(existingId).update({\n            shopifyId: shopifyProduct.id.toString(),\n            shopifyVariantId: variant.id.toString(),\n            shopifyHandle: shopifyProduct.handle,\n            shopifyInventoryItemId: variant.inventory_item_id?.toString() || null,\n            updatedAt: new Date(),\n          })\n          updated++\n        } else {\n          // Create new product from Shopify\n          const productData = {\n            name:\n              variant.title !== 'Default Title'\n                ? `${shopifyProduct.title} - ${variant.title}`\n                : shopifyProduct.title,\n            sku,\n            category: shopifyProduct.product_type || 'Uncategorized',\n            description: shopifyProduct.body_html?.replace(/<[^>]*>/g, '') || '',\n            barcode: variant.barcode || null,\n            status: shopifyProduct.status === 'active' ? 'active' : 'inactive',\n\n            // Pricing\n            cost: parseFloat(variant.cost) || 0,\n            retailPrice: parseFloat(variant.price) || 0,\n            compareAtPrice: variant.compare_at_price ? parseFloat(variant.compare_at_price) : null,\n\n            // Physical\n            weight: parseFloat(variant.weight) || 0,\n            weightUnit: variant.weight_unit || 'lb',\n\n            // Shopify references\n            shopifyId: shopifyProduct.id.toString(),\n            shopifyVariantId: variant.id.toString(),\n            shopifyHandle: shopifyProduct.handle,\n            shopifyInventoryItemId: variant.inventory_item_id?.toString() || null,\n\n            // Images\n            images: [],\n            thumbnail: shopifyProduct.image?.src || null,\n\n            // Defaults\n            customPrices: {},\n            totalStock: 0,\n            availableStock: 0,\n            reservedStock: 0,\n            lowStockThreshold: 10,\n\n            createdAt: new Date(),\n            updatedAt: new Date(),\n            source: 'shopify',\n          }\n\n          // Create a safe document ID from SKU\n          const docId = sku.replace(/[\\/\\\\#\\[\\].]/g, '_')\n          await productsRef.doc(docId).set(productData)\n          imported++\n        }\n      }\n    }\n\n    // Update last sync time\n    await adminDb.collection('organizations').doc(organizationId).update({\n      'shopify.lastSyncProducts': new Date(),\n    })\n\n    return NextResponse.json({\n      success: true,\n      imported,\n      updated,\n      skipped,\n      total: shopifyProducts.length,\n    })\n  } catch (error) {\n    console.error('Sync products error:', error)\n    return NextResponse.json({ success: false, error: 'Sync failed' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}